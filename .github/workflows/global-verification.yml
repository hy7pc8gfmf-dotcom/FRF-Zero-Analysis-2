name: FRF 2.0 æ™ºèƒ½å…¨é‡å½¢å¼åŒ–éªŒè¯

on:
  push:
    branches: [main, master, develop]
    paths:
      - 'SelfContainedLib/**'
      - 'theories/**'
      - 'Quantum/**'
      - 'CS_Null/**'
      - 'Test/**'
      - '.github/workflows/global-verification.yml'
  pull_request:
    branches: [main, master]
    paths:
      - 'SelfContainedLib/**'
      - 'theories/**'
      - 'Quantum/**'
      - 'CS_Null/**'
      - 'Test/**'
  workflow_dispatch:
    inputs:
      verify_mode:
        description: 'éªŒè¯æ¨¡å¼'
        required: true
        default: 'full'
        type: choice
        options:
          - full
          - quick
          - test-only
          - report-only
      parallel_jobs:
        description: 'å¹¶è¡Œä»»åŠ¡æ•°'
        required: false
        default: '4'
        type: string

jobs:
  setup-environment:
    name: ğŸ”§ ç¯å¢ƒé…ç½®ä¸æ£€æŸ¥
    runs-on: ubuntu-22.04
    outputs:
      coq_version: ${{ steps.check-coq.outputs.version }}
      memory_available: ${{ steps.check-memory.outputs.available_mb }}
      core_count: ${{ steps.check-cpu.outputs.core_count }}
    steps:
      - name: ğŸ“¥ æ£€å‡ºä»£ç 
        uses: actions/checkout@v4
        with:
          fetch-depth: 1
          submodules: true

      - name: ğŸ–¥ï¸ ç³»ç»Ÿä¿¡æ¯æ£€æŸ¥
        id: check-cpu
        run: |
          echo "æ ¸å¿ƒæ•°: $(nproc)"
          echo "core_count=$(nproc)" >> $GITHUB_OUTPUT

      - name: ğŸ’¾ å†…å­˜æ£€æŸ¥
        id: check-memory
        run: |
          AVAIL_MEM=$(free -m | awk '/^Mem:/{print $7}')
          echo "å¯ç”¨å†…å­˜: ${AVAIL_MEM}MB"
          echo "available_mb=${AVAIL_MEM}" >> $GITHUB_OUTPUT

      - name: ğŸ“¦ å®‰è£…ç³»ç»Ÿä¾èµ–
        run: |
          sudo apt-get update
          sudo apt-get install -y \
            opam \
            bubblewrap \
            g++ \
            pkg-config \
            m4 \
            rsync \
            git \
            wget \
            bc \
            graphviz \
            python3 \
            python3-pip \
            libgmp-dev \
            libffi-dev \
            libssl-dev \
            zlib1g-dev
          echo "âœ… ç³»ç»Ÿä¾èµ–å®‰è£…å®Œæˆ"

      - name: ğŸ”„ é…ç½®OPAMç¯å¢ƒ
        run: |
          opam init --disable-sandboxing -y --compiler=4.14.0
          eval $(opam env)
          opam repo add coq-released https://coq.inria.fr/opam/released
          opam update -y
          echo "OPAM_HOME=$OPAM_HOME" >> $GITHUB_ENV
          echo "OPAM_SWITCH_PREFIX=$OPAM_SWITCH_PREFIX" >> $GITHUB_ENV

      - name: ğŸ“Š é…ç½®éªŒè¯ç¯å¢ƒ
        run: |
          echo "AVAIL_MEM=${{ steps.check-memory.outputs.available_mb }}" >> $GITHUB_ENV
          echo "CORE_COUNT=${{ steps.check-cpu.outputs.core_count }}" >> $GITHUB_ENV
          
          AVAIL_MEM=${{ steps.check-memory.outputs.available_mb }}
          if [ $AVAIL_MEM -gt 16000 ]; then
            echo "COQ_MEMORY=16384" >> $GITHUB_ENV
            echo "BIGFILE_MEMORY=16384" >> $GITHUB_ENV
          elif [ $AVAIL_MEM -gt 8000 ]; then
            echo "COQ_MEMORY=8192" >> $GITHUB_ENV
            echo "BIGFILE_MEMORY=8192" >> $GITHUB_ENV
          elif [ $AVAIL_MEM -gt 4000 ]; then
            echo "COQ_MEMORY=4096" >> $GITHUB_ENV
            echo "BIGFILE_MEMORY=4096" >> $GITHUB_ENV
          else
            echo "COQ_MEMORY=2048" >> $GITHUB_ENV
            echo "BIGFILE_MEMORY=2048" >> $GITHUB_ENV
          fi
          
          CORE_COUNT=${{ steps.check-cpu.outputs.core_count }}
          PARALLEL_JOBS=$((CORE_COUNT / 2))
          if [ $PARALLEL_JOBS -lt 1 ]; then
            PARALLEL_JOBS=1
          fi
          echo "PARALLEL_JOBS=$PARALLEL_JOBS" >> $GITHUB_ENV

      - name: ğŸ” æ£€æŸ¥ç³»ç»Ÿç¯å¢ƒ
        id: check-coq
        run: |
          echo "ç³»ç»Ÿç¯å¢ƒæ£€æŸ¥:"
          echo "OPAMç‰ˆæœ¬: $(opam --version)"
          echo "OCamlç‰ˆæœ¬: $(ocamlc --version 2>/dev/null || echo 'æœªå®‰è£…')"
          
          # è®¾ç½®é»˜è®¤ç‰ˆæœ¬
          echo "version=8.18.0" >> $GITHUB_OUTPUT
          echo "å½“å‰ç¯å¢ƒå‡†å¤‡å®‰è£…Coq 8.18.0"

      - name: ğŸ“‹ ç¯å¢ƒæŠ¥å‘Š
        run: |
          echo "=== ç¯å¢ƒé…ç½®æŠ¥å‘Š ==="
          echo "ç³»ç»Ÿ: Ubuntu 22.04"
          echo "CPUæ ¸å¿ƒ: ${{ steps.check-cpu.outputs.core_count }}"
          echo "å¯ç”¨å†…å­˜: ${{ steps.check-memory.outputs.available_mb }}MB"
          echo "åˆ†é…å†…å­˜: ${{ env.COQ_MEMORY }}MB"
          echo "å¹¶è¡Œä»»åŠ¡: ${{ env.PARALLEL_JOBS }}"
          echo "è®¡åˆ’å®‰è£…Coqç‰ˆæœ¬: 8.18.0"

  install-dependencies:
    name: ğŸ“¦ ä¾èµ–å®‰è£…ä¸ç¼“å­˜
    needs: setup-environment
    runs-on: ubuntu-22.04
    steps:
      - name: ğŸ“¥ æ£€å‡ºä»£ç 
        uses: actions/checkout@v4
        with:
          fetch-depth: 1

      - name: ğŸ“¥ æ¢å¤OPAMç¼“å­˜
        uses: actions/cache@v3
        id: opam-cache
        with:
          path: |
            ~/.opam
            ~/.cache/opam
          key: ${{ runner.os }}-opam-8.18.0-${{ hashFiles('**/*.opam') }}
          restore-keys: |
            ${{ runner.os }}-opam-8.18.0-
            ${{ runner.os }}-opam-

      - name: ğŸ”„ è®¾ç½®OPAMç¯å¢ƒ
        run: |
          opam init --disable-sandboxing -y --compiler=4.14.0
          eval $(opam env)
          opam repo add coq-released https://coq.inria.fr/opam/released
          opam update -y

      - name: ğŸ“Š å®‰è£…Coqæ ¸å¿ƒ
        run: |
          eval $(opam env)
          echo "å®‰è£…Coq 8.18.0..."
          opam install -y coq.8.18.0
          
          echo "éªŒè¯Coqå®‰è£…..."
          coqc --version
          if [ $? -ne 0 ]; then
            echo "âŒ Coqå®‰è£…å¤±è´¥"
            exit 1
          fi

      - name: ğŸ§® å®‰è£…mathcomp
        run: |
          eval $(opam env)
          echo "å®‰è£…mathcompç³»åˆ—..."
          
          # å®‰è£…å®Œæ•´çš„mathcomp
          opam install -y coq-mathcomp-ssreflect
          opam install -y coq-mathcomp-fingroup
          opam install -y coq-mathcomp-algebra
          opam install -y coq-mathcomp-solvable
          opam install -y coq-mathcomp-field
          
          echo "éªŒè¯mathcompå®‰è£…..."
          opam list --installed | grep "coq-mathcomp" || (echo "âŒ mathcompå®‰è£…å¤±è´¥" && exit 1)

      - name: ğŸ“š å®‰è£…å¤–éƒ¨åº“
        run: |
          eval $(opam env)
          echo "å®‰è£…å¤–éƒ¨ä¾èµ–åº“..."
          
          # å®æ•°åº“
          opam install -y coq-mathcomp-analysis
          
          # æ ‡å‡†åº“
          opam install -y coq-stdlib
          
          # å¤§æ•´æ•°åº“
          opam install -y coq-bignums
          
          # æ—¶é—´é™åˆ¶
          opam install -y coq-time
          
          echo "âœ… ä¾èµ–å®‰è£…å®Œæˆ"

      - name: ğŸ“ ä¾èµ–éªŒè¯æŠ¥å‘Š
        run: |
          eval $(opam env)
          echo "=== ä¾èµ–éªŒè¯æŠ¥å‘Š ==="
          echo "Coqç‰ˆæœ¬:"
          coqc --version
          echo ""
          echo "å®‰è£…çš„åŒ…:"
          opam list --installed --short | head -30
          echo ""
          echo "OPAMé…ç½®:"
          opam config report

  compile-phase-1:
    name: ğŸ—ï¸ é˜¶æ®µ1:åŸºç¡€åº“ç¼–è¯‘
    needs: [setup-environment, install-dependencies]
    runs-on: ubuntu-22.04
    timeout-minutes: 45
    env:
      COQFLAGS: "-Q SelfContainedLib SelfContainedLib"
    steps:
      - name: ğŸ“¥ æ£€å‡ºä»£ç 
        uses: actions/checkout@v4
        with:
          fetch-depth: 1

      - name: ğŸ”„ è®¾ç½®ç¯å¢ƒ
        run: |
          eval $(opam env)
          echo "COQFLAGS=${{ env.COQFLAGS }}" >> $GITHUB_ENV

      - name: ğŸ“Š ç¼–è¯‘å‰æ£€æŸ¥
        run: |
          echo "=== åŸºç¡€åº“ç¼–è¯‘å‰æ£€æŸ¥ ==="
          echo "å·¥ä½œç›®å½•: $(pwd)"
          echo "åŸºç¡€åº“æ–‡ä»¶:"
          find SelfContainedLib -name "*.v" 2>/dev/null | head -20 || echo "æ— æ–‡ä»¶"
          echo ""
          echo "ç¼–è¯‘å‚æ•°: $COQFLAGS"
          echo "å†…å­˜é™åˆ¶: ${{ env.COQ_MEMORY }}MB"

      - name: ğŸ”§ é¡ºåºç¼–è¯‘åŸºç¡€åº“
        run: |
          eval $(opam env)
          
          # åˆ›å»ºç¼–è¯‘æ—¥å¿—ç›®å½•
          mkdir -p build-logs
          
          echo "å¼€å§‹ç¼–è¯‘åŸºç¡€åº“..."
          
          # å®šä¹‰ç¼–è¯‘å‡½æ•°
          compile_file() {
            local file=$1
            local base=$(basename "$file" .v)
            local log_file="build-logs/${base}.log"
            
            echo "ğŸš€ ç¼–è¯‘ $base.v..."
            echo "æ—¥å¿—æ–‡ä»¶: $log_file"
            
            # æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
            if [ ! -f "$file" ]; then
              echo "âŒ æ–‡ä»¶ä¸å­˜åœ¨: $file"
              return 1
            fi
            
            # è·å–æ–‡ä»¶å¤§å°
            local line_count=0
            line_count=$(wc -l < "$file" 2>/dev/null || echo 0)
            echo "  æ–‡ä»¶å¤§å°: $line_count è¡Œ"
            
            # è®¾ç½®ç¼–è¯‘å‚æ•°
            local extra_flags=""
            
            if [ "$base" = "Geometry" ] && [ $line_count -gt 1000 ]; then
              extra_flags="-m ${{ env.BIGFILE_MEMORY }} -async-proofs on"
              echo "  å¤§æ–‡ä»¶æ£€æµ‹ï¼Œä½¿ç”¨å¢å¼ºå‚æ•°"
            fi
            
            # æ‰§è¡Œç¼–è¯‘
            if timeout 10m coqc $COQFLAGS $extra_flags "$file" 2>&1 | tee "$log_file"; then
              echo "âœ… $base.v ç¼–è¯‘æˆåŠŸ"
              return 0
            else
              echo "âŒ $base.v ç¼–è¯‘å¤±è´¥"
              echo "=== æœ€å20è¡Œé”™è¯¯æ—¥å¿— ==="
              tail -20 "$log_file"
              return 1
            fi
          }
          
          # ç¼–è¯‘é¡ºåºï¼šå…ˆç¼–è¯‘ä¾èµ–å…³ç³»è¾ƒå°‘çš„æ–‡ä»¶
          failed=0
          
          # ç¼–è¯‘Algebra.v
          if [ -f "SelfContainedLib/Algebra.v" ]; then
            compile_file "SelfContainedLib/Algebra.v" || failed=1
          else
            echo "âš ï¸ Algebra.v ä¸å­˜åœ¨"
          fi
          
          # ç¼–è¯‘Category.v
          if [ -f "SelfContainedLib/Category.v" ]; then
            compile_file "SelfContainedLib/Category.v" || failed=1
          else
            echo "âš ï¸ Category.v ä¸å­˜åœ¨"
          fi
          
          # ç¼–è¯‘Geometry.v
          if [ -f "SelfContainedLib/Geometry.v" ]; then
            compile_file "SelfContainedLib/Geometry.v" || failed=1
          else
            echo "âš ï¸ Geometry.v ä¸å­˜åœ¨"
          fi
          
          if [ $failed -eq 1 ]; then
            echo "âŒ åŸºç¡€åº“ç¼–è¯‘å¤±è´¥"
            exit 1
          fi
          
          echo "âœ… åŸºç¡€åº“ç¼–è¯‘å®Œæˆ"

      - name: ğŸ“ˆ ç¼–è¯‘ç»“æœç»Ÿè®¡
        run: |
          echo "=== åŸºç¡€åº“ç¼–è¯‘ç»Ÿè®¡ ==="
          echo "ç¼–è¯‘æ–‡ä»¶:"
          for file in Algebra Category Geometry; do
            if [ -f "SelfContainedLib/$file.vo" ]; then
              size=$(stat -c%s "SelfContainedLib/$file.vo" 2>/dev/null || echo 0)
              echo "  âœ… $file.vo (${size} bytes)"
            else
              echo "  âŒ $file.vo (ç¼ºå¤±)"
            fi
          done
          echo ""
          echo "ç”Ÿæˆæ–‡ä»¶åˆ—è¡¨:"
          ls -la SelfContainedLib/*.vo SelfContainedLib/*.glob 2>/dev/null || echo "æ— ç”Ÿæˆæ–‡ä»¶"

      - name: ğŸ’¾ ä¿å­˜ç¼–è¯‘ç»“æœ
        uses: actions/upload-artifact@v3
        with:
          name: phase-1-compiled
          path: |
            SelfContainedLib/*.vo
            SelfContainedLib/*.glob
            build-logs/
          retention-days: 7

  compile-phase-2:
    name: ğŸ§  é˜¶æ®µ2:å…ƒç†è®ºå±‚ç¼–è¯‘
    needs: compile-phase-1
    runs-on: ubuntu-22.04
    timeout-minutes: 60
    env:
      COQFLAGS: "-Q SelfContainedLib SelfContainedLib -Q theories theories"
    steps:
      - name: ğŸ“¥ æ£€å‡ºä»£ç 
        uses: actions/checkout@v4
        with:
          fetch-depth: 1

      - name: ğŸ“¥ æ¢å¤é˜¶æ®µ1ç»“æœ
        uses: actions/download-artifact@v3
        with:
          name: phase-1-compiled
          path: .

      - name: ğŸ”„ è®¾ç½®ç¯å¢ƒ
        run: |
          eval $(opam env)
          echo "COQFLAGS=${{ env.COQFLAGS }}" >> $GITHUB_ENV
          
          # åˆ›å»ºç›®å½•ç»“æ„
          mkdir -p SelfContainedLib theories

      - name: ğŸ“Š æ£€æŸ¥å…ƒç†è®ºæ–‡ä»¶
        run: |
          echo "=== å…ƒç†è®ºå±‚æ–‡ä»¶æ£€æŸ¥ ==="
          echo "å…ƒç†è®ºæ–‡ä»¶:"
          find theories -name "*.v" 2>/dev/null | head -20 || echo "æ— æ–‡ä»¶"
          echo ""
          echo "æ–‡ä»¶å¤§å°ç»Ÿè®¡:"
          for file in theories/*.v 2>/dev/null; do
            if [ -f "$file" ]; then
              lines=$(wc -l < "$file" 2>/dev/null || echo 0)
              echo "  $(basename $file): $lines è¡Œ"
            fi
          done

      - name: ğŸ”§ æ™ºèƒ½ç¼–è¯‘å…ƒç†è®º
        run: |
          eval $(opam env)
          
          # åˆ›å»ºç¼–è¯‘æ—¥å¿—ç›®å½•
          mkdir -p build-logs
          
          echo "å¼€å§‹ç¼–è¯‘å…ƒç†è®ºå±‚..."
          
          # æ£€æŸ¥å¿…è¦çš„æ–‡ä»¶æ˜¯å¦å­˜åœ¨
          essential_files=0
          for file in theories/ChurchZero.v theories/FRF_MetaTheory.v theories/ChurchNumerals.v; do
            if [ -f "$file" ]; then
              essential_files=$((essential_files + 1))
            fi
          done
          
          if [ $essential_files -eq 0 ]; then
            echo "âš ï¸ æœªæ‰¾åˆ°å…ƒç†è®ºæ ¸å¿ƒæ–‡ä»¶"
            exit 0
          fi
          
          # ç¼–è¯‘å‡½æ•°
          compile_theory() {
            local file=$1
            local base=$(basename "$file" .v)
            local log_file="build-logs/${base}.log"
            
            echo "ğŸ“˜ ç¼–è¯‘ $base.v..."
            
            # æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
            if [ ! -f "$file" ]; then
              echo "âŒ æ–‡ä»¶ä¸å­˜åœ¨: $file"
              return 1
            fi
            
            # è·å–æ–‡ä»¶å¤§å°
            local line_count=0
            line_count=$(wc -l < "$file" 2>/dev/null || echo 0)
            echo "  æ–‡ä»¶å¤§å°: $line_count è¡Œ"
            
            # è®¾ç½®ç¼–è¯‘å‚æ•°
            local extra_flags=""
            
            if [ "$base" = "FRF_MetaTheory" ] || [ "$base" = "ChurchNumerals" ]; then
              if [ $line_count -gt 2000 ]; then
                extra_flags="-m ${{ env.BIGFILE_MEMORY }} -async-proofs on -async-proofs-tac-j 4"
                echo "  å¤§æ–‡ä»¶ï¼Œä½¿ç”¨å¢å¼ºå‚æ•°"
              fi
            fi
            
            # æ‰§è¡Œç¼–è¯‘
            if timeout 15m coqc $COQFLAGS $extra_flags "$file" 2>&1 | tee "$log_file"; then
              echo "âœ… $base.v ç¼–è¯‘æˆåŠŸ"
              return 0
            else
              echo "âŒ $base.v ç¼–è¯‘å¤±è´¥"
              echo "=== é”™è¯¯æ‘˜è¦ ==="
              grep -i "error\|fail\|syntax" "$log_file" | head -10
              return 1
            fi
          }
          
          # ç¼–è¯‘é¡ºåºï¼šå…ˆå°æ–‡ä»¶ï¼Œåå¤§æ–‡ä»¶
          failed=0
          
          # 1. ç¼–è¯‘ChurchZero.v
          if [ -f "theories/ChurchZero.v" ]; then
            compile_theory "theories/ChurchZero.v" || failed=1
          fi
          
          # 2. ç¼–è¯‘FRF_MetaTheory.v
          if [ -f "theories/FRF_MetaTheory.v" ]; then
            compile_theory "theories/FRF_MetaTheory.v" || failed=1
          fi
          
          # 3. ç¼–è¯‘ChurchNumerals.v
          if [ -f "theories/ChurchNumerals.v" ]; then
            compile_theory "theories/ChurchNumerals.v" || failed=1
          fi
          
          # ç¼–è¯‘å…¶ä»–å…ƒç†è®ºæ–‡ä»¶
          for file in theories/*.v 2>/dev/null; do
            base=$(basename "$file" .v)
            if [ "$base" != "ChurchZero" ] && [ "$base" != "FRF_MetaTheory" ] && [ "$base" != "ChurchNumerals" ]; then
              compile_theory "$file" || failed=1
            fi
          done
          
          if [ $failed -eq 1 ]; then
            echo "âŒ å…ƒç†è®ºå±‚ç¼–è¯‘æœ‰å¤±è´¥"
            exit 1
          fi
          
          echo "âœ… å…ƒç†è®ºå±‚ç¼–è¯‘å®Œæˆ"

      - name: ğŸ“ˆ å…ƒç†è®ºç¼–è¯‘ç»Ÿè®¡
        run: |
          echo "=== å…ƒç†è®ºå±‚ç¼–è¯‘ç»Ÿè®¡ ==="
          echo "æˆåŠŸç¼–è¯‘çš„æ–‡ä»¶:"
          vo_count=0
          for file in theories/*.vo 2>/dev/null; do
            if [ -f "$file" ]; then
              base=$(basename "$file" .vo)
              lines=0
              if [ -f "theories/$base.v" ]; then
                lines=$(wc -l < "theories/$base.v" 2>/dev/null || echo 0)
              fi
              echo "  âœ… $base.vo ($lines è¡Œ)"
              vo_count=$((vo_count + 1))
            fi
          done
          echo "æ€»è®¡: $vo_count ä¸ªæ–‡ä»¶ç¼–è¯‘æˆåŠŸ"
          
          echo ""
          echo "æœªç¼–è¯‘çš„.væ–‡ä»¶:"
          for file in theories/*.v 2>/dev/null; do
            base=$(basename "$file" .v)
            if [ ! -f "theories/$base.vo" ]; then
              echo "  âŒ $base.v (æœªç¼–è¯‘)"
            fi
          done

      - name: ğŸ’¾ ä¿å­˜ç¼–è¯‘ç»“æœ
        uses: actions/upload-artifact@v3
        with:
          name: phase-2-compiled
          path: |
            SelfContainedLib/*.vo
            SelfContainedLib/*.glob
            theories/*.vo
            theories/*.glob
            build-logs/
          retention-days: 7

  compile-phase-3:
    name: ğŸ¯ é˜¶æ®µ3:æ•°å­¦åœºæ™¯å±‚ç¼–è¯‘
    needs: compile-phase-2
    runs-on: ubuntu-22.04
    timeout-minutes: 50
    env:
      COQFLAGS: "-Q SelfContainedLib SelfContainedLib -Q theories theories"
    steps:
      - name: ğŸ“¥ æ£€å‡ºä»£ç 
        uses: actions/checkout@v4
        with:
          fetch-depth: 1

      - name: ğŸ“¥ æ¢å¤é˜¶æ®µ2ç»“æœ
        uses: actions/download-artifact@v3
        with:
          name: phase-2-compiled
          path: .

      - name: ğŸ”„ è®¾ç½®ç¯å¢ƒ
        run: |
          eval $(opam env)
          echo "COQFLAGS=${{ env.COQFLAGS }}" >> $GITHUB_ENV
          
          # åˆ›å»ºç›®å½•ç»“æ„
          mkdir -p SelfContainedLib theories

      - name: ğŸ“Š æ£€æŸ¥åœºæ™¯æ–‡ä»¶
        run: |
          echo "=== æ•°å­¦åœºæ™¯å±‚æ–‡ä»¶æ£€æŸ¥ ==="
          echo "åœºæ™¯æ–‡ä»¶:"
          find theories -name "Case*.v" 2>/dev/null | head -20 || echo "æ— åœºæ™¯æ–‡ä»¶"
          echo ""
          echo "æ–‡ä»¶ç»Ÿè®¡:"
          total_lines=0
          file_count=0
          for file in theories/Case*.v 2>/dev/null; do
            if [ -f "$file" ]; then
              base=$(basename "$file" .v)
              lines=$(wc -l < "$file" 2>/dev/null || echo 0)
              echo "  $base: $lines è¡Œ"
              total_lines=$((total_lines + lines))
              file_count=$((file_count + 1))
            fi
          done
          echo "æ€»è®¡: $file_count ä¸ªæ–‡ä»¶, $total_lines è¡Œ"

      - name: ğŸ”§ ç¼–è¯‘æ•°å­¦åœºæ™¯
        run: |
          eval $(opam env)
          
          # åˆ›å»ºç¼–è¯‘æ—¥å¿—ç›®å½•
          mkdir -p build-logs
          
          echo "å¼€å§‹ç¼–è¯‘æ•°å­¦åœºæ™¯å±‚..."
          
          # æ£€æŸ¥åœºæ™¯æ–‡ä»¶æ˜¯å¦å­˜åœ¨
          files_found=0
          for pattern in CaseA CaseB CaseC CaseD CaseE; do
            if ls theories/${pattern}_*.v 1> /dev/null 2>&1; then
              files_found=1
            fi
          done
          
          if [ $files_found -eq 0 ]; then
            echo "âš ï¸ æœªæ‰¾åˆ°åœºæ™¯æ–‡ä»¶"
            exit 0
          fi
          
          # ç¼–è¯‘å‡½æ•°
          compile_scene() {
            local file=$1
            local base=$(basename "$file" .v)
            local log_file="build-logs/${base}.log"
            
            echo "ğŸ¨ ç¼–è¯‘ $base.v..."
            
            # æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
            if [ ! -f "$file" ]; then
              echo "âŒ æ–‡ä»¶ä¸å­˜åœ¨: $file"
              return 1
            fi
            
            # è·å–æ–‡ä»¶å¤§å°
            local line_count=0
            line_count=$(wc -l < "$file" 2>/dev/null || echo 0)
            
            # è®¾ç½®ç¼–è¯‘å‚æ•°
            local extra_flags=""
            
            case $base in
              CaseE_*)
                if [ $line_count -gt 3000 ]; then
                  extra_flags="-m ${{ env.BIGFILE_MEMORY }} -async-proofs on -async-proofs-tac-j 4"
                  echo "  è¶…å¤§æ–‡ä»¶ï¼Œä½¿ç”¨å¢å¼ºå‚æ•°"
                fi
                ;;
              CaseB_*|CaseD_*)
                if [ $line_count -gt 1500 ]; then
                  extra_flags="-async-proofs on"
                  echo "  å¤§æ–‡ä»¶ï¼Œä½¿ç”¨å¼‚æ­¥è¯æ˜"
                fi
                ;;
            esac
            
            # æ‰§è¡Œç¼–è¯‘
            if timeout 10m coqc $COQFLAGS $extra_flags "$file" 2>&1 | tee "$log_file"; then
              echo "âœ… $base.v ç¼–è¯‘æˆåŠŸ"
              return 0
            else
              echo "âŒ $base.v ç¼–è¯‘å¤±è´¥"
              echo "=== é”™è¯¯æ‘˜è¦ ==="
              grep -i "error\|fail" "$log_file" | head -5
              return 1
            fi
          }
          
          # ç¼–è¯‘åœºæ™¯æ–‡ä»¶
          failed=0
          
          # æŒ‰é¡ºåºç¼–è¯‘ï¼ˆå­—æ¯é¡ºåºï¼‰
          for pattern in CaseA CaseB CaseC CaseD CaseE; do
            for file in theories/${pattern}_*.v 2>/dev/null; do
              if [ -f "$file" ]; then
                compile_scene "$file" || failed=1
                
                # å°æ–‡ä»¶ä¹‹é—´ä¼‘æ¯ä¸€ä¸‹
                if [ $failed -eq 0 ]; then
                  sleep 2
                fi
              fi
            done
          done
          
          if [ $failed -eq 1 ]; then
            echo "âŒ æ•°å­¦åœºæ™¯å±‚ç¼–è¯‘æœ‰å¤±è´¥"
            exit 1
          fi
          
          echo "âœ… æ•°å­¦åœºæ™¯å±‚ç¼–è¯‘å®Œæˆ"

      - name: ğŸ“ˆ åœºæ™¯å±‚ç»Ÿè®¡
        run: |
          echo "=== æ•°å­¦åœºæ™¯å±‚ç¼–è¯‘ç»Ÿè®¡ ==="
          echo "åœºæ™¯æ¨¡å—ç¼–è¯‘çŠ¶æ€:"
          
          total_scenes=0
          compiled_scenes=0
          
          for pattern in CaseA CaseB CaseC CaseD CaseE; do
            echo "  $pattern ç³»åˆ—:"
            for file in theories/${pattern}_*.v 2>/dev/null; do
              if [ -f "$file" ]; then
                base=$(basename "$file" .v)
                total_scenes=$((total_scenes + 1))
                
                if [ -f "theories/${base}.vo" ]; then
                  lines=$(wc -l < "$file" 2>/dev/null || echo 0)
                  echo "    âœ… $base ($lines è¡Œ)"
                  compiled_scenes=$((compiled_scenes + 1))
                else
                  echo "    âŒ $base (ç¼–è¯‘å¤±è´¥)"
                fi
              fi
            done
          done
          
          echo ""
          echo "æ€»è®¡: $compiled_scenes/$total_scenes ä¸ªåœºæ™¯ç¼–è¯‘æˆåŠŸ"
          
          if [ $total_scenes -eq 0 ]; then
            echo "âš ï¸ æœªæ‰¾åˆ°ä»»ä½•åœºæ™¯æ–‡ä»¶"
          fi

      - name: ğŸ’¾ ä¿å­˜ç¼–è¯‘ç»“æœ
        uses: actions/upload-artifact@v3
        with:
          name: phase-3-compiled
          path: |
            SelfContainedLib/*.vo
            SelfContainedLib/*.glob
            theories/*.vo
            theories/*.glob
            build-logs/
          retention-days: 7

  compile-phase-4:
    name: ğŸ”® é˜¶æ®µ4:æ‰©å±•æ¨¡å—ç¼–è¯‘
    needs: [compile-phase-3]
    runs-on: ubuntu-22.04
    timeout-minutes: 60
    env:
      COQFLAGS: "-Q SelfContainedLib SelfContainedLib -Q theories theories -Q Quantum Quantum -Q CS_Null CS_Null"
    steps:
      - name: ğŸ“¥ æ£€å‡ºä»£ç 
        uses: actions/checkout@v4
        with:
          fetch-depth: 1

      - name: ğŸ“¥ æ¢å¤é˜¶æ®µ3ç»“æœ
        uses: actions/download-artifact@v3
        with:
          name: phase-3-compiled
          path: .

      - name: ğŸ”„ è®¾ç½®ç¯å¢ƒ
        run: |
          eval $(opam env)
          echo "COQFLAGS=${{ env.COQFLAGS }}" >> $GITHUB_ENV
          
          # åˆ›å»ºç›®å½•ç»“æ„
          mkdir -p SelfContainedLib theories Quantum CS_Null

      - name: ğŸ“ æ£€æŸ¥æ‰©å±•æ¨¡å—
        run: |
          echo "=== æ‰©å±•æ¨¡å—ç»“æ„æ£€æŸ¥ ==="
          echo "ç›®å½•ç»“æ„:"
          ls -la
          
          echo ""
          echo "é‡å­æ¨¡å—æ–‡ä»¶:"
          find Quantum -name "*.v" 2>/dev/null | head -10 || echo "æ— é‡å­æ¨¡å—"
          
          echo ""
          echo "ç©ºå€¼ç³»ç»Ÿæ–‡ä»¶:"
          find CS_Null -name "*.v" 2>/dev/null | head -10 || echo "æ— ç©ºå€¼ç³»ç»Ÿ"
          
          echo ""
          echo "æ€»æ–‡ä»¶æ•°:"
          find Quantum CS_Null -name "*.v" 2>/dev/null | wc -l || echo "0"

      - name: ğŸ”§ ç¼–è¯‘é‡å­æ¨¡å—
        run: |
          eval $(opam env)
          
          # åˆ›å»ºç¼–è¯‘æ—¥å¿—ç›®å½•
          mkdir -p build-logs
          
          echo "ğŸ”¬ ç¼–è¯‘é‡å­æ¨¡å—..."
          
          # æ£€æŸ¥é‡å­æ–‡ä»¶æ˜¯å¦å­˜åœ¨
          quantum_files=0
          for file in Quantum/*.v 2>/dev/null; do
            quantum_files=1
            break
          done
          
          if [ $quantum_files -eq 0 ]; then
            echo "âš ï¸ æœªæ‰¾åˆ°é‡å­æ¨¡å—æ–‡ä»¶"
            exit 0
          fi
          
          # ç¼–è¯‘å‡½æ•°
          compile_quantum() {
            local file=$1
            local base=$(basename "$file" .v)
            local log_file="build-logs/quantum_${base}.log"
            
            echo "  ç¼–è¯‘ $base.v..."
            
            # æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
            if [ ! -f "$file" ]; then
              echo "âŒ æ–‡ä»¶ä¸å­˜åœ¨: $file"
              return 1
            fi
            
            # æ£€æŸ¥ä¾èµ–
            if grep -q "Require.*Geometry" "$file" 2>/dev/null; then
              if [ ! -f "SelfContainedLib/Geometry.vo" ]; then
                echo "âŒ ç¼ºå°‘Geometryä¾èµ–"
                return 1
              fi
            fi
            
            # è®¾ç½®ç¼–è¯‘å‚æ•°
            local extra_flags=""
            local line_count=$(wc -l < "$file" 2>/dev/null || echo 0)
            
            if [ $line_count -gt 2000 ]; then
              extra_flags="-m ${{ env.BIGFILE_MEMORY }} -async-proofs on"
              echo "    å¤§æ–‡ä»¶ï¼Œä½¿ç”¨å¢å¼ºå‚æ•°"
            fi
            
            # æ‰§è¡Œç¼–è¯‘
            if timeout 15m coqc $COQFLAGS $extra_flags "$file" 2>&1 | tee "$log_file"; then
              echo "    âœ… $base.v ç¼–è¯‘æˆåŠŸ"
              return 0
            else
              echo "    âŒ $base.v ç¼–è¯‘å¤±è´¥"
              return 1
            fi
          }
          
          # ç¼–è¯‘é‡å­æ–‡ä»¶
          failed=0
          
          # å…ˆç¼–è¯‘QFT_FRF.v
          if [ -f "Quantum/QFT_FRF.v" ]; then
            compile_quantum "Quantum/QFT_FRF.v" || failed=1
          fi
          
          # ç¼–è¯‘CurvedSpacetimeQFT.v
          if [ -f "Quantum/CurvedSpacetimeQFT.v" ]; then
            compile_quantum "Quantum/CurvedSpacetimeQFT.v" || failed=1
          fi
          
          # ç¼–è¯‘å…¶ä»–é‡å­æ–‡ä»¶
          for file in Quantum/*.v 2>/dev/null; do
            base=$(basename "$file" .v)
            if [ "$base" != "QFT_FRF" ] && [ "$base" != "CurvedSpacetimeQFT" ]; then
              compile_quantum "$file" || failed=1
            fi
          done
          
          if [ $failed -eq 1 ]; then
            echo "âŒ é‡å­æ¨¡å—ç¼–è¯‘æœ‰å¤±è´¥"
            exit 1
          fi
          
          echo "âœ… é‡å­æ¨¡å—ç¼–è¯‘å®Œæˆ"

      - name: ğŸ”§ ç¼–è¯‘ç©ºå€¼ç³»ç»ŸåŸºç¡€
        run: |
          eval $(opam env)
          
          echo "ğŸ“Š ç¼–è¯‘ç©ºå€¼ç³»ç»ŸåŸºç¡€æ¨¡å—..."
          
          # æ£€æŸ¥ç©ºå€¼ç³»ç»Ÿæ–‡ä»¶æ˜¯å¦å­˜åœ¨
          csnull_files=0
          for file in CS_Null/*.v 2>/dev/null; do
            csnull_files=1
            break
          done
          
          if [ $csnull_files -eq 0 ]; then
            echo "âš ï¸ æœªæ‰¾åˆ°ç©ºå€¼ç³»ç»Ÿæ–‡ä»¶"
            exit 0
          fi
          
          # ç¼–è¯‘å‡½æ•°
          compile_csnull() {
            local file=$1
            local base=$(basename "$file" .v)
            local log_file="build-logs/csnull_${base}.log"
            
            echo "  ç¼–è¯‘ $base.v..."
            
            # æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
            if [ ! -f "$file" ]; then
              echo "âŒ æ–‡ä»¶ä¸å­˜åœ¨: $file"
              return 1
            fi
            
            # è®¾ç½®ç¼–è¯‘å‚æ•°
            local extra_flags=""
            local line_count=$(wc -l < "$file" 2>/dev/null || echo 0)
            
            if [ "$base" = "FRF_CS_Null_Common" ] && [ $line_count -gt 5000 ]; then
              extra_flags="-m ${{ env.BIGFILE_MEMORY }} -async-proofs on -async-proofs-tac-j 8"
              echo "    æå¤§æ–‡ä»¶ï¼Œä½¿ç”¨æœ€å¼ºå‚æ•°"
            elif [ $line_count -gt 3000 ]; then
              extra_flags="-m ${{ env.BIGFILE_MEMORY }} -async-proofs on"
              echo "    å¤§æ–‡ä»¶ï¼Œä½¿ç”¨å¢å¼ºå‚æ•°"
            fi
            
            # æ‰§è¡Œç¼–è¯‘
            if timeout 20m coqc $COQFLAGS $extra_flags "$file" 2>&1 | tee "$log_file"; then
              echo "    âœ… $base.v ç¼–è¯‘æˆåŠŸ"
              return 0
            else
              echo "    âŒ $base.v ç¼–è¯‘å¤±è´¥"
              echo "=== é”™è¯¯æ‘˜è¦ ==="
              tail -20 "$log_file"
              return 1
            fi
          }
          
          # ç¼–è¯‘ç©ºå€¼ç³»ç»Ÿæ–‡ä»¶
          failed=0
          
          # å…ˆç¼–è¯‘åŸºç¡€æ–‡ä»¶
          if [ -f "CS_Null/FRF_CS_Null_Common.v" ]; then
            compile_csnull "CS_Null/FRF_CS_Null_Common.v" || failed=1
          fi
          
          if [ -f "CS_Null/FRF_CS_Null.v" ]; then
            compile_csnull "CS_Null/FRF_CS_Null.v" || failed=1
          fi
          
          if [ $failed -eq 1 ]; then
            echo "âŒ ç©ºå€¼ç³»ç»ŸåŸºç¡€æ¨¡å—ç¼–è¯‘å¤±è´¥"
            exit 1
          fi
          
          echo "âœ… ç©ºå€¼ç³»ç»ŸåŸºç¡€æ¨¡å—ç¼–è¯‘å®Œæˆ"

      - name: ğŸ”§ ç¼–è¯‘è¯­è¨€ç©ºå€¼æ¨¡å—
        run: |
          eval $(opam env)
          
          echo "ğŸŒ ç¼–è¯‘è¯­è¨€ç©ºå€¼æ¨¡å—..."
          
          # æ£€æŸ¥è¯­è¨€æ–‡ä»¶æ˜¯å¦å­˜åœ¨
          lang_files=0
          for file in CS_Null/*Null.v 2>/dev/null; do
            lang_files=1
            break
          done
          
          if [ $lang_files -eq 0 ]; then
            echo "âš ï¸ æœªæ‰¾åˆ°è¯­è¨€ç©ºå€¼æ¨¡å—æ–‡ä»¶"
            exit 0
          fi
          
          # å®šä¹‰è¯­è¨€ç¼–è¯‘é¡ºåº
          languages="Cxx Python Java Math Rust"
          
          failed=0
          for lang in $languages; do
            file="CS_Null/${lang}Null.v"
            
            if [ ! -f "$file" ]; then
              echo "âš ï¸  $file ä¸å­˜åœ¨"
              continue
            fi
            
            echo "  ç¼–è¯‘ ${lang}Null.v..."
            local log_file="build-logs/${lang}Null.log"
            
            # è®¾ç½®ç¼–è¯‘å‚æ•°
            local extra_flags=""
            local line_count=$(wc -l < "$file" 2>/dev/null || echo 0)
            
            if [ $line_count -gt 2000 ]; then
              extra_flags="-async-proofs on"
            fi
            
            # æ‰§è¡Œç¼–è¯‘
            if timeout 10m coqc $COQFLAGS $extra_flags "$file" 2>&1 | tee "$log_file"; then
              echo "    âœ… ${lang}Null.v ç¼–è¯‘æˆåŠŸ"
            else
              echo "    âŒ ${lang}Null.v ç¼–è¯‘å¤±è´¥"
              failed=1
            fi
          done
          
          if [ $failed -eq 1 ]; then
            echo "âŒ è¯­è¨€ç©ºå€¼æ¨¡å—ç¼–è¯‘æœ‰å¤±è´¥"
            exit 1
          fi
          
          echo "âœ… è¯­è¨€ç©ºå€¼æ¨¡å—ç¼–è¯‘å®Œæˆ"

      - name: ğŸ“ˆ æ‰©å±•æ¨¡å—ç»Ÿè®¡
        run: |
          echo "=== æ‰©å±•æ¨¡å—ç¼–è¯‘ç»Ÿè®¡ ==="
          
          echo "é‡å­æ¨¡å—:"
          qcount=0
          for file in Quantum/*.vo 2>/dev/null; do
            base=$(basename "$file" .vo)
            echo "  âœ… $base"
            qcount=$((qcount + 1))
          done
          if [ $qcount -eq 0 ]; then
            echo "  æ— é‡å­æ¨¡å—"
          else
            echo "  æ€»è®¡: $qcount ä¸ªæ¨¡å—"
          fi
          
          echo ""
          echo "ç©ºå€¼ç³»ç»Ÿ:"
          cscount=0
          for file in CS_Null/*.vo 2>/dev/null; do
            base=$(basename "$file" .vo)
            echo "  âœ… $base"
            cscount=$((cscount + 1))
          done
          if [ $cscount -eq 0 ]; then
            echo "  æ— ç©ºå€¼ç³»ç»Ÿæ¨¡å—"
          else
            echo "  æ€»è®¡: $cscount ä¸ªæ¨¡å—"
          fi

      - name: ğŸ’¾ ä¿å­˜ç¼–è¯‘ç»“æœ
        uses: actions/upload-artifact@v3
        with:
          name: phase-4-compiled
          path: |
            SelfContainedLib/*.vo
            SelfContainedLib/*.glob
            theories/*.vo
            theories/*.glob
            Quantum/*.vo
            Quantum/*.glob
            CS_Null/*.vo
            CS_Null/*.glob
            build-logs/
          retention-days: 7

  compile-phase-5:
    name: ğŸ§© é˜¶æ®µ5:é›†æˆæ¨¡å—ç¼–è¯‘
    needs: compile-phase-4
    runs-on: ubuntu-22.04
    timeout-minutes: 45
    env:
      COQFLAGS: "-Q SelfContainedLib SelfContainedLib -Q theories theories -Q Quantum Quantum -Q CS_Null CS_Null"
    steps:
      - name: ğŸ“¥ æ£€å‡ºä»£ç 
        uses: actions/checkout@v4
        with:
          fetch-depth: 1

      - name: ğŸ“¥ æ¢å¤é˜¶æ®µ4ç»“æœ
        uses: actions/download-artifact@v3
        with:
          name: phase-4-compiled
          path: .

      - name: ğŸ”„ è®¾ç½®ç¯å¢ƒ
        run: |
          eval $(opam env)
          echo "COQFLAGS=${{ env.COQFLAGS }}" >> $GITHUB_ENV
          
          # åˆ›å»ºç›®å½•ç»“æ„
          mkdir -p SelfContainedLib theories Quantum CS_Null

      - name: ğŸ”§ ç¼–è¯‘é›†æˆæ¨¡å—
        run: |
          eval $(opam env)
          
          # åˆ›å»ºç¼–è¯‘æ—¥å¿—ç›®å½•
          mkdir -p build-logs
          
          echo "ğŸ§© ç¼–è¯‘é›†æˆæ¨¡å— FRF_Comparative.v..."
          
          # æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
          if [ ! -f "theories/FRF_Comparative.v" ]; then
            echo "âš ï¸ FRF_Comparative.v ä¸å­˜åœ¨"
            exit 0
          fi
          
          # æ£€æŸ¥ä¾èµ–æ˜¯å¦å®Œæ•´
          echo "æ£€æŸ¥ä¾èµ–..."
          required_files=(
            "theories/FRF_MetaTheory.vo"
            "CS_Null/FRF_CS_Null_Common.vo"
            "SelfContainedLib/Algebra.vo"
            "SelfContainedLib/Category.vo"
          )
          
          missing_files=0
          for file in "${required_files[@]}"; do
            if [ ! -f "$file" ]; then
              echo "âŒ ç¼ºå°‘ä¾èµ–: $file"
              missing_files=1
            fi
          done
          
          if [ $missing_files -eq 1 ]; then
            echo "âŒ ç¼ºå°‘å¿…è¦çš„ä¾èµ–æ–‡ä»¶"
            exit 1
          fi
          
          echo "âœ… æ‰€æœ‰ä¾èµ–å°±ç»ª"
          
          # ç¼–è¯‘é›†æˆæ¨¡å—
          echo "å¼€å§‹ç¼–è¯‘ FRF_Comparative.v..."
          
          local log_file="build-logs/FRF_Comparative.log"
          local line_count=$(wc -l < "theories/FRF_Comparative.v" 2>/dev/null || echo 0)
          
          # è®¾ç½®ç¼–è¯‘å‚æ•°ï¼ˆå¤§æ–‡ä»¶å¤„ç†ï¼‰
          local extra_flags=""
          if [ $line_count -gt 4000 ]; then
            extra_flags="-m ${{ env.BIGFILE_MEMORY }} -async-proofs on -async-proofs-tac-j 6"
            echo "  å¤§æ–‡ä»¶æ£€æµ‹: $line_count è¡Œï¼Œä½¿ç”¨å¢å¼ºå‚æ•°"
          fi
          
          if timeout 25m coqc $COQFLAGS $extra_flags theories/FRF_Comparative.v 2>&1 | tee "$log_file"; then
            echo "âœ… FRF_Comparative.v ç¼–è¯‘æˆåŠŸ"
          else
            echo "âŒ FRF_Comparative.v ç¼–è¯‘å¤±è´¥"
            echo "=== æœ€å30è¡Œé”™è¯¯æ—¥å¿— ==="
            tail -30 "$log_file"
            exit 1
          fi

      - name: ğŸ“Š é›†æˆæ¨¡å—éªŒè¯
        run: |
          echo "=== é›†æˆæ¨¡å—éªŒè¯ ==="
          
          if [ -f "theories/FRF_Comparative.vo" ]; then
            size=$(stat -c%s "theories/FRF_Comparative.vo" 2>/dev/null || echo 0)
            lines=0
            if [ -f "theories/FRF_Comparative.v" ]; then
              lines=$(wc -l < "theories/FRF_Comparative.v" 2>/dev/null || echo 0)
            fi
            echo "  âœ… FRF_Comparative.vo"
            echo "    æ–‡ä»¶å¤§å°: ${size} bytes"
            echo "    æºä»£ç : $lines è¡Œ"
            
            echo ""
            echo "æ¨¡å—åŠŸèƒ½éªŒè¯..."
            
            # æ£€æŸ¥æŠ¥å‘Šç”Ÿæˆå‡½æ•°æ˜¯å¦å­˜åœ¨
            if grep -q "default_comparative_report\|Report\|report" theories/FRF_Comparative.v 2>/dev/null; then
              echo "  âœ… æŠ¥å‘Šç”ŸæˆåŠŸèƒ½å­˜åœ¨"
            else
              echo "  âš ï¸  æŠ¥å‘Šç”ŸæˆåŠŸèƒ½æœªæ˜ç¡®æ‰¾åˆ°"
            fi
            
            # æ£€æŸ¥å¯¼å‡ºé¡¹
            if [ -f "theories/FRF_Comparative.glob" ]; then
              export_count=$(grep -c "^[A-Z]" theories/FRF_Comparative.glob 2>/dev/null || echo 0)
              echo "  ğŸ“Š å¯¼å‡ºé¡¹: $export_count ä¸ª"
            fi
          else
            echo "  âŒ FRF_Comparative.vo ç¼ºå¤±"
          fi

      - name: ğŸ’¾ ä¿å­˜ç¼–è¯‘ç»“æœ
        uses: actions/upload-artifact@v3
        with:
          name: phase-5-compiled
          path: |
            SelfContainedLib/*.vo
            SelfContainedLib/*.glob
            theories/*.vo
            theories/*.glob
            Quantum/*.vo
            Quantum/*.glob
            CS_Null/*.vo
            CS_Null/*.glob
            build-logs/
          retention-days: 7

  compile-phase-6:
    name: ğŸ§ª é˜¶æ®µ6:æµ‹è¯•å¥—ä»¶ç¼–è¯‘
    needs: compile-phase-5
    runs-on: ubuntu-22.04
    timeout-minutes: 40
    env:
      COQFLAGS: "-Q SelfContainedLib SelfContainedLib -Q theories theories -Q Quantum Quantum -Q CS_Null CS_Null -Q Test Test"
    steps:
      - name: ğŸ“¥ æ£€å‡ºä»£ç 
        uses: actions/checkout@v4
        with:
          fetch-depth: 1

      - name: ğŸ“¥ æ¢å¤é˜¶æ®µ5ç»“æœ
        uses: actions/download-artifact@v3
        with:
          name: phase-5-compiled
          path: .

      - name: ğŸ”„ è®¾ç½®ç¯å¢ƒ
        run: |
          eval $(opam env)
          echo "COQFLAGS=${{ env.COQFLAGS }}" >> $GITHUB_ENV
          
          # åˆ›å»ºç›®å½•ç»“æ„
          mkdir -p SelfContainedLib theories Quantum CS_Null Test

      - name: ğŸ§ª æ£€æŸ¥æµ‹è¯•å¥—ä»¶
        run: |
          echo "=== æµ‹è¯•å¥—ä»¶æ£€æŸ¥ ==="
          echo "æµ‹è¯•ç›®å½•:"
          ls -la Test/ 2>/dev/null || echo "Testç›®å½•ä¸å­˜åœ¨"
          
          echo ""
          echo "æµ‹è¯•æ–‡ä»¶:"
          find Test -name "*.v" 2>/dev/null | head -20 || echo "æ— æµ‹è¯•æ–‡ä»¶"
          
          echo ""
          echo "æµ‹è¯•ç»Ÿè®¡:"
          test_count=$(find Test -name "*.v" 2>/dev/null | wc -l)
          echo "  æ€»æµ‹è¯•æ–‡ä»¶æ•°: $test_count"

      - name: ğŸ”§ ç¼–è¯‘æµ‹è¯•
        run: |
          eval $(opam env)
          
          # åˆ›å»ºç¼–è¯‘æ—¥å¿—ç›®å½•
          mkdir -p build-logs
          
          echo "ğŸ§ª ç¼–è¯‘æµ‹è¯•å¥—ä»¶..."
          
          # æ£€æŸ¥æµ‹è¯•æ–‡ä»¶æ˜¯å¦å­˜åœ¨
          test_files_count=0
          for file in Test/*.v 2>/dev/null; do
            test_files_count=1
            break
          done
          
          if [ $test_files_count -eq 0 ]; then
            echo "âš ï¸ æœªæ‰¾åˆ°æµ‹è¯•æ–‡ä»¶"
            exit 0
          fi
          
          # ç¼–è¯‘å‡½æ•°
          compile_test() {
            local file=$1
            local base=$(basename "$file" .v)
            local log_file="build-logs/test_${base}.log"
            
            echo "  æµ‹è¯•: $base.v..."
            
            # æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
            if [ ! -f "$file" ]; then
              echo "âŒ æ–‡ä»¶ä¸å­˜åœ¨: $file"
              return 1
            fi
            
            # è®¾ç½®ç¼–è¯‘å‚æ•°
            local extra_flags=""
            local line_count=$(wc -l < "$file" 2>/dev/null || echo 0)
            
            case $base in
              Test_FRF_MetaTheory|Test_BlockchainSystem)
                if [ $line_count -gt 2000 ]; then
                  extra_flags="-async-proofs on"
                  echo "    å¤§æµ‹è¯•æ–‡ä»¶ï¼Œä½¿ç”¨å¼‚æ­¥è¯æ˜"
                fi
                ;;
              Test_QuantumVacuum|SelfContainedVerification)
                if [ $line_count -gt 1000 ]; then
                  extra_flags=""
                fi
                ;;
            esac
            
            # æ‰§è¡Œç¼–è¯‘
            if timeout 10m coqc $COQFLAGS $extra_flags "$file" 2>&1 | tee "$log_file"; then
              echo "    âœ… $base.v ç¼–è¯‘æˆåŠŸ"
              return 0
            else
              echo "    âŒ $base.v ç¼–è¯‘å¤±è´¥"
              return 1
            fi
          }
          
          # ç¼–è¯‘æ‰€æœ‰æµ‹è¯•æ–‡ä»¶
          failed=0
          success=0
          total=0
          
          for file in Test/*.v 2>/dev/null; do
            total=$((total + 1))
            if compile_test "$file"; then
              success=$((success + 1))
            else
              failed=1
            fi
            
            # å°æ–‡ä»¶ä¹‹é—´çŸ­æš‚ä¼‘æ¯
            sleep 1
          done
          
          echo ""
          echo "æµ‹è¯•ç¼–è¯‘ç»Ÿè®¡: $success/$total ä¸ªæµ‹è¯•ç¼–è¯‘æˆåŠŸ"
          
          if [ $failed -eq 1 ]; then
            echo "âŒ æµ‹è¯•å¥—ä»¶ç¼–è¯‘æœ‰å¤±è´¥"
            exit 1
          fi
          
          echo "âœ… æµ‹è¯•å¥—ä»¶ç¼–è¯‘å®Œæˆ"

      - name: ğŸ“Š æµ‹è¯•ç¼–è¯‘ç»Ÿè®¡
        run: |
          echo "=== æµ‹è¯•å¥—ä»¶ç¼–è¯‘ç»Ÿè®¡ ==="
          
          total=0
          success=0
          
          for file in Test/*.vo 2>/dev/null; do
            if [ -f "$file" ]; then
              base=$(basename "$file" .vo)
              size=$(stat -c%s "$file" 2>/dev/null || echo 0)
              echo "  âœ… $base (${size} bytes)"
              success=$((success + 1))
            fi
            total=$((total + 1))
          done
          
          if [ $total -eq 0 ]; then
            echo "  æ— æµ‹è¯•æ–‡ä»¶"
          else
            echo ""
            echo "ç»Ÿè®¡: $success/$total ä¸ªæµ‹è¯•ç¼–è¯‘æˆåŠŸ"
            
            # æ£€æŸ¥æ˜¯å¦æœ‰æœªç¼–è¯‘çš„æµ‹è¯•æ–‡ä»¶
            for file in Test/*.v 2>/dev/null; do
              base=$(basename "$file" .v)
              if [ ! -f "Test/${base}.vo" ]; then
                echo "  âŒ $base.v (æœªç¼–è¯‘)"
              fi
            done
          fi

      - name: ğŸ’¾ ä¿å­˜ç¼–è¯‘ç»“æœ
        uses: actions/upload-artifact@v3
        with:
          name: phase-6-compiled
          path: |
            SelfContainedLib/*.vo
            SelfContainedLib/*.glob
            theories/*.vo
            theories/*.glob
            Quantum/*.vo
            Quantum/*.glob
            CS_Null/*.vo
            CS_Null/*.glob
            Test/*.vo
            Test/*.glob
            build-logs/
          retention-days: 7

  full-verification-report:
    name: ğŸ“‹ å…¨é‡éªŒè¯æŠ¥å‘Šç”Ÿæˆ
    needs: [compile-phase-1, compile-phase-2, compile-phase-3, compile-phase-4, compile-phase-5, compile-phase-6]
    if: always()
    runs-on: ubuntu-22.04
    steps:
      - name: ğŸ“¥ æ”¶é›†ç¼–è¯‘ç»“æœ
        run: |
          echo "=== æ”¶é›†å„é˜¶æ®µç¼–è¯‘ç»“æœ ==="
          
          # åˆ›å»ºæŠ¥å‘Šç›®å½•
          mkdir -p verification-report
          mkdir -p compilation-artifacts
          
          # ä¸‹è½½å„é˜¶æ®µç¼–è¯‘ç»“æœ
          for phase in 1 2 3 4 5 6; do
            echo "ä¸‹è½½é˜¶æ®µ $phase ç»“æœ..."
            mkdir -p "compilation-artifacts/phase-$phase"
            
            # å°è¯•ä¸‹è½½artifact
            if curl -s -H "Authorization: Bearer ${{ secrets.GITHUB_TOKEN }}" \
                   -H "Accept: application/vnd.github.v3+json" \
                   "https://api.github.com/repos/${{ github.repository }}/actions/artifacts" 2>/dev/null | \
                   grep -q "phase-$phase-compiled"; then
              echo "  é˜¶æ®µ $phase ç»“æœå¯ç”¨"
            else
              echo "  é˜¶æ®µ $phase ç»“æœä¸å¯ç”¨"
            fi
          done

      - name: ğŸ“¥ æ¢å¤æœ€åé˜¶æ®µç»“æœ
        uses: actions/download-artifact@v3
        with:
          name: phase-6-compiled
          path: compilation-artifacts/final
        continue-on-error: true

      - name: ğŸ“Š ç”ŸæˆéªŒè¯æŠ¥å‘Š
        run: |
          echo "ç”Ÿæˆå…¨é‡éªŒè¯æŠ¥å‘Š..."
          
          # ç»Ÿè®¡ç¼–è¯‘ç»“æœ
          TOTAL_FILES=0
          COMPILED_FILES=0
          HUGE_FILES=0
          HUGE_COMPILED=0
          
          # æ‰«ææ‰€æœ‰.væ–‡ä»¶
          for dir in SelfContainedLib theories Quantum CS_Null Test; do
            if [ -d "$dir" ]; then
              for file in $(find "$dir" -name "*.v" 2>/dev/null); do
                TOTAL_FILES=$((TOTAL_FILES + 1))
                base=$(basename "$file" .v)
                vo_file="${file%.v}.vo"
                
                if [ -f "$vo_file" ]; then
                  COMPILED_FILES=$((COMPILED_FILES + 1))
                  
                  # æ£€æŸ¥æ˜¯å¦æ˜¯å¤§æ–‡ä»¶
                  lines=$(wc -l < "$file" 2>/dev/null || echo 0)
                  if [ "$lines" -gt 3000 ]; then
                    HUGE_FILES=$((HUGE_FILES + 1))
                    HUGE_COMPILED=$((HUGE_COMPILED + 1))
                  fi
                else
                  # æ£€æŸ¥æ˜¯å¦æ˜¯å¤§æ–‡ä»¶
                  lines=$(wc -l < "$file" 2>/dev/null || echo 0)
                  if [ "$lines" -gt 3000 ]; then
                    HUGE_FILES=$((HUGE_FILES + 1))
                  fi
                fi
              done
            fi
          done
          
          # è®¡ç®—æˆåŠŸç‡
          SUCCESS_RATE=0
          if [ "$TOTAL_FILES" -gt 0 ]; then
            SUCCESS_RATE=$((COMPILED_FILES * 100 / TOTAL_FILES))
          fi
          
          # ç”ŸæˆMarkdownæŠ¥å‘Š
          cat > verification-report/FRF2_FULL_VERIFICATION_REPORT.md << EOF
      - name: ğŸ“Š ç”ŸæˆéªŒè¯æŠ¥å‘Š
        run: |
          echo "ç”Ÿæˆå…¨é‡éªŒè¯æŠ¥å‘Š..."
          
          # ç»Ÿè®¡ç¼–è¯‘ç»“æœ
          TOTAL_FILES=0
          COMPILED_FILES=0
          HUGE_FILES=0
          HUGE_COMPILED=0
          
          # æ‰«ææ‰€æœ‰.væ–‡ä»¶
          for dir in SelfContainedLib theories Quantum CS_Null Test; do
            if [ -d "$dir" ]; then
              for file in $(find "$dir" -name "*.v" 2>/dev/null); do
                TOTAL_FILES=$((TOTAL_FILES + 1))
                base=$(basename "$file" .v)
                vo_file="${file%.v}.vo"
                
                if [ -f "$vo_file" ]; then
                  COMPILED_FILES=$((COMPILED_FILES + 1))
                  
                  # æ£€æŸ¥æ˜¯å¦æ˜¯å¤§æ–‡ä»¶
                  lines=$(wc -l < "$file" 2>/dev/null || echo 0)
                  if [ "$lines" -gt 3000 ]; then
                    HUGE_FILES=$((HUGE_FILES + 1))
                    HUGE_COMPILED=$((HUGE_COMPILED + 1))
                  fi
                else
                  # æ£€æŸ¥æ˜¯å¦æ˜¯å¤§æ–‡ä»¶
                  lines=$(wc -l < "$file" 2>/dev/null || echo 0)
                  if [ "$lines" -gt 3000 ]; then
                    HUGE_FILES=$((HUGE_FILES + 1))
                  fi
                fi
              done
            fi
          done
          
          # è®¡ç®—æˆåŠŸç‡
          SUCCESS_RATE=0
          if [ "$TOTAL_FILES" -gt 0 ]; then
            SUCCESS_RATE=$((COMPILED_FILES * 100 / TOTAL_FILES))
          fi
          
          # ç”ŸæˆMarkdownæŠ¥å‘Š
          cat > verification-report/FRF2_FULL_VERIFICATION_REPORT.md << 'EOF'
# FRF 2.0 å…¨é‡å½¢å¼åŒ–éªŒè¯æŠ¥å‘Š

## éªŒè¯æ¦‚è§ˆ
EOF

          # å†™å…¥åŠ¨æ€æ•°æ®
          echo "- **éªŒè¯æ—¶é—´**: $(date)" >> verification-report/FRF2_FULL_VERIFICATION_REPORT.md
          echo "- **ç¯å¢ƒ**: Ubuntu 22.04" >> verification-report/FRF2_FULL_VERIFICATION_REPORT.md
          echo "- **æ€»æ–‡ä»¶æ•°**: $TOTAL_FILES" >> verification-report/FRF2_FULL_VERIFICATION_REPORT.md
          echo "- **ç¼–è¯‘æˆåŠŸ**: $COMPILED_FILES" >> verification-report/FRF2_FULL_VERIFICATION_REPORT.md
          echo "- **ç¼–è¯‘æˆåŠŸç‡**: ${SUCCESS_RATE}%" >> verification-report/FRF2_FULL_VERIFICATION_REPORT.md
          echo "- **å¤§æ–‡ä»¶(>3000è¡Œ)**: $HUGE_FILES" >> verification-report/FRF2_FULL_VERIFICATION_REPORT.md
          echo "- **å¤§æ–‡ä»¶ç¼–è¯‘æˆåŠŸ**: $HUGE_COMPILED" >> verification-report/FRF2_FULL_VERIFICATION_REPORT.md
          
          cat >> verification-report/FRF2_FULL_VERIFICATION_REPORT.md << 'EOF'

## æ¨¡å—ç¼–è¯‘çŠ¶æ€

### å±‚çº§1:è‡ªåŒ…å«åŸºç¡€åº“
| æ¨¡å— | çŠ¶æ€ | è¡Œæ•° | å®æ•°ä¾èµ– |
|------|------|------|----------|
EOF
          
          # åŸºç¡€åº“çŠ¶æ€
          for file in SelfContainedLib/*.v 2>/dev/null; do
            if [ -f "$file" ]; then
              base=$(basename "$file" .v)
              lines=$(wc -l < "$file" 2>/dev/null || echo 0)
              status="âŒ"
              if [ -f "${file%.v}.vo" ]; then
                status="âœ…"
              fi
              
              real_dep="å¦"
              if grep -q "Require.*Reals\|Require Import Reals" "$file" 2>/dev/null; then
                real_dep="æ˜¯"
              fi
              
              echo "| $base | $status | $lines | $real_dep |" >> verification-report/FRF2_FULL_VERIFICATION_REPORT.md
            fi
          done
          
          cat >> verification-report/FRF2_FULL_VERIFICATION_REPORT.md << 'EOF'

### å±‚çº§2: FRFå…ƒç†è®º
| æ¨¡å— | çŠ¶æ€ | è¡Œæ•° | å®æ•°ä¾èµ– |
|------|------|------|----------|
EOF
          
          # å…ƒç†è®ºçŠ¶æ€
          for file in theories/*.v 2>/dev/null; do
            if [ -f "$file" ]; then
              base=$(basename "$file" .v)
              lines=$(wc -l < "$file" 2>/dev/null || echo 0)
              status="âŒ"
              if [ -f "${file%.v}.vo" ]; then
                status="âœ…"
              fi
              
              real_dep="å¦"
              if grep -q "Require.*Reals\|Require Import Reals" "$file" 2>/dev/null; then
                real_dep="æ˜¯"
              fi
              
              echo "| $base | $status | $lines | $real_dep |" >> verification-report/FRF2_FULL_VERIFICATION_REPORT.md
            fi
          done
          
          cat >> verification-report/FRF2_FULL_VERIFICATION_REPORT.md << 'EOF'

### å±‚çº§3: æ•°å­¦åœºæ™¯å±‚
| åœºæ™¯ | çŠ¶æ€ | è¡Œæ•° | ç±»å‹ |
|------|------|------|------|
EOF
          
          # åœºæ™¯å±‚çŠ¶æ€
          for pattern in CaseA CaseB CaseC CaseD CaseE; do
            for file in theories/${pattern}_*.v 2>/dev/null; do
              if [ -f "$file" ]; then
                base=$(basename "$file" .v)
                lines=$(wc -l < "$file" 2>/dev/null || echo 0)
                status="âŒ"
                if [ -f "${file%.v}.vo" ]; then
                  status="âœ…"
                fi
                
                echo "| $base | $status | $lines | $pattern |" >> verification-report/FRF2_FULL_VERIFICATION_REPORT.md
              fi
            done
          done
          
          cat >> verification-report/FRF2_FULL_VERIFICATION_REPORT.md << 'EOF'

### å±‚çº§4: é‡å­æ¨¡å—
| æ¨¡å— | çŠ¶æ€ | è¡Œæ•° | åŠŸèƒ½ |
|------|------|------|------|
EOF
          
          # é‡å­æ¨¡å—çŠ¶æ€
          for file in Quantum/*.v 2>/dev/null; do
            if [ -f "$file" ]; then
              base=$(basename "$file" .v)
              lines=$(wc -l < "$file" 2>/dev/null || echo 0)
              status="âŒ"
              if [ -f "${file%.v}.vo" ]; then
                status="âœ…"
              fi
              
              # ç®€å•æè¿°
              desc="é‡å­æ¨¡å—"
              if [[ "$base" == *"QFT"* ]]; then
                desc="é‡å­åœºè®º"
              elif [[ "$base" == *"Curved"* ]]; then
                desc="å¼¯æ›²æ—¶ç©ºé‡å­"
              fi
              
              echo "| $base | $status | $lines | $desc |" >> verification-report/FRF2_FULL_VERIFICATION_REPORT.md
            fi
          done
          
          cat >> verification-report/FRF2_FULL_VERIFICATION_REPORT.md << 'EOF'

### å±‚çº§4: ç©ºå€¼ç³»ç»Ÿ
| æ¨¡å— | çŠ¶æ€ | è¡Œæ•° | è¯­è¨€ |
|------|------|------|------|
EOF
          
          # ç©ºå€¼ç³»ç»ŸçŠ¶æ€
          for file in CS_Null/*.v 2>/dev/null; do
            if [ -f "$file" ]; then
              base=$(basename "$file" .v)
              lines=$(wc -l < "$file" 2>/dev/null || echo 0)
              status="âŒ"
              if [ -f "${file%.v}.vo" ]; then
                status="âœ…"
              fi
              
              # åˆ¤æ–­è¯­è¨€
              lang="é€šç”¨"
              for l in Cxx Python Java Math Rust; do
                if [[ "$base" == *"$l"* ]]; then
                  lang="$l"
                  break
                fi
              done
              
              echo "| $base | $status | $lines | $lang |" >> verification-report/FRF2_FULL_VERIFICATION_REPORT.md
            fi
          done
          
          cat >> verification-report/FRF2_FULL_VERIFICATION_REPORT.md << 'EOF'

### å±‚çº§5: é›†æˆæ¨¡å—
| æ¨¡å— | çŠ¶æ€ | è¡Œæ•° | åŠŸèƒ½ |
|------|------|------|------|
EOF
          
          # é›†æˆæ¨¡å—çŠ¶æ€
          if [ -f "theories/FRF_Comparative.v" ]; then
            lines=$(wc -l < "theories/FRF_Comparative.v" 2>/dev/null || echo 0)
            status="âŒ"
            if [ -f "theories/FRF_Comparative.vo" ]; then
              status="âœ…"
            fi
            echo "| FRF_Comparative | $status | $lines | è·¨ç³»ç»Ÿå¯¹æ¯”æ ¸å¿ƒ |" >> verification-report/FRF2_FULL_VERIFICATION_REPORT.md
          fi
          
          cat >> verification-report/FRF2_FULL_VERIFICATION_REPORT.md << 'EOF'

### å±‚çº§6: æµ‹è¯•å¥—ä»¶
| æµ‹è¯• | çŠ¶æ€ | è¡Œæ•° | æµ‹è¯•ç›®æ ‡ |
|------|------|------|----------|
EOF
          
          # æµ‹è¯•å¥—ä»¶çŠ¶æ€
          for file in Test/*.v 2>/dev/null; do
            if [ -f "$file" ]; then
              base=$(basename "$file" .v)
              lines=$(wc -l < "$file" 2>/dev/null || echo 0)
              status="âŒ"
              if [ -f "${file%.v}.vo" ]; then
                status="âœ…"
              fi
              
              target="åŸºç¡€æµ‹è¯•"
              if [[ "$base" == *"MetaTheory"* ]]; then
                target="å…ƒç†è®ºæµ‹è¯•"
              elif [[ "$base" == *"Quantum"* ]]; then
                target="é‡å­æ¨¡å—æµ‹è¯•"
              elif [[ "$base" == *"Blockchain"* ]]; then
                target="åŒºå—é“¾ç³»ç»Ÿæµ‹è¯•"
              fi
              
              echo "| $base | $status | $lines | $target |" >> verification-report/FRF2_FULL_VERIFICATION_REPORT.md
            fi
          done
          
          # æ·»åŠ æ€»ç»“
          cat >> verification-report/FRF2_FULL_VERIFICATION_REPORT.md << 'EOF'

## éªŒè¯æ€»ç»“
EOF
          
          if [ "$COMPILED_FILES" -eq "$TOTAL_FILES" ] && [ "$TOTAL_FILES" -gt 0 ]; then
            echo "ğŸ‰ **æ‰€æœ‰æ¨¡å—ç¼–è¯‘æˆåŠŸï¼**" >> verification-report/FRF2_FULL_VERIFICATION_REPORT.md
            echo "FRF 2.0 å½¢å¼åŒ–éªŒè¯å®Œå…¨é€šè¿‡ã€‚" >> verification-report/FRF2_FULL_VERIFICATION_REPORT.md
          else
            echo "âš ï¸  **éƒ¨åˆ†æ¨¡å—ç¼–è¯‘å¤±è´¥**" >> verification-report/FRF2_FULL_VERIFICATION_REPORT.md
            FAILED_COUNT=$((TOTAL_FILES - COMPILED_FILES))
            echo "å¤±è´¥æ–‡ä»¶æ•°: $FAILED_COUNT" >> verification-report/FRF2_FULL_VERIFICATION_REPORT.md
            
            if [ "$FAILED_COUNT" -gt 0 ]; then
              echo "" >> verification-report/FRF2_FULL_VERIFICATION_REPORT.md
              echo "### å¤±è´¥æ–‡ä»¶åˆ—è¡¨" >> verification-report/FRF2_FULL_VERIFICATION_REPORT.md
              for dir in SelfContainedLib theories Quantum CS_Null Test; do
                if [ -d "$dir" ]; then
                  for file in $(find "$dir" -name "*.v" 2>/dev/null); do
                    vo_file="${file%.v}.vo"
                    if [ ! -f "$vo_file" ]; then
                      echo "- $file" >> verification-report/FRF2_FULL_VERIFICATION_REPORT.md
                    fi
                  done
                fi
              done
            fi
          fi
          
          cat >> verification-report/FRF2_FULL_VERIFICATION_REPORT.md << 'EOF'

## ç¯å¢ƒä¿¡æ¯
- **ç³»ç»Ÿ**: Ubuntu 22.04
- **CPUæ ¸å¿ƒ**: ${{ env.CORE_COUNT }}
- **å†…å­˜**: ${{ env.AVAIL_MEM }}MB å¯ç”¨ï¼Œ${{ env.COQ_MEMORY }}MB åˆ†é…
- **Coqç‰ˆæœ¬**: 8.18.0
- **mathcompç‰ˆæœ¬**: å®Œæ•´å®‰è£…
- **éªŒè¯æ—¶é—´**: $(date '+%Y-%m-%d %H:%M:%S')

## æ€§èƒ½ç»Ÿè®¡
- **ç¼–è¯‘é˜¶æ®µ**: 6ä¸ªé˜¶æ®µ
- **æ€»è¶…æ—¶æ—¶é—´**: çº¦240åˆ†é’Ÿ
- **å¤§æ–‡ä»¶å¤„ç†**: $HUGE_COMPILED/$HUGE_FILES ä¸ªå¤§æ–‡ä»¶ç¼–è¯‘æˆåŠŸ
- **å¹¶è¡Œç¼–è¯‘**: ${{ env.PARALLEL_JOBS }} ä¸ªå¹¶è¡Œä»»åŠ¡

---
*æŠ¥å‘Šç”Ÿæˆæ—¶é—´: $(date)*
*éªŒè¯æµæ°´çº¿: ${{ github.run_id }}*
EOF
          
          echo "âœ… éªŒè¯æŠ¥å‘Šç”Ÿæˆå®Œæˆ"
          echo "æŠ¥å‘Šä½ç½®: verification-report/FRF2_FULL_VERIFICATION_REPORT.md"