name: FRF 2.0 全量形式化验证（完整版）

on:
  push:
    branches: [main, master]
  pull_request:
    branches: [main, master]
  workflow_dispatch:

jobs:
  full-formal-verification:
    runs-on: ubuntu-22.04
    timeout-minutes: 240
    
    steps:
    - name: 📥 检出代码仓库
      uses: actions/checkout@v4
      with:
        fetch-depth: 1
        submodules: false

    - name: 🖥️ 系统信息检查
      run: |
        echo "=== 系统信息 ==="
        echo "系统: $(uname -a)"
        echo "CPU核心: $(nproc)"
        echo "内存: $(free -m | awk '/^Mem:/{print "总量:" $2 "MB, 可用:" $7 "MB"}')"
        echo "磁盘:"
        df -h
        echo ""
        echo "检查.v文件:"
        find . -name "*.v" -type f | wc -l | xargs echo "总.v文件数:"

    - name: 📦 安装系统依赖
      run: |
        echo "安装系统依赖..."
        sudo apt-get update
        sudo apt-get install -y \
          opam \
          bubblewrap \
          g++ \
          pkg-config \
          m4 \
          rsync \
          git \
          wget \
          bc
        echo "✅ 系统依赖安装完成"

    - name: 🔄 初始化OPAM环境
      timeout-minutes: 20
      run: |
        echo "初始化OPAM环境..."
        opam init --disable-sandboxing -y --compiler=4.14.0
        eval $(opam env)
        opam repo add coq-released https://coq.inria.fr/opam/released
        opam update
        echo "✅ OPAM环境初始化完成"

    - name: 📚 安装Coq 8.18.0
      timeout-minutes: 25
      run: |
        eval $(opam env)
        echo "安装Coq 8.18.0..."
        opam install -y --no-depexts coq.8.18.0
        echo "验证安装:"
        coqc --version

    - name: 📚 安装mathcomp-ssreflect
      timeout-minutes: 15
      run: |
        eval $(opam env)
        echo "安装mathcomp-ssreflect 1.17.0..."
        opam install -y --no-depexts coq-mathcomp-ssreflect=1.17.0
        echo "验证mathcomp安装:"
        opam list --installed | grep mathcomp

    - name: 🚀 执行全量编译（优化版）
      timeout-minutes: 180
      run: |
        eval $(opam env)
        echo "开始全量编译..."
        echo "当前时间: $(date)"
        echo ""
        
        # 设置基础编译参数
        BASE_FLAGS="-w -deprecated"
        
        # 定义成功编译的模块列表
        SUCCESS_MODULES=()
        FAILED_MODULES=()
        
        # 编译函数
        compile_module() {
          local file="$1"
          local flags="$2"
          local desc="$3"
          
          echo ""
          echo "🔧 编译: $(basename $file) - $desc"
          echo "命令: coqc $flags $file"
          
          if coqc $flags "$file"; then
            echo "✅ 编译成功: $(basename $file)"
            SUCCESS_MODULES+=("$(basename $file)")
            return 0
          else
            echo "❌ 编译失败: $(basename $file)"
            FAILED_MODULES+=("$(basename $file)")
            return 1
          fi
        }
        
        echo "=== 层级1：自包含基础库 ==="
        compile_module "SelfContainedLib/Algebra.v" "-Q SelfContainedLib SelfContainedLib $BASE_FLAGS" "代数基础"
        compile_module "SelfContainedLib/Category.v" "-Q SelfContainedLib SelfContainedLib $BASE_FLAGS" "范畴论基础"
        compile_module "SelfContainedLib/Geometry.v" "-Q SelfContainedLib SelfContainedLib $BASE_FLAGS -async-proofs on -async-proofs-tac-j 4 -m 4096" "几何基础（大文件）"
        
        echo ""
        echo "=== 层级2：FRF元理论层 ==="
        compile_module "theories/FRF_MetaTheory.v" "-Q SelfContainedLib SelfContainedLib -Q theories FRF.Theories $BASE_FLAGS -async-proofs on -async-proofs-tac-j 4 -m 4096" "FRF元理论核心（大文件）"
        compile_module "theories/ChurchZero.v" "-Q SelfContainedLib SelfContainedLib -Q theories FRF.Theories $BASE_FLAGS" "Church零理论"
        compile_module "theories/ChurchNumerals.v" "-Q SelfContainedLib SelfContainedLib -Q theories FRF.Theories $BASE_FLAGS -async-proofs on -async-proofs-tac-j 4 -m 8192" "Church数理论（极大文件）"
        
        echo ""
        echo "=== 层级3：数学场景层 ==="
        compile_module "theories/CaseA_SetTheory.v" "-Q SelfContainedLib SelfContainedLib -Q theories FRF.Theories $BASE_FLAGS" "集合论场景"
        compile_module "theories/CaseB_Algebra.v" "-Q SelfContainedLib SelfContainedLib -Q theories FRF.Theories $BASE_FLAGS" "代数场景"
        compile_module "theories/CaseC_TypeTheory.v" "-Q SelfContainedLib SelfContainedLib -Q theories FRF.Theories $BASE_FLAGS" "类型论场景"
        compile_module "theories/CaseD_CategoryTheory.v" "-Q SelfContainedLib SelfContainedLib -Q theories FRF.Theories $BASE_FLAGS" "范畴论场景"
        compile_module "theories/CaseE_QuantumVacuum.v" "-Q SelfContainedLib SelfContainedLib -Q theories FRF.Theories $BASE_FLAGS -async-proofs on -async-proofs-tac-j 4 -m 4096" "量子真空态场景（大文件）"
        
        echo ""
        echo "=== 层级4：量子模块 ==="
        compile_module "Quantum/QFT_FRF.v" "-Q SelfContainedLib SelfContainedLib -Q theories FRF.Theories -Q Quantum Quantum $BASE_FLAGS" "量子场论核心"
        compile_module "Quantum/CurvedSpacetimeQFT.v" "-Q SelfContainedLib SelfContainedLib -Q theories FRF.Theories -Q Quantum Quantum $BASE_FLAGS" "弯曲时空量子场论"
        
        echo ""
        echo "=== 层级4：空值系统模块 ==="
        compile_module "CS_Null/FRF_CS_Null_Common.v" "-Q SelfContainedLib SelfContainedLib -Q theories FRF.Theories -Q CS_Null FRF.CS_Null $BASE_FLAGS -async-proofs on -async-proofs-tac-j 4 -m 8192" "空值系统基础（极大文件）"
        compile_module "CS_Null/FRF_CS_Null.v" "-Q SelfContainedLib SelfContainedLib -Q theories FRF.Theories -Q CS_Null FRF.CS_Null $BASE_FLAGS" "空值系统集成分析"
        compile_module "CS_Null/CxxNull.v" "-Q SelfContainedLib SelfContainedLib -Q theories FRF.Theories -Q CS_Null FRF.CS_Null $BASE_FLAGS" "C++空值"
        compile_module "CS_Null/PythonNull.v" "-Q SelfContainedLib SelfContainedLib -Q theories FRF.Theories -Q CS_Null FRF.CS_Null $BASE_FLAGS" "Python空值"
        compile_module "CS_Null/JavaNull.v" "-Q SelfContainedLib SelfContainedLib -Q theories FRF.Theories -Q CS_Null FRF.CS_Null $BASE_FLAGS" "Java空值"
        compile_module "CS_Null/MathNull.v" "-Q SelfContainedLib SelfContainedLib -Q theories FRF.Theories -Q CS_Null FRF.CS_Null $BASE_FLAGS" "数学计算空值"
        compile_module "CS_Null/RustNull.v" "-Q SelfContainedLib SelfContainedLib -Q theories FRF.Theories -Q CS_Null FRF.CS_Null $BASE_FLAGS" "Rust安全空值"
        
        echo ""
        echo "=== 层级5：集成模块 ==="
        compile_module "theories/FRF_Comparative.v" "-Q SelfContainedLib SelfContainedLib -Q theories FRF.Theories -Q Quantum Quantum -Q CS_Null FRF.CS_Null $BASE_FLAGS -async-proofs on -async-proofs-tac-j 4 -m 8192" "FRF跨系统对比核心（大文件）"
        
        echo ""
        echo "=== 层级6：测试套件 ==="
        compile_module "Test/Test_Basic.v" "-Q SelfContainedLib SelfContainedLib -Q theories FRF.Theories -Q Quantum Quantum -Q CS_Null FRF.CS_Null -Q Test FRF.Test $BASE_FLAGS" "基础测试"
        compile_module "Test/Test_FRF_MetaTheory.v" "-Q SelfContainedLib SelfContainedLib -Q theories FRF.Theories -Q Quantum Quantum -Q CS_Null FRF.CS_Null -Q Test FRF.Test $BASE_FLAGS" "FRF元理论测试"
        compile_module "Test/Test_QuantumVacuum.v" "-Q SelfContainedLib SelfContainedLib -Q theories FRF.Theories -Q Quantum Quantum -Q CS_Null FRF.CS_Null -Q Test FRF.Test $BASE_FLAGS" "量子真空态测试"
        compile_module "Test/Test_BlockchainSystem.v" "-Q SelfContainedLib SelfContainedLib -Q theories FRF.Theories -Q Quantum Quantum -Q CS_Null FRF.CS_Null -Q Test FRF.Test $BASE_FLAGS" "区块链系统测试"
        compile_module "Test/SelfContainedVerification.v" "-Q SelfContainedLib SelfContainedLib -Q theories FRF.Theories -Q Quantum Quantum -Q CS_Null FRF.CS_Null -Q Test FRF.Test $BASE_FLAGS" "自包含模块验证"
        
        echo ""
        echo "=== 编译完成 ==="
        echo "当前时间: $(date)"
        echo ""
        echo "📊 编译结果统计:"
        echo "✅ 成功编译: ${#SUCCESS_MODULES[@]} 个模块"
        echo "❌ 编译失败: ${#FAILED_MODULES[@]} 个模块"
        echo ""
        
        if [ ${#FAILED_MODULES[@]} -gt 0 ]; then
          echo "❌ 编译失败的模块:"
          for module in "${FAILED_MODULES[@]}"; do
            echo "  - $module"
          done
          echo ""
          echo "❌ 编译未完成，退出工作流"
          exit 1
        else
          echo "🎉 所有模块编译成功！"
          echo ""
          echo "✅ 成功编译的模块列表:"
          for module in "${SUCCESS_MODULES[@]}"; do
            echo "  - $module"
          done
        fi

    - name: 📊 编译结果验证
      run: |
        echo "=== 编译结果验证 ==="
        echo ""
        
        # 定义所有模块
        ALL_MODULES=(
          # 层级1
          "SelfContainedLib/Algebra.vo"
          "SelfContainedLib/Category.vo"
          "SelfContainedLib/Geometry.vo"
          
          # 层级2
          "theories/FRF_MetaTheory.vo"
          "theories/ChurchZero.vo"
          "theories/ChurchNumerals.vo"
          
          # 层级3
          "theories/CaseA_SetTheory.vo"
          "theories/CaseB_Algebra.vo"
          "theories/CaseC_TypeTheory.vo"
          "theories/CaseD_CategoryTheory.vo"
          "theories/CaseE_QuantumVacuum.vo"
          
          # 层级4
          "Quantum/QFT_FRF.vo"
          "Quantum/CurvedSpacetimeQFT.vo"
          "CS_Null/FRF_CS_Null_Common.vo"
          "CS_Null/FRF_CS_Null.vo"
          "CS_Null/CxxNull.vo"
          "CS_Null/PythonNull.vo"
          "CS_Null/JavaNull.vo"
          "CS_Null/MathNull.vo"
          "CS_Null/RustNull.vo"
          
          # 层级5
          "theories/FRF_Comparative.vo"
          
          # 层级6
          "Test/Test_Basic.vo"
          "Test/Test_FRF_MetaTheory.vo"
          "Test/Test_QuantumVacuum.vo"
          "Test/Test_BlockchainSystem.vo"
          "Test/SelfContainedVerification.vo"
        )
        
        # 大文件列表
        HUGE_MODULES=(
          "Geometry.vo"
          "FRF_MetaTheory.vo"
          "ChurchNumerals.vo"
          "CaseE_QuantumVacuum.vo"
          "FRF_CS_Null_Common.vo"
          "FRF_Comparative.vo"
        )
        
        echo "检查.vo文件生成情况:"
        echo ""
        
        success_count=0
        huge_success_count=0
        
        for vo_file in "${ALL_MODULES[@]}"; do
          if [ -f "$vo_file" ]; then
            module_name=$(basename "$vo_file")
            size=$(stat -c%s "$vo_file" 2>/dev/null || echo 0)
            echo "  ✅ $vo_file (${size} bytes)"
            success_count=$((success_count + 1))
            
            # 检查是否为大文件
            for huge in "${HUGE_MODULES[@]}"; do
              if [ "$module_name" = "$huge" ]; then
                huge_success_count=$((huge_success_count + 1))
                echo "     🔴 大文件编译成功!"
                break
              fi
            done
          else
            echo "  ❌ $vo_file 缺失"
          fi
        done
        
        echo ""
        echo "📊 验证统计:"
        echo "总模块数: ${#ALL_MODULES[@]}"
        echo "成功编译: $success_count"
        echo "大文件成功编译: $huge_success_count/${#HUGE_MODULES[@]}"
        
        if [ $success_count -eq ${#ALL_MODULES[@]} ]; then
          echo "🎉 所有模块验证通过!"
        else
          echo "⚠️  有 $((${#ALL_MODULES[@]} - success_count)) 个模块未通过验证"
        fi

    - name: 📄 生成详细报告
      run: |
        echo "生成详细验证报告..."
        
        # 创建报告目录
        mkdir -p verification-reports
        
        # 开始生成报告
        echo "# FRF 2.0 全量形式化编译报告" > verification-reports/FRF_FULL_COMPILATION_REPORT.md
        echo "" >> verification-reports/FRF_FULL_COMPILATION_REPORT.md
        
        echo "## 编译概述" >> verification-reports/FRF_FULL_COMPILATION_REPORT.md
        echo "- **编译时间**: $(date)" >> verification-reports/FRF_FULL_COMPILATION_REPORT.md
        echo "- **运行环境**: GitHub Actions (Ubuntu 22.04)" >> verification-reports/FRF_FULL_COMPILATION_REPORT.md
        COQ_VERSION=$(coqc --version 2>/dev/null | head -1 || echo "未知")
        echo "- **Coq版本**: $COQ_VERSION" >> verification-reports/FRF_FULL_COMPILATION_REPORT.md
        echo "- **总编译文件数**: 27个核心模块" >> verification-reports/FRF_FULL_COMPILATION_REPORT.md
        echo "- **编译状态**: 全量编译" >> verification-reports/FRF_FULL_COMPILATION_REPORT.md
        echo "" >> verification-reports/FRF_FULL_COMPILATION_REPORT.md
        
        # 成功编译模块列表
        echo "## ✅ 成功编译的模块列表" >> verification-reports/FRF_FULL_COMPILATION_REPORT.md
        echo "" >> verification-reports/FRF_FULL_COMPILATION_REPORT.md
        
        # 检查并列出所有成功编译的模块
        modules=(
          # 层级1
          "Algebra" "Category" "Geometry"
          # 层级2
          "FRF_MetaTheory" "ChurchZero" "ChurchNumerals"
          # 层级3
          "CaseA_SetTheory" "CaseB_Algebra" "CaseC_TypeTheory" "CaseD_CategoryTheory" "CaseE_QuantumVacuum"
          # 层级4 - 量子
          "QFT_FRF" "CurvedSpacetimeQFT"
          # 层级4 - 空值系统
          "FRF_CS_Null_Common" "FRF_CS_Null" "CxxNull" "PythonNull" "JavaNull" "MathNull" "RustNull"
          # 层级5
          "FRF_Comparative"
          # 层级6
          "Test_Basic" "Test_FRF_MetaTheory" "Test_QuantumVacuum" "Test_BlockchainSystem" "SelfContainedVerification"
        )
        
        dirs=(
          "SelfContainedLib" "SelfContainedLib" "SelfContainedLib"
          "theories" "theories" "theories"
          "theories" "theories" "theories" "theories" "theories"
          "Quantum" "Quantum"
          "CS_Null" "CS_Null" "CS_Null" "CS_Null" "CS_Null" "CS_Null" "CS_Null"
          "theories"
          "Test" "Test" "Test" "Test" "Test"
        )
        
        total_modules=${#modules[@]}
        success_count=0
        
        echo "| 模块 | 层级 | 状态 | 文件大小 |" >> verification-reports/FRF_FULL_COMPILATION_REPORT.md
        echo "|------|------|------|----------|" >> verification-reports/FRF_FULL_COMPILATION_REPORT.md
        
        for i in "${!modules[@]}"; do
          module="${modules[$i]}"
          dir="${dirs[$i]}"
          vo_file="$dir/$module.vo"
          
          if [ -f "$vo_file" ]; then
            size=$(stat -c%s "$vo_file" 2>/dev/null || echo 0)
            size_kb=$((size / 1024))
            
            # 确定层级
            if [[ $i -lt 3 ]]; then
              level="层级1 - 基础库"
            elif [[ $i -lt 6 ]]; then
              level="层级2 - FRF元理论"
            elif [[ $i -lt 11 ]]; then
              level="层级3 - 数学场景"
            elif [[ $i -lt 13 ]]; then
              level="层级4 - 量子模块"
            elif [[ $i -lt 20 ]]; then
              level="层级4 - 空值系统"
            elif [[ $i -lt 21 ]]; then
              level="层级5 - 集成模块"
            else
              level="层级6 - 测试套件"
            fi
            
            # 标记大文件
            huge_files=("Geometry" "FRF_MetaTheory" "ChurchNumerals" "CaseE_QuantumVacuum" "FRF_CS_Null_Common" "FRF_Comparative")
            is_huge=""
            for huge in "${huge_files[@]}"; do
              if [ "$module" = "$huge" ]; then
                is_huge=" 🔴"
                break
              fi
            done
            
            echo "| $module.v$is_huge | $level | ✅ 成功 | ${size_kb}KB |" >> verification-reports/FRF_FULL_COMPILATION_REPORT.md
            success_count=$((success_count + 1))
          else
            echo "| $module.v | 未知 | ❌ 失败 | - |" >> verification-reports/FRF_FULL_COMPILATION_REPORT.md
          fi
        done
        
        echo "" >> verification-reports/FRF_FULL_COMPILATION_REPORT.md
        
        # 大文件特别报告
        echo "## 🔴 大文件编译状态" >> verification-reports/FRF_FULL_COMPILATION_REPORT.md
        echo "" >> verification-reports/FRF_FULL_COMPILATION_REPORT.md
        
        huge_files=(
          "SelfContainedLib/Geometry.vo"
          "theories/FRF_MetaTheory.vo"
          "theories/ChurchNumerals.vo"
          "theories/CaseE_QuantumVacuum.vo"
          "CS_Null/FRF_CS_Null_Common.vo"
          "theories/FRF_Comparative.vo"
        )
        
        huge_success=0
        for file in "${huge_files[@]}"; do
          if [ -f "$file" ]; then
            size=$(stat -c%s "$file" 2>/dev/null || echo 0)
            size_mb=$((size / 1048576))
            if [ $size_mb -eq 0 ]; then
              size_kb=$((size / 1024))
              echo "- ✅ **$(basename "$file")** - 编译成功 (${size_kb}KB)" >> verification-reports/FRF_FULL_COMPILATION_REPORT.md
            else
              echo "- ✅ **$(basename "$file")** - 编译成功 (${size_mb}MB)" >> verification-reports/FRF_FULL_COMPILATION_REPORT.md
            fi
            huge_success=$((huge_success + 1))
          else
            echo "- ❌ **$(basename "$file" .vo).v** - 编译失败" >> verification-reports/FRF_FULL_COMPILATION_REPORT.md
          fi
        done
        
        echo "" >> verification-reports/FRF_FULL_COMPILATION_REPORT.md
        
        # 统计摘要
        success_rate=$((success_count * 100 / total_modules))
        huge_rate=$((huge_success * 100 / ${#huge_files[@]}))
        
        echo "## 📊 统计摘要" >> verification-reports/FRF_FULL_COMPILATION_REPORT.md
        echo "- **总模块数**: $total_modules" >> verification-reports/FRF_FULL_COMPILATION_REPORT.md
        echo "- **编译成功数**: $success_count" >> verification-reports/FRF_FULL_COMPILATION_REPORT.md
        echo "- **编译成功率**: $success_rate%" >> verification-reports/FRF_FULL_COMPILATION_REPORT.md
        echo "- **大文件总数**: ${#huge_files[@]}" >> verification-reports/FRF_FULL_COMPILATION_REPORT.md
        echo "- **大文件成功数**: $huge_success" >> verification-reports/FRF_FULL_COMPILATION_REPORT.md
        echo "- **大文件成功率**: $huge_rate%" >> verification-reports/FRF_FULL_COMPILATION_REPORT.md
        echo "" >> verification-reports/FRF_FULL_COMPILATION_REPORT.md
        
        # 结论
        echo "## 🎉 结论" >> verification-reports/FRF_FULL_COMPILATION_REPORT.md
        if [ $success_count -eq $total_modules ]; then
          echo "**FRF 2.0 全量形式化编译完全成功！**" >> verification-reports/FRF_FULL_COMPILATION_REPORT.md
          echo "" >> verification-reports/FRF_FULL_COMPILATION_REPORT.md
          echo "所有27个核心模块均已成功编译，包括6个大文件也成功编译。项目架构完整，形式化验证基础就绪。" >> verification-reports/FRF_FULL_COMPILATION_REPORT.md
          echo "" >> verification-reports/FRF_FULL_COMPILATION_REPORT.md
          echo "### 下一步建议：" >> verification-reports/FRF_FULL_COMPILATION_REPORT.md
          echo "1. 运行 `make report` 生成跨系统对比报告" >> verification-reports/FRF_FULL_COMPILATION_REPORT.md
          echo "2. 执行 `make test-only` 运行完整测试套件" >> verification-reports/FRF_FULL_COMPILATION_REPORT.md
          echo "3. 进行性能分析和优化" >> verification-reports/FRF_FULL_COMPILATION_REPORT.md
        else
          echo "**FRF 2.0 编译部分成功**" >> verification-reports/FRF_FULL_COMPILATION_REPORT.md
          echo "" >> verification-reports/FRF_FULL_COMPILATION_REPORT.md
          echo "已编译 $success_count 个模块（共 $total_modules 个），$(($total_modules - $success_count)) 个模块编译失败。" >> verification-reports/FRF_FULL_COMPILATION_REPORT.md
          echo "" >> verification-reports/FRF_FULL_COMPILATION_REPORT.md
          echo "### 建议：" >> verification-reports/FRF_FULL_COMPILATION_REPORT.md
          echo "1. 检查编译错误日志" >> verification-reports/FRF_FULL_COMPILATION_REPORT.md
          echo "2. 验证依赖关系" >> verification-reports/FRF_FULL_COMPILATION_REPORT.md
          echo "3. 调整大文件编译参数" >> verification-reports/FRF_FULL_COMPILATION_REPORT.md
        fi
        
        echo "" >> verification-reports/FRF_FULL_COMPILATION_REPORT.md
        echo "---" >> verification-reports/FRF_FULL_COMPILATION_REPORT.md
        echo "*报告生成时间: $(date)*" >> verification-reports/FRF_FULL_COMPILATION_REPORT.md
        echo "*GitHub Actions Run ID: $GITHUB_RUN_ID*" >> verification-reports/FRF_FULL_COMPILATION_REPORT.md
        
        echo "✅ 详细报告生成完成"

    - name: 📤 上传编译报告
      uses: actions/upload-artifact@v4
      with:
        name: frf-2.0-full-compilation-report
        path: verification-reports/
        retention-days: 30

    - name: 🎉 成功通知
      if: success()
      run: |
        echo ""
        echo "🎉🎉🎉 FRF 2.0 全量编译成功！"
        echo "========================================="
        echo "✅ 所有27个核心模块编译完成"
        echo "✅ 6个大文件特殊处理成功"
        echo "✅ 六层架构完整构建"
        echo "📊 详细报告已生成"
        echo "🕒 完成时间: $(date)"
        echo "========================================="
        
        # 显示成功编译的模块列表
        echo ""
        echo "✅ 成功编译的模块列表:"
        
        # 列出所有.vo文件
        for vo_file in $(find . -name "*.vo" | sort); do
          size=$(stat -c%s "$vo_file" 2>/dev/null || echo 0)
          size_kb=$((size / 1024))
          if [ $size_kb -gt 1024 ]; then
            size_mb=$((size_kb / 1024))
            echo "  📦 $vo_file (${size_mb}MB)"
          else
            echo "  📦 $vo_file (${size_kb}KB)"
          fi
        done
        
        # 特别列出大文件
        echo ""
        echo "🔴 大文件编译状态:"
        huge_files=(
          "SelfContainedLib/Geometry.vo"
          "theories/FRF_MetaTheory.vo"
          "theories/ChurchNumerals.vo"
          "theories/CaseE_QuantumVacuum.vo"
          "CS_Null/FRF_CS_Null_Common.vo"
          "theories/FRF_Comparative.vo"
        )
        
        for file in "${huge_files[@]}"; do
          if [ -f "$file" ]; then
            size=$(stat -c%s "$file" 2>/dev/null || echo 0)
            size_mb=$((size / 1048576))
            if [ $size_mb -gt 0 ]; then
              echo "  ✅ $(basename "$file") (${size_mb}MB)"
            else
              size_kb=$((size / 1024))
              echo "  ✅ $(basename "$file") (${size_kb}KB)"
            fi
          else
            echo "  ❌ $(basename "$file" .vo).v"
          fi
        done

    - name: ⚠️ 失败通知
      if: failure()
      run: |
        echo ""
        echo "❌ FRF 2.0 编译失败"
        echo "========================================="
        echo "⚠️  部分模块编译失败"
        echo ""
        echo "🔍 建议检查:"
        echo "1. 查看编译日志中的具体错误"
        echo "2. 检查大文件编译参数（特别是内存设置）"
        echo "3. 验证Coq环境配置"
        echo "4. 确认所有依赖文件存在"
        echo "========================================="
        
        # 显示失败文件
        echo ""
        echo "📋 可能失败的文件:"
        
        # 列出所有.v文件，检查对应的.vo文件
        for v_file in $(find . -name "*.v" | sort); do
          vo_file="${v_file%.v}.vo"
          if [ ! -f "$vo_file" ]; then
            echo "  ❌ $v_file"
          fi
        done