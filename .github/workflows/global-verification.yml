name: FRF 2.0 æ™ºèƒ½å…¨é‡å½¢å¼åŒ–éªŒè¯

on:
  push:
    branches: [main, master, develop]
    paths:
      - 'SelfContainedLib/**'
      - 'theories/**'
      - 'Quantum/**'
      - 'CS_Null/**'
      - 'Test/**'
      - '.github/workflows/global-verification.yml'
  pull_request:
    branches: [main, master]
    paths:
      - 'SelfContainedLib/**'
      - 'theories/**'
      - 'Quantum/**'
      - 'CS_Null/**'
      - 'Test/**'
  workflow_dispatch:
    inputs:
      verify_mode:
        description: 'éªŒè¯æ¨¡å¼'
        required: true
        default: 'full'
        type: choice
        options:
          - full
          - quick
          - test-only
          - report-only
      parallel_jobs:
        description: 'å¹¶è¡Œä»»åŠ¡æ•°'
        required: false
        default: '4'
        type: string

jobs:
  setup-environment:
    name: ğŸ”§ ç¯å¢ƒé…ç½®ä¸æ£€æŸ¥
    runs-on: ubuntu-22.04
    outputs:
      coq_version: ${{ steps.check-coq.outputs.version }}
      memory_available: ${{ steps.check-memory.outputs.available_mb }}
      core_count: ${{ steps.check-cpu.outputs.core_count }}
    steps:
      - name: ğŸ“¥ æ£€å‡ºä»£ç 
        uses: actions/checkout@v4
        with:
          fetch-depth: 1
          submodules: true

      - name: ğŸ–¥ï¸ ç³»ç»Ÿä¿¡æ¯æ£€æŸ¥
        id: check-cpu
        run: |
          echo "æ ¸å¿ƒæ•°: $(nproc)"
          echo "core_count=$(nproc)" >> $GITHUB_OUTPUT

      - name: ğŸ’¾ å†…å­˜æ£€æŸ¥
        id: check-memory
        run: |
          AVAIL_MEM=$(free -m | awk '/^Mem:/{print $7}')
          echo "å¯ç”¨å†…å­˜: ${AVAIL_MEM}MB"
          echo "available_mb=${AVAIL_MEM}" >> $GITHUB_OUTPUT

      - name: ğŸ“¦ å®‰è£…ç³»ç»Ÿä¾èµ–
        run: |
          sudo apt-get update
          sudo apt-get install -y \
            opam \
            bubblewrap \
            g++ \
            pkg-config \
            m4 \
            rsync \
            git \
            wget \
            bc \
            graphviz \
            python3 \
            python3-pip
          echo "âœ… ç³»ç»Ÿä¾èµ–å®‰è£…å®Œæˆ"

      - name: ğŸ”„ é…ç½®OPAMç¯å¢ƒ
        run: |
          opam init --disable-sandboxing -y --compiler=4.14.0
          eval $(opam env)
          opam repo add coq-released https://coq.inria.fr/opam/released
          opam repo add mathlib https://github.com/leanprover-community/mathlib.git
          opam update -y
          echo "OPAM_HOME=$OPAM_HOME" >> $GITHUB_ENV
          echo "OPAM_SWITCH_PREFIX=$OPAM_SWITCH_PREFIX" >> $GITHUB_ENV

      - name: ğŸ“Š é…ç½®éªŒè¯ç¯å¢ƒ
        run: |
          echo "AVAIL_MEM=${{ steps.check-memory.outputs.available_mb }}" >> $GITHUB_ENV
          echo "CORE_COUNT=${{ steps.check-cpu.outputs.core_count }}" >> $GITHUB_ENV
          
          AVAIL_MEM=${{ steps.check-memory.outputs.available_mb }}
          if [ $AVAIL_MEM -gt 16000 ]; then
            echo "COQ_MEMORY=16384" >> $GITHUB_ENV
            echo "BIGFILE_MEMORY=16384" >> $GITHUB_ENV
          elif [ $AVAIL_MEM -gt 8000 ]; then
            echo "COQ_MEMORY=8192" >> $GITHUB_ENV
            echo "BIGFILE_MEMORY=8192" >> $GITHUB_ENV
          elif [ $AVAIL_MEM -gt 4000 ]; then
            echo "COQ_MEMORY=4096" >> $GITHUB_ENV
            echo "BIGFILE_MEMORY=4096" >> $GITHUB_ENV
          else
            echo "COQ_MEMORY=2048" >> $GITHUB_ENV
            echo "BIGFILE_MEMORY=2048" >> $GITHUB_ENV
          fi
          
          CORE_COUNT=${{ steps.check-cpu.outputs.core_count }}
          PARALLEL_JOBS=$((CORE_COUNT / 2))
          echo "PARALLEL_JOBS=$PARALLEL_JOBS" >> $GITHUB_ENV

      - name: ğŸ” æ£€æŸ¥Coqç‰ˆæœ¬
        id: check-coq
        run: |
          eval $(opam env)
          if command -v coqc &> /dev/null; then
            COQ_VERSION=$(coqc --version | head -1 | grep -o 'version [0-9.]\+' | cut -d' ' -f2)
            echo "å½“å‰Coqç‰ˆæœ¬: $COQ_VERSION"
            echo "version=$COQ_VERSION" >> $GITHUB_OUTPUT
          else
            echo "âŒ Coqæœªå®‰è£…"
            exit 1
          fi

      - name: ğŸ“‹ ç¯å¢ƒæŠ¥å‘Š
        run: |
          echo "=== ç¯å¢ƒé…ç½®æŠ¥å‘Š ==="
          echo "ç³»ç»Ÿ: Ubuntu 22.04"
          echo "CPUæ ¸å¿ƒ: ${{ steps.check-cpu.outputs.core_count }}"
          echo "å¯ç”¨å†…å­˜: ${{ steps.check-memory.outputs.available_mb }}MB"
          echo "åˆ†é…å†…å­˜: ${{ env.COQ_MEMORY }}MB"
          echo "å¹¶è¡Œä»»åŠ¡: ${{ env.PARALLEL_JOBS }}"
          echo "Coqç‰ˆæœ¬: ${{ steps.check-coq.outputs.version }}"

  install-dependencies:
    name: ğŸ“¦ ä¾èµ–å®‰è£…ä¸ç¼“å­˜
    needs: setup-environment
    runs-on: ubuntu-22.04
    strategy:
      matrix:
        coq-version: ['8.18.0']
        mathcomp-version: ['1.17.0']
    steps:
      - name: ğŸ“¥ æ¢å¤OPAMç¼“å­˜
        uses: actions/cache@v3
        with:
          path: |
            ~/.opam
            ~/.cache/opam
          key: ${{ runner.os }}-opam-${{ matrix.coq-version }}-${{ matrix.mathcomp-version }}-${{ hashFiles('*.opam') }}
          restore-keys: |
            ${{ runner.os }}-opam-${{ matrix.coq-version }}-${{ matrix.mathcomp-version }}-
            ${{ runner.os }}-opam-

      - name: ğŸ”„ è®¾ç½®OPAMç¯å¢ƒ
        run: |
          eval $(opam env)
          opam update

      - name: ğŸ“Š å®‰è£…Coqæ ¸å¿ƒ
        run: |
          eval $(opam env)
          echo "å®‰è£…Coq ${{ matrix.coq-version }}..."
          opam install -y coq.${{ matrix.coq-version }}
          
          echo "éªŒè¯Coqå®‰è£…..."
          coqc --version
          if [ $? -ne 0 ]; then
            echo "âŒ Coqå®‰è£…å¤±è´¥"
            exit 1
          fi

      - name: ğŸ§® å®‰è£…mathcomp
        run: |
          eval $(opam env)
          echo "å®‰è£…coq-mathcomp-ssreflect.${{ matrix.mathcomp-version }}..."
          opam install -y coq-mathcomp-ssreflect.${{ matrix.mathcomp-version }}
          
          echo "éªŒè¯mathcompå®‰è£…..."
          opam list --installed | grep "coq-mathcomp-ssreflect" || (echo "âŒ mathcompå®‰è£…å¤±è´¥" && exit 1)

      - name: ğŸ“š å®‰è£…å¤–éƒ¨åº“
        run: |
          eval $(opam env)
          echo "å®‰è£…å¤–éƒ¨ä¾èµ–åº“..."
          
          # å®æ•°åº“
          opam install -y coq-mathcomp-analysis
          
          # æ ‡å‡†åº“
          opam install -y coq-stdlib
          
          # å¯é€‰ï¼šæ•°å­¦åº“
          opam install -y coq-mathlib || echo "è­¦å‘Š: mathlibå®‰è£…å¤±è´¥ï¼Œéƒ¨åˆ†æ¨¡å—å¯èƒ½æ— æ³•ç¼–è¯‘"
          
          # å¯é€‰ï¼šçŸ©é˜µå’Œå‘é‡åº“
          opam install -y coq-mathcomp-algebra || echo "è­¦å‘Š: çŸ©é˜µåº“å®‰è£…å¤±è´¥"
          
          echo "âœ… ä¾èµ–å®‰è£…å®Œæˆ"

      - name: ğŸ“ ä¾èµ–éªŒè¯æŠ¥å‘Š
        run: |
          eval $(opam env)
          echo "=== ä¾èµ–éªŒè¯æŠ¥å‘Š ==="
          echo "Coqç‰ˆæœ¬:"
          coqc --version
          echo ""
          echo "å®‰è£…çš„åŒ…:"
          opam list --installed | grep -E "coq|mathcomp"
          echo ""
          echo "ä¾èµ–æ ‘:"
          opam list --tree --installed | head -50

  compile-phase-1:

    needs: [setup-environment, install-dependencies]
    runs-on: ubuntu-22.04
    timeout-minutes: 30
    env:
      COQFLAGS: "-Q SelfContainedLib SelfContainedLib -m ${{ env.COQ_MEMORY }}"
    steps:
      - name: ğŸ“¥ æ£€å‡ºä»£ç 
        uses: actions/checkout@v4
        with:
          fetch-depth: 1

      - name: ğŸ”„ è®¾ç½®ç¯å¢ƒ
        run: |
          eval $(opam env)
          echo "COQFLAGS=${{ env.COQFLAGS }}" >> $GITHUB_ENV

      - name: ğŸ“Š ç¼–è¯‘å‰æ£€æŸ¥
        run: |
          echo "=== åŸºç¡€åº“ç¼–è¯‘å‰æ£€æŸ¥ ==="
          echo "åŸºç¡€åº“æ–‡ä»¶:"
          ls -la SelfContainedLib/*.v 2>/dev/null || echo "æ— æ–‡ä»¶"
          echo ""
          echo "ç¼–è¯‘å‚æ•°: $COQFLAGS"
          echo "å†…å­˜é™åˆ¶: ${{ env.COQ_MEMORY }}MB"
          echo "å¹¶è¡Œç¼–è¯‘: å¯ç”¨"

      - name: ğŸ”§ å¹¶è¡Œç¼–è¯‘åŸºç¡€åº“
        run: |
          eval $(opam env)
          
          # å®šä¹‰ç¼–è¯‘å‡½æ•°
          compile_file() {
            local file=$1
            local base=$(basename "$file" .v)
            echo "ğŸš€ ç¼–è¯‘ $base.v..."
            
            # å¤§æ–‡ä»¶ç‰¹æ®Šå¤„ç†
            local line_count=0
            if [ -f "$file" ]; then
              line_count=$(wc -l < "$file" 2>/dev/null || echo 0)
            fi
            
            local extra_flags=""
            
            if [ "$base" = "Geometry" ]; then
              extra_flags="-m ${{ env.BIGFILE_MEMORY }} -async-proofs on -async-proofs-tac-j 4"
              echo "  å¤§æ–‡ä»¶æ£€æµ‹: $line_count è¡Œï¼Œä½¿ç”¨å¢å¼ºå‚æ•°"
            fi
            
            if coqc $COQFLAGS $extra_flags "$file" 2>&1; then
              echo "âœ… $base.v ç¼–è¯‘æˆåŠŸ"
              return 0
            else
              echo "âŒ $base.v ç¼–è¯‘å¤±è´¥"
              coqc $COQFLAGS $extra_flags "$file" 2>&1 | head -30
              return 1
            fi
          }
          
          export -f compile_file
          export COQFLAGS
          
          # æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
          files_to_compile=""
          for file in SelfContainedLib/Algebra.v SelfContainedLib/Category.v SelfContainedLib/Geometry.v; do
            if [ -f "$file" ]; then
              files_to_compile="$files_to_compile $file"
            fi
          done
          
          if [ -z "$files_to_compile" ]; then
            echo "âŒ æ²¡æœ‰æ‰¾åˆ°è¦ç¼–è¯‘çš„æ–‡ä»¶"
            exit 1
          fi
          
          # å¹¶è¡Œç¼–è¯‘åŸºç¡€æ–‡ä»¶
          echo "å¼€å§‹å¹¶è¡Œç¼–è¯‘åŸºç¡€åº“..."
          
          # ç¼–è¯‘Algebra.v
          compile_file "SelfContainedLib/Algebra.v" &
          ALGEBRA_PID=$!
          
          # ç¼–è¯‘Category.v
          compile_file "SelfContainedLib/Category.v" &
          CATEGORY_PID=$!
          
          # ç¼–è¯‘Geometry.vï¼ˆå¤§æ–‡ä»¶ï¼Œæœ€åç¼–è¯‘ï¼‰
          sleep 2  # è®©å…¶ä»–æ–‡ä»¶å…ˆå¼€å§‹
          compile_file "SelfContainedLib/Geometry.v" &
          GEOMETRY_PID=$!
          
          # ç­‰å¾…æ‰€æœ‰ç¼–è¯‘å®Œæˆ
          wait $ALGEBRA_PID || ALGEBRA_FAILED=1
          wait $CATEGORY_PID || CATEGORY_FAILED=1
          wait $GEOMETRY_PID || GEOMETRY_FAILED=1
          
          # æ£€æŸ¥ç»“æœ
          if [ -n "$ALGEBRA_FAILED" ] || [ -n "$CATEGORY_FAILED" ] || [ -n "$GEOMETRY_FAILED" ]; then
            echo "âŒ åŸºç¡€åº“ç¼–è¯‘å¤±è´¥"
            exit 1
          fi
          
          echo "âœ… åŸºç¡€åº“ç¼–è¯‘å®Œæˆ"

      - name: ğŸ“ˆ ç¼–è¯‘ç»“æœç»Ÿè®¡
        run: |
          echo "=== åŸºç¡€åº“ç¼–è¯‘ç»Ÿè®¡ ==="
          echo "ç¼–è¯‘æ–‡ä»¶:"
          for file in Algebra Category Geometry; do
            if [ -f "SelfContainedLib/$file.vo" ]; then
              echo "  âœ… $file.vo (å­˜åœ¨)"
            else
              echo "  âŒ $file.vo (ç¼ºå¤±)"
            fi
          done
          echo ""
          echo "ç”Ÿæˆæ–‡ä»¶åˆ—è¡¨:"
          ls -la SelfContainedLib/*.vo SelfContainedLib/*.glob 2>/dev/null || echo "æ— ç”Ÿæˆæ–‡ä»¶"

  compile-phase-2:

    needs: compile-phase-1
    runs-on: ubuntu-22.04
    timeout-minutes: 45
    env:
      COQFLAGS: "-Q SelfContainedLib SelfContainedLib -Q theories theories -m ${{ env.COQ_MEMORY }}"
    steps:
      - name: ğŸ“¥ æ£€å‡ºä»£ç 
        uses: actions/checkout@v4
        with:
          fetch-depth: 1

      - name: ğŸ”„ è®¾ç½®ç¯å¢ƒ
        run: |
          eval $(opam env)
          echo "COQFLAGS=${{ env.COQFLAGS }}" >> $GITHUB_ENV
          
          # å¤åˆ¶åŸºç¡€åº“çš„.voæ–‡ä»¶
          mkdir -p SelfContainedLib
          cp -r ../compile-phase-1/SelfContainedLib/*.vo SelfContainedLib/ 2>/dev/null || true

      - name: ğŸ“Š æ£€æŸ¥å…ƒç†è®ºæ–‡ä»¶
        run: |
          echo "=== å…ƒç†è®ºå±‚æ–‡ä»¶æ£€æŸ¥ ==="
          echo "å…ƒç†è®ºæ–‡ä»¶:"
          ls -la theories/*.v 2>/dev/null || echo "æ— æ–‡ä»¶"
          echo ""
          echo "æ–‡ä»¶å¤§å°ç»Ÿè®¡:"
          for file in theories/*.v 2>/dev/null; do
            if [ -f "$file" ]; then
              lines=$(wc -l < "$file" 2>/dev/null || echo 0)
              echo "  $(basename $file): $lines è¡Œ"
            fi
          done

      - name: ğŸ”§ æ™ºèƒ½ç¼–è¯‘å…ƒç†è®º
        run: |
          eval $(opam env)
          
          # æ£€æŸ¥å¿…è¦çš„æ–‡ä»¶æ˜¯å¦å­˜åœ¨
          for file in theories/ChurchZero.v theories/FRF_MetaTheory.v theories/ChurchNumerals.v; do
            if [ ! -f "$file" ]; then
              echo "âŒ æ–‡ä»¶ä¸å­˜åœ¨: $file"
              exit 1
            fi
          done
          
          # ç¼–è¯‘é¡ºåºï¼šå…ˆå°æ–‡ä»¶ï¼Œåå¤§æ–‡ä»¶
          echo "å¼€å§‹ç¼–è¯‘å…ƒç†è®ºå±‚..."
          
          # 1. ç¼–è¯‘ChurchZero.vï¼ˆä¸­ç­‰å¤§å°ï¼‰
          echo "ğŸ“˜ ç¼–è¯‘ ChurchZero.v..."
          if coqc $COQFLAGS theories/ChurchZero.v 2>&1; then
            echo "âœ… ChurchZero.v ç¼–è¯‘æˆåŠŸ"
          else
            echo "âŒ ChurchZero.v ç¼–è¯‘å¤±è´¥"
            coqc $COQFLAGS theories/ChurchZero.v 2>&1 | head -20
            exit 1
          fi
          
          # 2. ç¼–è¯‘FRF_MetaTheory.vï¼ˆå¤§æ–‡ä»¶ï¼‰
          echo "ğŸ“— ç¼–è¯‘ FRF_MetaTheory.v (å¤§æ–‡ä»¶)..."
          if coqc $COQFLAGS -m ${{ env.BIGFILE_MEMORY }} -async-proofs on theories/FRF_MetaTheory.v 2>&1; then
            echo "âœ… FRF_MetaTheory.v ç¼–è¯‘æˆåŠŸ"
          else
            echo "âŒ FRF_MetaTheory.v ç¼–è¯‘å¤±è´¥"
            coqc $COQFLAGS -m ${{ env.BIGFILE_MEMORY }} theories/FRF_MetaTheory.v 2>&1 | head -30
            exit 1
          fi
          
          # 3. ç¼–è¯‘ChurchNumerals.vï¼ˆæå¤§æ–‡ä»¶ï¼‰
          echo "ğŸ“™ ç¼–è¯‘ ChurchNumerals.v (æå¤§æ–‡ä»¶)..."
          if coqc $COQFLAGS -m ${{ env.BIGFILE_MEMORY }} -async-proofs on -async-proofs-tac-j 8 theories/ChurchNumerals.v 2>&1; then
            echo "âœ… ChurchNumerals.v ç¼–è¯‘æˆåŠŸ"
          else
            echo "âŒ ChurchNumerals.v ç¼–è¯‘å¤±è´¥"
            coqc $COQFLAGS -m ${{ env.BIGFILE_MEMORY }} theories/ChurchNumerals.v 2>&1 | head -40
            exit 1
          fi

      - name: ğŸ“ˆ å…ƒç†è®ºç¼–è¯‘ç»Ÿè®¡
        run: |
          echo "=== å…ƒç†è®ºå±‚ç¼–è¯‘ç»Ÿè®¡ ==="
          echo "ç¼–è¯‘æ–‡ä»¶æ•°: 3/3"
          echo "æˆåŠŸæ–‡ä»¶:"
          for file in FRF_MetaTheory ChurchZero ChurchNumerals; do
            if [ -f "theories/$file.vo" ]; then
              lines=0
              if [ -f "theories/$file.v" ]; then
                lines=$(wc -l < "theories/$file.v" 2>/dev/null || echo 0)
              fi
              echo "  âœ… $file.vo ($lines è¡Œ)"
            else
              echo "  âŒ $file.vo (ç¼ºå¤±)"
            fi
          done
          echo ""
          echo "æ€»ä»£ç è¡Œæ•°:"
          wc -l theories/*.v 2>/dev/null | tail -1 || echo "0"

  compile-phase-3:

    needs: compile-phase-2
    runs-on: ubuntu-22.04
    timeout-minutes: 40
    env:
      COQFLAGS: "-Q SelfContainedLib SelfContainedLib -Q theories theories -m ${{ env.COQ_MEMORY }}"
    steps:
      - name: ğŸ“¥ æ£€å‡ºä»£ç 
        uses: actions/checkout@v4
        with:
          fetch-depth: 1

      - name: ğŸ”„ è®¾ç½®ç¯å¢ƒ
        run: |
          eval $(opam env)
          echo "COQFLAGS=${{ env.COQFLAGS }}" >> $GITHUB_ENV
          
          # å¤åˆ¶ä¾èµ–æ–‡ä»¶
          mkdir -p SelfContainedLib
          mkdir -p theories
          cp -r ../compile-phase-1/SelfContainedLib/*.vo SelfContainedLib/ 2>/dev/null || true
          cp -r ../compile-phase-2/theories/*.vo theories/ 2>/dev/null || true

      - name: ğŸ“Š æ£€æŸ¥åœºæ™¯æ–‡ä»¶
        run: |
          echo "=== æ•°å­¦åœºæ™¯å±‚æ–‡ä»¶æ£€æŸ¥ ==="
          echo "åœºæ™¯æ–‡ä»¶:"
          ls -la theories/Case*.v 2>/dev/null || echo "æ— åœºæ™¯æ–‡ä»¶"
          echo ""
          echo "æ–‡ä»¶ç»Ÿè®¡:"
          for file in theories/Case*.v 2>/dev/null; do
            if [ -f "$file" ]; then
              base=$(basename "$file" .v)
              lines=$(wc -l < "$file" 2>/dev/null || echo 0)
              echo "  $base: $lines è¡Œ"
            fi
          done

      - name: ğŸ”§ ç¼–è¯‘æ•°å­¦åœºæ™¯
        run: |
          eval $(opam env)
          
          # æ£€æŸ¥å¿…è¦çš„æ–‡ä»¶æ˜¯å¦å­˜åœ¨
          files_found=0
          for pattern in theories/CaseA_*.v theories/CaseB_*.v theories/CaseC_*.v theories/CaseD_*.v theories/CaseE_*.v; do
            if ls $pattern 1> /dev/null 2>&1; then
              files_found=1
            fi
          done
          
          if [ $files_found -eq 0 ]; then
            echo "âš ï¸ æœªæ‰¾åˆ°åœºæ™¯æ–‡ä»¶"
            exit 0
          fi
          
          # ç¼–è¯‘å‡½æ•°
          compile_scene() {
            local file=$1
            local base=$(basename "$file" .v)
            
            echo "ğŸ¨ ç¼–è¯‘ $base.v..."
            
            case $base in
              CaseA_*)
                # å°æ–‡ä»¶ï¼Œæ™®é€šç¼–è¯‘
                coqc $COQFLAGS "$file" 2>&1
                ;;
              CaseB_*)
                # ä¸­ç­‰æ–‡ä»¶ï¼Œå®æ•°ä¾èµ–
                coqc $COQFLAGS -async-proofs on "$file" 2>&1
                ;;
              CaseE_*)
                # å¤§æ–‡ä»¶ï¼Œç‰¹æ®Šå¤„ç†
                coqc $COQFLAGS -m ${{ env.BIGFILE_MEMORY }} -async-proofs on -async-proofs-tac-j 4 "$file" 2>&1
                ;;
              *)
                # é»˜è®¤ç¼–è¯‘
                coqc $COQFLAGS "$file" 2>&1
                ;;
            esac
            
            if [ $? -eq 0 ]; then
              echo "âœ… $base.v ç¼–è¯‘æˆåŠŸ"
              return 0
            else
              echo "âŒ $base.v ç¼–è¯‘å¤±è´¥"
              return 1
            fi
          }
          
          # ç¼–è¯‘åœºæ™¯æ–‡ä»¶
          echo "å¼€å§‹ç¼–è¯‘æ•°å­¦åœºæ™¯..."
          failed=0
          
          # æŸ¥æ‰¾æ‰€æœ‰åœºæ™¯æ–‡ä»¶
          for pattern in CaseA CaseB CaseC CaseD CaseE; do
            for file in theories/${pattern}_*.v 2>/dev/null; do
              if [ -f "$file" ]; then
                compile_scene "$file" || failed=1
              fi
            done
          done
          
          if [ $failed -eq 1 ]; then
            echo "âŒ æ•°å­¦åœºæ™¯å±‚ç¼–è¯‘æœ‰å¤±è´¥"
            exit 1
          fi
          
          echo "âœ… æ•°å­¦åœºæ™¯å±‚ç¼–è¯‘å®Œæˆ"

      - name: ğŸ“ˆ åœºæ™¯å±‚ç»Ÿè®¡
        run: |
          echo "=== æ•°å­¦åœºæ™¯å±‚ç¼–è¯‘ç»Ÿè®¡ ==="
          echo "åœºæ™¯æ¨¡å—:"
          for pattern in CaseA CaseB CaseC CaseD CaseE; do
            for file in theories/${pattern}_*.vo 2>/dev/null; do
              if [ -f "$file" ]; then
                base=$(basename "$file" .vo)
                lines=0
                if [ -f "theories/${base}.v" ]; then
                  lines=$(wc -l < "theories/${base}.v" 2>/dev/null || echo 0)
                fi
                echo "  âœ… $base ($lines è¡Œ)"
              fi
            done
          done

  compile-phase-4:
    name:é˜¶æ®µ4:
    needs: [compile-phase-3, compile-phase-1]
    runs-on: ubuntu-22.04
    timeout-minutes: 50
    env:
      COQFLAGS: "-Q SelfContainedLib SelfContainedLib -Q theories theories -Q Quantum Quantum -Q CS_Null CS_Null -m ${{ env.COQ_MEMORY }}"
    steps:
      - name: ğŸ“¥ æ£€å‡ºä»£ç 
        uses: actions/checkout@v4
        with:
          fetch-depth: 1

      - name: ğŸ”„ è®¾ç½®ç¯å¢ƒ
        run: |
          eval $(opam env)
          echo "COQFLAGS=${{ env.COQFLAGS }}" >> $GITHUB_ENV
          
          # å¤åˆ¶ä¾èµ–æ–‡ä»¶
          mkdir -p SelfContainedLib
          mkdir -p theories
          cp -r ../compile-phase-1/SelfContainedLib/*.vo SelfContainedLib/ 2>/dev/null || true
          cp -r ../compile-phase-2/theories/*.vo theories/ 2>/dev/null || true
          cp -r ../compile-phase-3/theories/*.vo theories/ 2>/dev/null || true

      - name: ğŸ“ æ£€æŸ¥æ‰©å±•æ¨¡å—
        run: |
          echo "=== æ‰©å±•æ¨¡å—ç»“æ„æ£€æŸ¥ ==="
          echo "é‡å­æ¨¡å—:"
          ls -la Quantum/*.v 2>/dev/null || echo "æ— é‡å­æ¨¡å—"
          echo ""
          echo "ç©ºå€¼ç³»ç»Ÿ:"
          ls -la CS_Null/*.v 2>/dev/null || echo "æ— ç©ºå€¼ç³»ç»Ÿ"
          echo ""
          echo "æ€»æ–‡ä»¶æ•°:"
          find Quantum CS_Null -name "*.v" 2>/dev/null | wc -l || echo "0"

      - name: ğŸ”§ ç¼–è¯‘é‡å­æ¨¡å—
        run: |
          eval $(opam env)
          echo "ğŸ”¬ ç¼–è¯‘é‡å­æ¨¡å—..."
          
          # æ£€æŸ¥é‡å­æ–‡ä»¶æ˜¯å¦å­˜åœ¨
          quantum_files=0
          for file in Quantum/*.v 2>/dev/null; do
            quantum_files=1
            break
          done
          
          if [ $quantum_files -eq 0 ]; then
            echo "âš ï¸ æœªæ‰¾åˆ°é‡å­æ¨¡å—æ–‡ä»¶"
            exit 0
          fi
          
          # æ£€æŸ¥æ˜¯å¦ä¾èµ–Geometryï¼ˆæ›²ç‡è®¡ç®—ï¼‰
          if grep -q "Geometry" Quantum/*.v 2>/dev/null; then
            echo "æ£€æµ‹åˆ°å‡ ä½•ä¾èµ–ï¼Œéœ€è¦Geometry.vo"
            if [ ! -f "SelfContainedLib/Geometry.vo" ]; then
              echo "âŒ ç¼ºå°‘Geometry.voï¼Œé‡å­æ¨¡å—æ— æ³•ç¼–è¯‘"
              exit 1
            fi
          fi
          
          # ç¼–è¯‘QFT_FRF.v
          if [ -f "Quantum/QFT_FRF.v" ]; then
            echo "1. ç¼–è¯‘ QFT_FRF.v..."
            if coqc $COQFLAGS Quantum/QFT_FRF.v 2>&1; then
              echo "âœ… QFT_FRF.v ç¼–è¯‘æˆåŠŸ"
            else
              echo "âŒ QFT_FRF.v ç¼–è¯‘å¤±è´¥"
              exit 1
            fi
          else
            echo "âš ï¸  QFT_FRF.v ä¸å­˜åœ¨"
          fi
          
          # ç¼–è¯‘CurvedSpacetimeQFT.v
          if [ -f "Quantum/CurvedSpacetimeQFT.v" ]; then
            echo "2. ç¼–è¯‘ CurvedSpacetimeQFT.v..."
            if coqc $COQFLAGS -async-proofs on Quantum/CurvedSpacetimeQFT.v 2>&1; then
              echo "âœ… CurvedSpacetimeQFT.v ç¼–è¯‘æˆåŠŸ"
            else
              echo "âŒ CurvedSpacetimeQFT.v ç¼–è¯‘å¤±è´¥"
              exit 1
            fi
          else
            echo "âš ï¸  CurvedSpacetimeQFT.v ä¸å­˜åœ¨"
          fi

      - name: ğŸ”§ ç¼–è¯‘ç©ºå€¼ç³»ç»ŸåŸºç¡€
        run: |
          eval $(opam env)
          echo "ğŸ“Š ç¼–è¯‘ç©ºå€¼ç³»ç»ŸåŸºç¡€æ¨¡å—..."
          
          # æ£€æŸ¥ç©ºå€¼ç³»ç»Ÿæ–‡ä»¶æ˜¯å¦å­˜åœ¨
          csnull_files=0
          for file in CS_Null/*.v 2>/dev/null; do
            csnull_files=1
            break
          done
          
          if [ $csnull_files -eq 0 ]; then
            echo "âš ï¸ æœªæ‰¾åˆ°ç©ºå€¼ç³»ç»Ÿæ–‡ä»¶"
            exit 0
          fi
          
          # FRF_CS_Null_Common.væ˜¯æå¤§æ–‡ä»¶ï¼Œéœ€è¦ç‰¹æ®Šå¤„ç†
          if [ -f "CS_Null/FRF_CS_Null_Common.v" ]; then
            echo "1. ç¼–è¯‘ FRF_CS_Null_Common.v (æå¤§æ–‡ä»¶)..."
            if coqc $COQFLAGS -m ${{ env.BIGFILE_MEMORY }} -async-proofs on -async-proofs-tac-j 8 CS_Null/FRF_CS_Null_Common.v 2>&1; then
              echo "âœ… FRF_CS_Null_Common.v ç¼–è¯‘æˆåŠŸ"
            else
              echo "âŒ FRF_CS_Null_Common.v ç¼–è¯‘å¤±è´¥"
              exit 1
            fi
          else
            echo "âš ï¸  FRF_CS_Null_Common.v ä¸å­˜åœ¨"
          fi
          
          # FRF_CS_Null.v
          if [ -f "CS_Null/FRF_CS_Null.v" ]; then
            echo "2. ç¼–è¯‘ FRF_CS_Null.v..."
            if coqc $COQFLAGS CS_Null/FRF_CS_Null.v 2>&1; then
              echo "âœ… FRF_CS_Null.v ç¼–è¯‘æˆåŠŸ"
            else
              echo "âŒ FRF_CS_Null.v ç¼–è¯‘å¤±è´¥"
              exit 1
            fi
          else
            echo "âš ï¸  FRF_CS_Null.v ä¸å­˜åœ¨"
          fi

      - name: ğŸ”§ ç¼–è¯‘è¯­è¨€ç©ºå€¼æ¨¡å—
        run: |
          eval $(opam env)
          echo "ğŸŒ ç¼–è¯‘è¯­è¨€ç©ºå€¼æ¨¡å—..."
          
          # æ£€æŸ¥è¯­è¨€æ–‡ä»¶æ˜¯å¦å­˜åœ¨
          lang_files=0
          for file in CS_Null/*Null.v 2>/dev/null; do
            lang_files=1
            break
          done
          
          if [ $lang_files -eq 0 ]; then
            echo "âš ï¸ æœªæ‰¾åˆ°è¯­è¨€ç©ºå€¼æ¨¡å—æ–‡ä»¶"
            exit 0
          fi
          
          # ç¼–è¯‘å‡½æ•°
          compile_lang_null() {
            local lang=$1
            local file="CS_Null/${lang}Null.v"
            
            if [ ! -f "$file" ]; then
              echo "âš ï¸  $file ä¸å­˜åœ¨"
              return 0
            fi
            
            echo "  ç¼–è¯‘ ${lang}Null.v..."
            
            # æ ¹æ®ä¸åŒè¯­è¨€è®¾ç½®ç¼–è¯‘å‚æ•°
            case $lang in
              Java|Math)
                # å®æ•°ä¾èµ–
                coqc $COQFLAGS -async-proofs on "$file" 2>&1
                ;;
              Cxx)
                # ä¸­ç­‰å¤§å°
                coqc $COQFLAGS "$file" 2>&1
                ;;
              *)
                # é»˜è®¤
                coqc $COQFLAGS "$file" 2>&1
                ;;
            esac
            
            if [ $? -eq 0 ]; then
              echo "    âœ… ${lang}Null.v ç¼–è¯‘æˆåŠŸ"
              return 0
            else
              echo "    âŒ ${lang}Null.v ç¼–è¯‘å¤±è´¥"
              return 1
            fi
          }
          
          # ç¼–è¯‘æ‰€æœ‰è¯­è¨€æ¨¡å—
          failed=0
          for lang in Cxx Python Java Math Rust; do
            compile_lang_null "$lang" || failed=1
          done
          
          if [ $failed -eq 1 ]; then
            echo "âŒ è¯­è¨€ç©ºå€¼æ¨¡å—ç¼–è¯‘æœ‰å¤±è´¥"
            exit 1
          fi
          
          echo "âœ… è¯­è¨€ç©ºå€¼æ¨¡å—ç¼–è¯‘å®Œæˆ"

      - name: ğŸ“ˆ æ‰©å±•æ¨¡å—ç»Ÿè®¡
        run: |
          echo "=== æ‰©å±•æ¨¡å—ç¼–è¯‘ç»Ÿè®¡ ==="
          echo "é‡å­æ¨¡å—:"
          for file in Quantum/*.vo 2>/dev/null; do
            base=$(basename "$file" .vo)
            echo "  âœ… $base"
          done || echo "  æ— é‡å­æ¨¡å—"
          
          echo ""
          echo "ç©ºå€¼ç³»ç»Ÿ:"
          count=0
          for file in CS_Null/*.vo 2>/dev/null; do
            base=$(basename "$file" .vo)
            echo "  âœ… $base"
            count=$((count + 1))
          done
          echo "  æ€»è®¡: $count ä¸ªæ¨¡å—"

  compile-phase-5:
    name: ğŸ§© é˜¶æ®µ5:é›†æˆæ¨¡å—ç¼–è¯‘
    needs: [compile-phase-4, compile-phase-2, compile-phase-3]
    runs-on: ubuntu-22.04
    timeout-minutes: 35
    env:
      COQFLAGS: "-Q SelfContainedLib SelfContainedLib -Q theories theories -Q Quantum Quantum -Q CS_Null CS_Null -m ${{ env.BIGFILE_MEMORY }}"
    steps:
      - name: ğŸ“¥ æ£€å‡ºä»£ç 
        uses: actions/checkout@v4
        with:
          fetch-depth: 1

      - name: ğŸ”„ è®¾ç½®ç¯å¢ƒ
        run: |
          eval $(opam env)
          echo "COQFLAGS=${{ env.COQFLAGS }}" >> $GITHUB_ENV
          
          # å¤åˆ¶æ‰€æœ‰ä¾èµ–æ–‡ä»¶
          mkdir -p SelfContainedLib theories Quantum CS_Null
          cp -r ../compile-phase-1/SelfContainedLib/*.vo SelfContainedLib/ 2>/dev/null || true
          cp -r ../compile-phase-2/theories/*.vo theories/ 2>/dev/null || true
          cp -r ../compile-phase-3/theories/*.vo theories/ 2>/dev/null || true
          cp -r ../compile-phase-4/Quantum/*.vo Quantum/ 2>/dev/null || true
          cp -r ../compile-phase-4/CS_Null/*.vo CS_Null/ 2>/dev/null || true

      - name: ğŸ”§ ç¼–è¯‘é›†æˆæ¨¡å—
        run: |
          eval $(opam env)
          echo "ğŸ§© ç¼–è¯‘é›†æˆæ¨¡å— FRF_Comparative.v..."
          
          # æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
          if [ ! -f "theories/FRF_Comparative.v" ]; then
            echo "âš ï¸  FRF_Comparative.v ä¸å­˜åœ¨"
            exit 0
          fi
          
          # æ£€æŸ¥ä¾èµ–æ˜¯å¦å®Œæ•´
          echo "æ£€æŸ¥ä¾èµ–..."
          required_files=(
            "theories/FRF_MetaTheory.vo"
            "CS_Null/FRF_CS_Null_Common.vo"
            "SelfContainedLib/Algebra.vo"
            "SelfContainedLib/Category.vo"
          )
          
          missing_files=0
          for file in "${required_files[@]}"; do
            if [ ! -f "$file" ]; then
              echo "âŒ ç¼ºå°‘ä¾èµ–: $file"
              missing_files=1
            fi
          done
          
          if [ $missing_files -eq 1 ]; then
            echo "âŒ ç¼ºå°‘å¿…è¦çš„ä¾èµ–æ–‡ä»¶"
            exit 1
          fi
          
          echo "âœ… æ‰€æœ‰ä¾èµ–å°±ç»ª"
          
          # ç¼–è¯‘é›†æˆæ¨¡å—ï¼ˆæå¤§æ–‡ä»¶ï¼‰
          echo "å¼€å§‹ç¼–è¯‘ FRF_Comparative.v..."
          
          if coqc $COQFLAGS -async-proofs on -async-proofs-tac-j 6 theories/FRF_Comparative.v 2>&1; then
            echo "âœ… FRF_Comparative.v ç¼–è¯‘æˆåŠŸ"
          else
            echo "âŒ FRF_Comparative.v ç¼–è¯‘å¤±è´¥"
            coqc $COQFLAGS theories/FRF_Comparative.v 2>&1 | head -40
            exit 1
          fi

      - name: ğŸ“Š é›†æˆæ¨¡å—éªŒè¯
        run: |
          echo "=== é›†æˆæ¨¡å—éªŒè¯ ==="
          echo "ç¼–è¯‘æ–‡ä»¶:"
          if [ -f "theories/FRF_Comparative.vo" ]; then
            size=0
            if [ -f "theories/FRF_Comparative.v" ]; then
              size=$(wc -l < "theories/FRF_Comparative.v" 2>/dev/null || echo 0)
            fi
            echo "  âœ… FRF_Comparative.vo ($size è¡Œ)"
            echo ""
            echo "ç”ŸæˆæŠ¥å‘ŠåŠŸèƒ½éªŒè¯..."
            # æ£€æŸ¥æŠ¥å‘Šç”Ÿæˆå‡½æ•°æ˜¯å¦å­˜åœ¨
            if grep -q "default_comparative_report" theories/FRF_Comparative.v 2>/dev/null; then
              echo "  âœ… æŠ¥å‘Šç”Ÿæˆå‡½æ•°å­˜åœ¨"
            else
              echo "  âš ï¸  æŠ¥å‘Šç”Ÿæˆå‡½æ•°æœªæ‰¾åˆ°"
            fi
          else
            echo "  âŒ FRF_Comparative.vo ç¼ºå¤±"
          fi

  compile-phase-6:
    name: ğŸ§ª é˜¶æ®µ6:æµ‹è¯•å¥—ä»¶ç¼–è¯‘
    needs: [compile-phase-5, compile-phase-1, compile-phase-2, compile-phase-3]
    runs-on: ubuntu-22.04
    timeout-minutes: 30
    env:
      COQFLAGS: "-Q SelfContainedLib SelfContainedLib -Q theories theories -Q Quantum Quantum -Q CS_Null CS_Null -Q Test Test -m ${{ env.COQ_MEMORY }}"
    steps:
      - name: ğŸ“¥ æ£€å‡ºä»£ç 
        uses: actions/checkout@v4
        with:
          fetch-depth: 1

      - name: ğŸ”„ è®¾ç½®ç¯å¢ƒ
        run: |
          eval $(opam env)
          echo "COQFLAGS=${{ env.COQFLAGS }}" >> $GITHUB_ENV
          
          # å¤åˆ¶æ‰€æœ‰ä¾èµ–æ–‡ä»¶
          mkdir -p SelfContainedLib theories Quantum CS_Null Test
          cp -r ../compile-phase-1/SelfContainedLib/*.vo SelfContainedLib/ 2>/dev/null || true
          cp -r ../compile-phase-2/theories/*.vo theories/ 2>/dev/null || true
          cp -r ../compile-phase-3/theories/*.vo theories/ 2>/dev/null || true
          cp -r ../compile-phase-4/Quantum/*.vo Quantum/ 2>/dev/null || true
          cp -r ../compile-phase-4/CS_Null/*.vo CS_Null/ 2>/dev/null || true
          cp -r ../compile-phase-5/theories/*.vo theories/ 2>/dev/null || true

      - name: ğŸ§ª æ£€æŸ¥æµ‹è¯•å¥—ä»¶
        run: |
          echo "=== æµ‹è¯•å¥—ä»¶æ£€æŸ¥ ==="
          echo "æµ‹è¯•æ–‡ä»¶:"
          ls -la Test/*.v 2>/dev/null || echo "æ— æµ‹è¯•æ–‡ä»¶"
          echo ""
          echo "æµ‹è¯•ç»Ÿè®¡:"
          find Test -name "*.v" 2>/dev/null | wc -l || echo "0"

      - name: ğŸ”§ ç¼–è¯‘æµ‹è¯•
        run: |
          eval $(opam env)
          echo "ğŸ§ª ç¼–è¯‘æµ‹è¯•å¥—ä»¶..."
          
          # æ£€æŸ¥æµ‹è¯•æ–‡ä»¶æ˜¯å¦å­˜åœ¨
          test_files_count=0
          for file in Test/*.v 2>/dev/null; do
            test_files_count=1
            break
          done
          
          if [ $test_files_count -eq 0 ]; then
            echo "âš ï¸  æœªæ‰¾åˆ°æµ‹è¯•æ–‡ä»¶"
            exit 0
          fi
          
          # ç¼–è¯‘å‡½æ•°
          compile_test() {
            local file=$1
            local base=$(basename "$file" .v)
            
            echo "  æµ‹è¯•: $base.v..."
            
            case $base in
              Test_FRF_MetaTheory|Test_BlockchainSystem)
                # å¤§æµ‹è¯•æ–‡ä»¶
                coqc $COQFLAGS -async-proofs on "$file" 2>&1
                ;;
              Test_QuantumVacuum|SelfContainedVerification)
                # ä¸­ç­‰æµ‹è¯•æ–‡ä»¶
                coqc $COQFLAGS "$file" 2>&1
                ;;
              Test_Basic)
                # å°æµ‹è¯•æ–‡ä»¶
                coqc $COQFLAGS "$file" 2>&1
                ;;
              *)
                # é»˜è®¤
                coqc $COQFLAGS "$file" 2>&1
                ;;
            esac
            
            if [ $? -eq 0 ]; then
              echo "    âœ… $base.v ç¼–è¯‘æˆåŠŸ"
              return 0
            else
              echo "    âŒ $base.v ç¼–è¯‘å¤±è´¥"
              return 1
            fi
          }
          
          # ç¼–è¯‘æ‰€æœ‰æµ‹è¯•æ–‡ä»¶
          failed=0
          for file in Test/*.v 2>/dev/null; do
            compile_test "$file" || failed=1
          done
          
          if [ $failed -eq 1 ]; then
            echo "âŒ æµ‹è¯•å¥—ä»¶ç¼–è¯‘æœ‰å¤±è´¥"
            exit 1
          fi
          
          echo "âœ… æµ‹è¯•å¥—ä»¶ç¼–è¯‘å®Œæˆ"

      - name: ğŸ“Š æµ‹è¯•ç¼–è¯‘ç»Ÿè®¡
        run: |
          echo "=== æµ‹è¯•å¥—ä»¶ç¼–è¯‘ç»Ÿè®¡ ==="
          echo "æµ‹è¯•æ–‡ä»¶:"
          total=0
          success=0
          
          for file in Test/*.vo 2>/dev/null; do
            if [ -f "$file" ]; then
              base=$(basename "$file" .vo)
              echo "  âœ… $base"
              success=$((success + 1))
            fi
            total=$((total + 1))
          done
          
          if [ $total -eq 0 ]; then
            echo "  æ— æµ‹è¯•æ–‡ä»¶"
          else
            echo ""
            echo "ç»Ÿè®¡: $success/$total ä¸ªæµ‹è¯•ç¼–è¯‘æˆåŠŸ"
          fi

  full-verification-report:
    name: ğŸ“‹ å…¨é‡éªŒè¯æŠ¥å‘Šç”Ÿæˆ
    needs: [compile-phase-1, compile-phase-2, compile-phase-3, compile-phase-4, compile-phase-5, compile-phase-6]
    if: always()
    runs-on: ubuntu-22.04
    steps:
      - name: ğŸ“¥ æ”¶é›†ç¼–è¯‘ç»“æœ
        run: |
          echo "=== æ”¶é›†å„é˜¶æ®µç¼–è¯‘ç»“æœ ==="
          
          # åˆ›å»ºæŠ¥å‘Šç›®å½•
          mkdir -p verification-report
          mkdir -p compilation-artifacts
          
          # æ”¶é›†å„é˜¶æ®µæ–‡ä»¶
          for phase in 1 2 3 4 5 6; do
            mkdir -p "compilation-artifacts/phase-$phase"
            if [ -d "../compile-phase-$phase" ]; then
              find "../compile-phase-$phase" -name "*.vo" -o -name "*.glob" 2>/dev/null | head -20 | while read -r file; do
                cp "$file" "compilation-artifacts/phase-$phase/" 2>/dev/null || true
              done
            fi
          done

      - name: ğŸ“Š ç”ŸæˆéªŒè¯æŠ¥å‘Š
        run: |
          echo "ç”Ÿæˆå…¨é‡éªŒè¯æŠ¥å‘Š..."
          
          # ç»Ÿè®¡ç¼–è¯‘ç»“æœ
          TOTAL_FILES=0
          COMPILED_FILES=0
          HUGE_FILES=0
          HUGE_COMPILED=0
          
          # æ‰«ææ‰€æœ‰.væ–‡ä»¶
          for dir in SelfContainedLib theories Quantum CS_Null Test; do
            if [ -d "$dir" ]; then
              for file in $(find "$dir" -name "*.v" 2>/dev/null); do
                TOTAL_FILES=$((TOTAL_FILES + 1))
                base=$(basename "$file" .v)
                vo_file="${file%.v}.vo"
                
                if [ -f "$vo_file" ]; then
                  COMPILED_FILES=$((COMPILED_FILES + 1))
                  
                  # æ£€æŸ¥æ˜¯å¦æ˜¯å¤§æ–‡ä»¶
                  lines=$(wc -l < "$file" 2>/dev/null || echo 0)
                  if [ "$lines" -gt 3000 ]; then
                    HUGE_FILES=$((HUGE_FILES + 1))
                    HUGE_COMPILED=$((HUGE_COMPILED + 1))
                  fi
                else
                  # æ£€æŸ¥æ˜¯å¦æ˜¯å¤§æ–‡ä»¶
                  lines=$(wc -l < "$file" 2>/dev/null || echo 0)
                  if [ "$lines" -gt 3000 ]; then
                    HUGE_FILES=$((HUGE_FILES + 1))
                  fi
                fi
              done
            fi
          done
          
          # è®¡ç®—æˆåŠŸç‡
          SUCCESS_RATE=0
          if [ "$TOTAL_FILES" -gt 0 ]; then
            SUCCESS_RATE=$((COMPILED_FILES * 100 / TOTAL_FILES))
          fi
          
          # ç”ŸæˆMarkdownæŠ¥å‘Š
          cat > verification-report/FRF2_FULL_VERIFICATION_REPORT.md << 'EOF'
# FRF 2.0 å…¨é‡å½¢å¼åŒ–éªŒè¯æŠ¥å‘Š

## éªŒè¯æ¦‚è§ˆ
          EOF
          echo "- **éªŒè¯æ—¶é—´**: $(date)" >> verification-report/FRF2_FULL_VERIFICATION_REPORT.md
          echo "- **ç¯å¢ƒ**: Ubuntu 22.04" >> verification-report/FRF2_FULL_VERIFICATION_REPORT.md
          echo "- **æ€»æ–‡ä»¶æ•°**: $TOTAL_FILES" >> verification-report/FRF2_FULL_VERIFICATION_REPORT.md
          echo "- **ç¼–è¯‘æˆåŠŸ**: $COMPILED_FILES" >> verification-report/FRF2_FULL_VERIFICATION_REPORT.md
          echo "- **ç¼–è¯‘æˆåŠŸç‡**: ${SUCCESS_RATE}%" >> verification-report/FRF2_FULL_VERIFICATION_REPORT.md
          echo "- **å¤§æ–‡ä»¶(>3000è¡Œ)**: $HUGE_FILES" >> verification-report/FRF2_FULL_VERIFICATION_REPORT.md
          echo "- **å¤§æ–‡ä»¶ç¼–è¯‘æˆåŠŸ**: $HUGE_COMPILED" >> verification-report/FRF2_FULL_VERIFICATION_REPORT.md
          
          cat >> verification-report/FRF2_FULL_VERIFICATION_REPORT.md << 'EOF'

## æ¨¡å—ç¼–è¯‘çŠ¶æ€

### å±‚çº§1: è‡ªåŒ…å«åŸºç¡€åº“
| æ¨¡å— | çŠ¶æ€ | è¡Œæ•° | å®æ•°ä¾èµ– |
|------|------|------|----------|
          EOF
          
          # åŸºç¡€åº“çŠ¶æ€
          for file in SelfContainedLib/*.v 2>/dev/null; do
            if [ -f "$file" ]; then
              base=$(basename "$file" .v)
              lines=$(wc -l < "$file" 2>/dev/null || echo 0)
              status="âŒ"
              if [ -f "${file%.v}.vo" ]; then
                status="âœ…"
              fi
              
              real_dep="å¦"
              if grep -q "Require.*Reals" "$file" 2>/dev/null; then
                real_dep="æ˜¯"
              fi
              
              echo "| $base | $status | $lines | $real_dep |" >> verification-report/FRF2_FULL_VERIFICATION_REPORT.md
            fi
          done
          
          cat >> verification-report/FRF2_FULL_VERIFICATION_REPORT.md << 'EOF'

### å±‚çº§2: FRFå…ƒç†è®º
| æ¨¡å— | çŠ¶æ€ | è¡Œæ•° | å®æ•°ä¾èµ– |
|------|------|------|----------|
EOF
          
          # å…ƒç†è®ºçŠ¶æ€
          for file in theories/FRF_MetaTheory.v theories/ChurchZero.v theories/ChurchNumerals.v; do
            if [ -f "$file" ] 2>/dev/null; then
              base=$(basename "$file" .v)
              lines=$(wc -l < "$file" 2>/dev/null || echo 0)
              status="âŒ"
              if [ -f "${file%.v}.vo" ]; then
                status="âœ…"
              fi
              
              real_dep="å¦"
              if grep -q "Require.*Reals" "$file" 2>/dev/null; then
                real_dep="æ˜¯"
              fi
              
              echo "| $base | $status | $lines | $real_dep |" >> verification-report/FRF2_FULL_VERIFICATION_REPORT.md
            fi
          done
          
          cat >> verification-report/FRF2_FULL_VERIFICATION_REPORT.md << 'EOF'

### å±‚çº§5: é›†æˆæ¨¡å—
| æ¨¡å— | çŠ¶æ€ | è¡Œæ•° | åŠŸèƒ½ |
|------|------|------|------|
EOF
          
          # é›†æˆæ¨¡å—çŠ¶æ€
          if [ -f "theories/FRF_Comparative.v" ]; then
            lines=$(wc -l < "theories/FRF_Comparative.v" 2>/dev/null || echo 0)
            status="âŒ"
            if [ -f "theories/FRF_Comparative.vo" ]; then
              status="âœ…"
            fi
            echo "| FRF_Comparative | $status | $lines | è·¨ç³»ç»Ÿå¯¹æ¯”æ ¸å¿ƒ |" >> verification-report/FRF2_FULL_VERIFICATION_REPORT.md
          fi
          
          # æ·»åŠ æ€»ç»“
          cat >> verification-report/FRF2_FULL_VERIFICATION_REPORT.md << 'EOF'

## éªŒè¯æ€»ç»“
EOF
          
          if [ "$COMPILED_FILES" -eq "$TOTAL_FILES" ]; then
            echo "ğŸ‰ **æ‰€æœ‰æ¨¡å—ç¼–è¯‘æˆåŠŸï¼**" >> verification-report/FRF2_FULL_VERIFICATION_REPORT.md
            echo "FRF 2.0 å½¢å¼åŒ–éªŒè¯å®Œå…¨é€šè¿‡ã€‚" >> verification-report/FRF2_FULL_VERIFICATION_REPORT.md
          else
            echo "âš ï¸  **éƒ¨åˆ†æ¨¡å—ç¼–è¯‘å¤±è´¥**" >> verification-report/FRF2_FULL_VERIFICATION_REPORT.md
            FAILED_COUNT=$((TOTAL_FILES - COMPILED_FILES))
            echo "å¤±è´¥æ–‡ä»¶æ•°: $FAILED_COUNT" >> verification-report/FRF2_FULL_VERIFICATION_REPORT.md
          fi
          
          cat >> verification-report/FRF2_FULL_VERIFICATION_REPORT.md << 'EOF'

## ç¯å¢ƒä¿¡æ¯