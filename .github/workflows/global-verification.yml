name: FRF 2.0 å…¨é‡å½¢å¼åŒ–éªŒè¯ï¼ˆå®Œæ•´ç‰ˆï¼‰

on:
  push:
    branches: [main, master]
  pull_request:
    branches: [main, master]
  workflow_dispatch:

jobs:
  full-formal-verification:
    runs-on: ubuntu-22.04
    timeout-minutes: 240  # å…¨é‡ç¼–è¯‘éœ€è¦æ›´é•¿æ—¶é—´
    
    steps:
    - name: ðŸ“¥ æ£€å‡ºä»£ç ä»“åº“
      uses: actions/checkout@v4
      with:
        fetch-depth: 1
        submodules: false

    - name: ðŸ–¥ï¸ ç³»ç»Ÿä¿¡æ¯æ£€æŸ¥
      run: |
        echo "=== ç³»ç»Ÿä¿¡æ¯ ==="
        echo "ç³»ç»Ÿ: $(uname -a)"
        echo "CPUæ ¸å¿ƒ: $(nproc)"
        echo "å†…å­˜: $(free -m | awk '/^Mem:/{print "æ€»é‡:" $2 "MB, å¯ç”¨:" $7 "MB"}')"
        echo "ç£ç›˜:"
        df -h
        echo ""
        echo "æ£€æŸ¥.væ–‡ä»¶:"
        find . -name "*.v" -type f | wc -l | xargs echo "æ€».væ–‡ä»¶æ•°:"

    - name: ðŸ“¦ å®‰è£…ç³»ç»Ÿä¾èµ–
      run: |
        echo "å®‰è£…ç³»ç»Ÿä¾èµ–..."
        sudo apt-get update
        sudo apt-get install -y \
          opam \
          bubblewrap \
          g++ \
          pkg-config \
          m4 \
          rsync \
          git \
          wget \
          bc
        echo "âœ… ç³»ç»Ÿä¾èµ–å®‰è£…å®Œæˆ"

    - name: ðŸ”„ åˆå§‹åŒ–OPAMçŽ¯å¢ƒ
      timeout-minutes: 20
      run: |
        echo "åˆå§‹åŒ–OPAMçŽ¯å¢ƒ..."
        opam init --disable-sandboxing -y --compiler=4.14.0
        eval $(opam env)
        opam repo add coq-released https://coq.inria.fr/opam/released
        opam update
        echo "âœ… OPAMçŽ¯å¢ƒåˆå§‹åŒ–å®Œæˆ"

    - name: ðŸ“š å®‰è£…Coq 8.18.0
      timeout-minutes: 25
      run: |
        eval $(opam env)
        echo "å®‰è£…Coq 8.18.0..."
        opam install -y --no-depexts coq.8.18.0
        echo "éªŒè¯å®‰è£…:"
        coqc --version

    - name: ðŸ“š å®‰è£…mathcomp-ssreflect
      timeout-minutes: 15
      run: |
        eval $(opam env)
        echo "å®‰è£…mathcomp-ssreflect 1.17.0..."
        opam install -y --no-depexts coq-mathcomp-ssreflect=1.17.0
        echo "éªŒè¯mathcompå®‰è£…:"
        opam list --installed | grep mathcomp

    - name: ðŸ“Š åˆ›å»ºç¼–è¯‘é…ç½®
      run: |
        echo "åˆ›å»ºç¼–è¯‘é…ç½®..."
        
        # åˆ›å»ºç¼–è¯‘è„šæœ¬
        cat > compile_all.sh << 'EOF'
        #!/bin/bash
        set -e
        
        echo "=== FRF 2.0 å…¨é‡ç¼–è¯‘å¼€å§‹ ==="
        echo "æ—¶é—´: $(date)"
        echo ""
        
        # åŸºç¡€ç¼–è¯‘å‚æ•°
        BASE_FLAGS="-w -deprecated"
        
        # å±‚çº§1ï¼šè‡ªåŒ…å«åŸºç¡€åº“
        echo "=== å±‚çº§1ï¼šè‡ªåŒ…å«åŸºç¡€åº“ ==="
        echo "ç¼–è¯‘Algebra.v..."
        coqc -Q SelfContainedLib SelfContainedLib $BASE_FLAGS SelfContainedLib/Algebra.v
        
        echo "ç¼–è¯‘Category.v..."
        coqc -Q SelfContainedLib SelfContainedLib $BASE_FLAGS SelfContainedLib/Category.v
        
        echo "ç¼–è¯‘Geometry.vï¼ˆå¤§æ–‡ä»¶ï¼‰..."
        coqc -Q SelfContainedLib SelfContainedLib $BASE_FLAGS -async-proofs on -async-proofs-tac-j 2 SelfContainedLib/Geometry.v
        
        # å±‚çº§2ï¼šFRFå…ƒç†è®ºå±‚
        echo ""
        echo "=== å±‚çº§2ï¼šFRFå…ƒç†è®ºå±‚ ==="
        echo "ç¼–è¯‘FRF_MetaTheory.vï¼ˆå¤§æ–‡ä»¶ï¼‰..."
        coqc -Q SelfContainedLib SelfContainedLib -Q theories FRF.Theories $BASE_FLAGS -async-proofs on -async-proofs-tac-j 2 theories/FRF_MetaTheory.v
        
        echo "ç¼–è¯‘ChurchZero.v..."
        coqc -Q SelfContainedLib SelfContainedLib -Q theories FRF.Theories $BASE_FLAGS theories/ChurchZero.v
        
        echo "ç¼–è¯‘ChurchNumerals.vï¼ˆæžå¤§æ–‡ä»¶ï¼‰..."
        coqc -Q SelfContainedLib SelfContainedLib -Q theories FRF.Theories $BASE_FLAGS -async-proofs on -async-proofs-tac-j 2 -m 4096 theories/ChurchNumerals.v
        
        # å±‚çº§3ï¼šæ•°å­¦åœºæ™¯å±‚
        echo ""
        echo "=== å±‚çº§3ï¼šæ•°å­¦åœºæ™¯å±‚ ==="
        echo "ç¼–è¯‘CaseA_SetTheory.v..."
        coqc -Q SelfContainedLib SelfContainedLib -Q theories FRF.Theories $BASE_FLAGS theories/CaseA_SetTheory.v
        
        echo "ç¼–è¯‘CaseB_Algebra.v..."
        coqc -Q SelfContainedLib SelfContainedLib -Q theories FRF.Theories $BASE_FLAGS theories/CaseB_Algebra.v
        
        echo "ç¼–è¯‘CaseC_TypeTheory.v..."
        coqc -Q SelfContainedLib SelfContainedLib -Q theories FRF.Theories $BASE_FLAGS theories/CaseC_TypeTheory.v
        
        echo "ç¼–è¯‘CaseD_CategoryTheory.v..."
        coqc -Q SelfContainedLib SelfContainedLib -Q theories FRF.Theories $BASE_FLAGS theories/CaseD_CategoryTheory.v
        
        echo "ç¼–è¯‘CaseE_QuantumVacuum.vï¼ˆå¤§æ–‡ä»¶ï¼‰..."
        coqc -Q SelfContainedLib SelfContainedLib -Q theories FRF.Theories $BASE_FLAGS -async-proofs on -async-proofs-tac-j 2 theories/CaseE_QuantumVacuum.v
        
        # å±‚çº§4ï¼šé‡å­æ¨¡å—
        echo ""
        echo "=== å±‚çº§4ï¼šé‡å­æ¨¡å— ==="
        echo "ç¼–è¯‘QFT_FRF.v..."
        coqc -Q SelfContainedLib SelfContainedLib -Q theories FRF.Theories -Q Quantum Quantum $BASE_FLAGS Quantum/QFT_FRF.v
        
        echo "ç¼–è¯‘CurvedSpacetimeQFT.v..."
        coqc -Q SelfContainedLib SelfContainedLib -Q theories FRF.Theories -Q Quantum Quantum $BASE_FLAGS Quantum/CurvedSpacetimeQFT.v
        
        # å±‚çº§4ï¼šç©ºå€¼ç³»ç»Ÿæ¨¡å—
        echo ""
        echo "=== å±‚çº§4ï¼šç©ºå€¼ç³»ç»Ÿæ¨¡å— ==="
        echo "ç¼–è¯‘FRF_CS_Null_Common.vï¼ˆæžå¤§æ–‡ä»¶ï¼‰..."
        coqc -Q SelfContainedLib SelfContainedLib -Q theories FRF.Theories -Q CS_Null FRF.CS_Null $BASE_FLAGS -async-proofs on -async-proofs-tac-j 2 -m 4096 CS_Null/FRF_CS_Null_Common.v
        
        echo "ç¼–è¯‘FRF_CS_Null.v..."
        coqc -Q SelfContainedLib SelfContainedLib -Q theories FRF.Theories -Q CS_Null FRF.CS_Null $BASE_FLAGS CS_Null/FRF_CS_Null.v
        
        echo "ç¼–è¯‘CxxNull.v..."
        coqc -Q SelfContainedLib SelfContainedLib -Q theories FRF.Theories -Q CS_Null FRF.CS_Null $BASE_FLAGS CS_Null/CxxNull.v
        
        echo "ç¼–è¯‘PythonNull.v..."
        coqc -Q SelfContainedLib SelfContainedLib -Q theories FRF.Theories -Q CS_Null FRF.CS_Null $BASE_FLAGS CS_Null/PythonNull.v
        
        echo "ç¼–è¯‘JavaNull.v..."
        coqc -Q SelfContainedLib SelfContainedLib -Q theories FRF.Theories -Q CS_Null FRF.CS_Null $BASE_FLAGS CS_Null/JavaNull.v
        
        echo "ç¼–è¯‘MathNull.v..."
        coqc -Q SelfContainedLib SelfContainedLib -Q theories FRF.Theories -Q CS_Null FRF.CS_Null $BASE_FLAGS CS_Null/MathNull.v
        
        echo "ç¼–è¯‘RustNull.v..."
        coqc -Q SelfContainedLib SelfContainedLib -Q theories FRF.Theories -Q CS_Null FRF.CS_Null $BASE_FLAGS CS_Null/RustNull.v
        
        # å±‚çº§5ï¼šé›†æˆæ¨¡å—
        echo ""
        echo "=== å±‚çº§5ï¼šé›†æˆæ¨¡å— ==="
        echo "ç¼–è¯‘FRF_Comparative.vï¼ˆå¤§æ–‡ä»¶ï¼‰..."
        coqc -Q SelfContainedLib SelfContainedLib -Q theories FRF.Theories -Q Quantum Quantum -Q CS_Null FRF.CS_Null $BASE_FLAGS -async-proofs on -async-proofs-tac-j 2 -m 4096 theories/FRF_Comparative.v
        
        # å±‚çº§6ï¼šæµ‹è¯•å¥—ä»¶
        echo ""
        echo "=== å±‚çº§6ï¼šæµ‹è¯•å¥—ä»¶ ==="
        echo "ç¼–è¯‘Test_Basic.v..."
        coqc -Q SelfContainedLib SelfContainedLib -Q theories FRF.Theories -Q Quantum Quantum -Q CS_Null FRF.CS_Null -Q Test FRF.Test $BASE_FLAGS Test/Test_Basic.v
        
        echo "ç¼–è¯‘Test_FRF_MetaTheory.v..."
        coqc -Q SelfContainedLib SelfContainedLib -Q theories FRF.Theories -Q Quantum Quantum -Q CS_Null FRF.CS_Null -Q Test FRF.Test $BASE_FLAGS Test/Test_FRF_MetaTheory.v
        
        echo "ç¼–è¯‘Test_QuantumVacuum.v..."
        coqc -Q SelfContainedLib SelfContainedLib -Q theories FRF.Theories -Q Quantum Quantum -Q CS_Null FRF.CS_Null -Q Test FRF.Test $BASE_FLAGS Test/Test_QuantumVacuum.v
        
        echo "ç¼–è¯‘Test_BlockchainSystem.v..."
        coqc -Q SelfContainedLib SelfContainedLib -Q theories FRF.Theories -Q Quantum Quantum -Q CS_Null FRF.CS_Null -Q Test FRF.Test $BASE_FLAGS Test/Test_BlockchainSystem.v
        
        echo "ç¼–è¯‘SelfContainedVerification.v..."
        coqc -Q SelfContainedLib SelfContainedLib -Q theories FRF.Theories -Q Quantum Quantum -Q CS_Null FRF.CS_Null -Q Test FRF.Test $BASE_FLAGS Test/SelfContainedVerification.v
        
        echo ""
        echo "=== FRF 2.0 å…¨é‡ç¼–è¯‘å®Œæˆ ==="
        echo "æ—¶é—´: $(date)"
        EOF
        
        chmod +x compile_all.sh
        echo "âœ… ç¼–è¯‘è„šæœ¬åˆ›å»ºå®Œæˆ"

    - name: ðŸš€ æ‰§è¡Œå…¨é‡ç¼–è¯‘
      timeout-minutes: 180
      run: |
        eval $(opam env)
        echo "å¼€å§‹å…¨é‡ç¼–è¯‘..."
        echo "å½“å‰æ—¶é—´: $(date)"
        echo ""
        
        # æ‰§è¡Œç¼–è¯‘è„šæœ¬
        ./compile_all.sh

    - name: ðŸ“Š ç¼–è¯‘ç»“æžœéªŒè¯
      run: |
        echo "=== ç¼–è¯‘ç»“æžœéªŒè¯ ==="
        echo ""
        
        # æ£€æŸ¥æ‰€æœ‰.voæ–‡ä»¶
        echo "æ£€æŸ¥.voæ–‡ä»¶ç”Ÿæˆæƒ…å†µ:"
        echo ""
        
        # å±‚çº§1ï¼šåŸºç¡€åº“
        echo "å±‚çº§1 - è‡ªåŒ…å«åŸºç¡€åº“:"
        for file in Algebra Category Geometry; do
          if [ -f "SelfContainedLib/$file.vo" ]; then
            echo "  âœ… SelfContainedLib/$file.vo"
          else
            echo "  âŒ SelfContainedLib/$file.vo ç¼ºå¤±"
          fi
        done
        echo ""
        
        # å±‚çº§2ï¼šFRFå…ƒç†è®º
        echo "å±‚çº§2 - FRFå…ƒç†è®º:"
        for file in FRF_MetaTheory ChurchZero ChurchNumerals; do
          if [ -f "theories/$file.vo" ]; then
            echo "  âœ… theories/$file.vo"
          else
            echo "  âŒ theories/$file.vo ç¼ºå¤±"
          fi
        done
        echo ""
        
        # å±‚çº§3ï¼šæ•°å­¦åœºæ™¯
        echo "å±‚çº§3 - æ•°å­¦åœºæ™¯:"
        for file in CaseA_SetTheory CaseB_Algebra CaseC_TypeTheory CaseD_CategoryTheory CaseE_QuantumVacuum; do
          if [ -f "theories/$file.vo" ]; then
            echo "  âœ… theories/$file.vo"
          else
            echo "  âŒ theories/$file.vo ç¼ºå¤±"
          fi
        done
        echo ""
        
        # å±‚çº§4ï¼šé‡å­æ¨¡å—
        echo "å±‚çº§4 - é‡å­æ¨¡å—:"
        for file in QFT_FRF CurvedSpacetimeQFT; do
          if [ -f "Quantum/$file.vo" ]; then
            echo "  âœ… Quantum/$file.vo"
          else
            echo "  âŒ Quantum/$file.vo ç¼ºå¤±"
          fi
        done
        echo ""
        
        # å±‚çº§4ï¼šç©ºå€¼ç³»ç»Ÿ
        echo "å±‚çº§4 - ç©ºå€¼ç³»ç»Ÿ:"
        for file in FRF_CS_Null_Common FRF_CS_Null CxxNull PythonNull JavaNull MathNull RustNull; do
          if [ -f "CS_Null/$file.vo" ]; then
            echo "  âœ… CS_Null/$file.vo"
          else
            echo "  âŒ CS_Null/$file.vo ç¼ºå¤±"
          fi
        done
        echo ""
        
        # å±‚çº§5ï¼šé›†æˆæ¨¡å—
        echo "å±‚çº§5 - é›†æˆæ¨¡å—:"
        if [ -f "theories/FRF_Comparative.vo" ]; then
          echo "  âœ… theories/FRF_Comparative.vo"
        else
          echo "  âŒ theories/FRF_Comparative.vo ç¼ºå¤±"
        fi
        echo ""
        
        # å±‚çº§6ï¼šæµ‹è¯•å¥—ä»¶
        echo "å±‚çº§6 - æµ‹è¯•å¥—ä»¶:"
        for file in Test_Basic Test_FRF_MetaTheory Test_QuantumVacuum Test_BlockchainSystem SelfContainedVerification; do
          if [ -f "Test/$file.vo" ]; then
            echo "  âœ… Test/$file.vo"
          else
            echo "  âŒ Test/$file.vo ç¼ºå¤±"
          fi
        done
        echo ""
        
        # ç»Ÿè®¡æ€»æ•°
        total_files=$(find . -name "*.v" -type f | wc -l)
        compiled_files=$(find . -name "*.vo" -type f | wc -l)
        
        echo "ç»Ÿè®¡æ‘˜è¦:"
        echo "æ€».væ–‡ä»¶æ•°: $total_files"
        echo "ç¼–è¯‘æˆåŠŸæ•°: $compiled_files"
        
        if [ $compiled_files -eq $total_files ]; then
          echo "ðŸŽ‰ æ‰€æœ‰æ–‡ä»¶ç¼–è¯‘æˆåŠŸï¼"
        else
          echo "âš ï¸  æœ‰ $((total_files - compiled_files)) ä¸ªæ–‡ä»¶æœªç¼–è¯‘æˆåŠŸ"
        fi

    - name: ðŸ“„ ç”Ÿæˆè¯¦ç»†æŠ¥å‘Š
      run: |
        echo "ç”Ÿæˆè¯¦ç»†éªŒè¯æŠ¥å‘Š..."
        
        # åˆ›å»ºæŠ¥å‘Šç›®å½•
        mkdir -p verification-reports
        
        # ç”ŸæˆæŠ¥å‘Š
        cat > verification-reports/FRF_FULL_COMPILATION_REPORT.md << 'EOF'
# FRF 2.0 å…¨é‡å½¢å¼åŒ–ç¼–è¯‘æŠ¥å‘Š

## ç¼–è¯‘æ¦‚è¿°
- **ç¼–è¯‘æ—¶é—´**: $(date)
- **è¿è¡ŒçŽ¯å¢ƒ**: GitHub Actions (Ubuntu 22.04)
- **Coqç‰ˆæœ¬**: $(coqc --version 2>/dev/null | head -1)
- **æ€»ç¼–è¯‘æ–‡ä»¶æ•°**: 27ä¸ªæ ¸å¿ƒæ¨¡å—
- **ç¼–è¯‘çŠ¶æ€**: å…¨é‡ç¼–è¯‘

## æ¨¡å—ç¼–è¯‘çŠ¶æ€

### å±‚çº§1ï¼šè‡ªåŒ…å«åŸºç¡€åº“ (3ä¸ªæ–‡ä»¶)
EOF
        
        # æ·»åŠ å±‚çº§1çŠ¶æ€
        for file in Algebra Category Geometry; do
          if [ -f "SelfContainedLib/$file.vo" ]; then
            echo "- âœ… **$file.v** - ç¼–è¯‘æˆåŠŸ" >> verification-reports/FRF_FULL_COMPILATION_REPORT.md
          else
            echo "- âŒ **$file.v** - ç¼–è¯‘å¤±è´¥" >> verification-reports/FRF_FULL_COMPILATION_REPORT.md
          fi
        done
        
        cat >> verification-reports/FRF_FULL_COMPILATION_REPORT.md << 'EOF'

### å±‚çº§2ï¼šFRFå…ƒç†è®ºå±‚ (3ä¸ªæ–‡ä»¶)
EOF
        
        # æ·»åŠ å±‚çº§2çŠ¶æ€
        for file in FRF_MetaTheory ChurchZero ChurchNumerals; do
          if [ -f "theories/$file.vo" ]; then
            echo "- âœ… **$file.v** - ç¼–è¯‘æˆåŠŸ" >> verification-reports/FRF_FULL_COMPILATION_REPORT.md
          else
            echo "- âŒ **$file.v** - ç¼–è¯‘å¤±è´¥" >> verification-reports/FRF_FULL_COMPILATION_REPORT.md
          fi
        done
        
        cat >> verification-reports/FRF_FULL_COMPILATION_REPORT.md << 'EOF'

### å±‚çº§3ï¼šæ•°å­¦åœºæ™¯å±‚ (5ä¸ªæ–‡ä»¶)
EOF
        
        # æ·»åŠ å±‚çº§3çŠ¶æ€
        for file in CaseA_SetTheory CaseB_Algebra CaseC_TypeTheory CaseD_CategoryTheory CaseE_QuantumVacuum; do
          if [ -f "theories/$file.vo" ]; then
            echo "- âœ… **$file.v** - ç¼–è¯‘æˆåŠŸ" >> verification-reports/FRF_FULL_COMPILATION_REPORT.md
          else
            echo "- âŒ **$file.v** - ç¼–è¯‘å¤±è´¥" >> verification-reports/FRF_FULL_COMPILATION_REPORT.md
          fi
        done
        
        cat >> verification-reports/FRF_FULL_COMPILATION_REPORT.md << 'EOF'

### å±‚çº§4ï¼šé‡å­æ¨¡å— (2ä¸ªæ–‡ä»¶)
EOF
        
        # æ·»åŠ é‡å­æ¨¡å—çŠ¶æ€
        for file in QFT_FRF CurvedSpacetimeQFT; do
          if [ -f "Quantum/$file.vo" ]; then
            echo "- âœ… **$file.v** - ç¼–è¯‘æˆåŠŸ" >> verification-reports/FRF_FULL_COMPILATION_REPORT.md
          else
            echo "- âŒ **$file.v** - ç¼–è¯‘å¤±è´¥" >> verification-reports/FRF_FULL_COMPILATION_REPORT.md
          fi
        done
        
        cat >> verification-reports/FRF_FULL_COMPILATION_REPORT.md << 'EOF'

### å±‚çº§4ï¼šç©ºå€¼ç³»ç»Ÿæ¨¡å— (8ä¸ªæ–‡ä»¶)
EOF
        
        # æ·»åŠ ç©ºå€¼ç³»ç»ŸçŠ¶æ€
        for file in FRF_CS_Null_Common FRF_CS_Null CxxNull PythonNull JavaNull MathNull RustNull; do
          if [ -f "CS_Null/$file.vo" ]; then
            echo "- âœ… **$file.v** - ç¼–è¯‘æˆåŠŸ" >> verification-reports/FRF_FULL_COMPILATION_REPORT.md
          else
            echo "- âŒ **$file.v** - ç¼–è¯‘å¤±è´¥" >> verification-reports/FRF_FULL_COMPILATION_REPORT.md
          fi
        done
        
        cat >> verification-reports/FRF_FULL_COMPILATION_REPORT.md << 'EOF'

### å±‚çº§5ï¼šé›†æˆæ¨¡å— (1ä¸ªæ–‡ä»¶)
EOF
        
        # æ·»åŠ é›†æˆæ¨¡å—çŠ¶æ€
        if [ -f "theories/FRF_Comparative.vo" ]; then
          echo "- âœ… **FRF_Comparative.v** - ç¼–è¯‘æˆåŠŸ" >> verification-reports/FRF_FULL_COMPILATION_REPORT.md
        else
          echo "- âŒ **FRF_Comparative.v** - ç¼–è¯‘å¤±è´¥" >> verification-reports/FRF_FULL_COMPILATION_REPORT.md
        fi
        
        cat >> verification-reports/FRF_FULL_COMPILATION_REPORT.md << 'EOF'

### å±‚çº§6ï¼šæµ‹è¯•å¥—ä»¶ (5ä¸ªæ–‡ä»¶)
EOF
        
        # æ·»åŠ æµ‹è¯•å¥—ä»¶çŠ¶æ€
        for file in Test_Basic Test_FRF_MetaTheory Test_QuantumVacuum Test_BlockchainSystem SelfContainedVerification; do
          if [ -f "Test/$file.vo" ]; then
            echo "- âœ… **$file.v** - ç¼–è¯‘æˆåŠŸ" >> verification-reports/FRF_FULL_COMPILATION_REPORT.md
          else
            echo "- âŒ **$file.v** - ç¼–è¯‘å¤±è´¥" >> verification-reports/FRF_FULL_COMPILATION_REPORT.md
          fi
        done
        
        # è®¡ç®—ç»Ÿè®¡
        total_files=27
        compiled_files=$(find . -name "*.vo" -type f | wc -l)
        success_rate=$((compiled_files * 100 / total_files))
        
        cat >> verification-reports/FRF_FULL_COMPILATION_REPORT.md << EOF

## ç»Ÿè®¡æ‘˜è¦
- **æ€»æ¨¡å—æ•°**: $total_files
- **ç¼–è¯‘æˆåŠŸæ•°**: $compiled_files
- **ç¼–è¯‘æˆåŠŸçŽ‡**: $success_rate%

## å¤§æ–‡ä»¶ç¼–è¯‘çŠ¶æ€
EOF
        
        # å¤§æ–‡ä»¶çŠ¶æ€
        huge_files=("Geometry.v" "FRF_MetaTheory.v" "ChurchNumerals.v" "CaseE_QuantumVacuum.v" "FRF_CS_Null_Common.v" "FRF_Comparative.v")
        for file in "${huge_files[@]}"; do
          # æŸ¥æ‰¾æ–‡ä»¶ä½ç½®
          found=false
          for dir in SelfContainedLib theories Quantum CS_Null; do
            if [ -f "$dir/$file" ]; then
              if [ -f "$dir/${file%.v}.vo" ]; then
                echo "- âœ… **$file** (å¤§æ–‡ä»¶) - ç¼–è¯‘æˆåŠŸ" >> verification-reports/FRF_FULL_COMPILATION_REPORT.md
              else
                echo "- âŒ **$file** (å¤§æ–‡ä»¶) - ç¼–è¯‘å¤±è´¥" >> verification-reports/FRF_FULL_COMPILATION_REPORT.md
              fi
              found=true
              break
            fi
          done
          if [ "$found" = false ]; then
            echo "- â“ **$file** (å¤§æ–‡ä»¶) - æ–‡ä»¶æœªæ‰¾åˆ°" >> verification-reports/FRF_FULL_COMPILATION_REPORT.md
          fi
        done
        
        cat >> verification-reports/FRF_FULL_COMPILATION_REPORT.md << 'EOF'

## ç»“è®º
EOF
        
        if [ $compiled_files -eq $total_files ]; then
          cat >> verification-reports/FRF_FULL_COMPILATION_REPORT.md << 'EOF'
ðŸŽ‰ **FRF 2.0 å…¨é‡å½¢å¼åŒ–ç¼–è¯‘å®Œå…¨æˆåŠŸï¼**

æ‰€æœ‰27ä¸ªæ ¸å¿ƒæ¨¡å—å‡ç¼–è¯‘æˆåŠŸï¼ŒåŒ…æ‹¬6ä¸ªå¤§æ–‡ä»¶ä¹Ÿå·²æˆåŠŸç¼–è¯‘ã€‚é¡¹ç›®æž¶æž„å®Œæ•´ï¼Œå½¢å¼åŒ–éªŒè¯åŸºç¡€å°±ç»ªã€‚

**ä¸‹ä¸€æ­¥å»ºè®®**ï¼š
1. è¿è¡Œ `make report` ç”Ÿæˆè·¨ç³»ç»Ÿå¯¹æ¯”æŠ¥å‘Š
2. æ‰§è¡Œæµ‹è¯•éªŒè¯åŠŸèƒ½æ­£ç¡®æ€§
3. è¿›è¡Œæ€§èƒ½åˆ†æžå’Œä¼˜åŒ–
EOF
        else
          cat >> verification-reports/FRF_FULL_COMPILATION_REPORT.md << EOF
âš ï¸ **FRF 2.0 ç¼–è¯‘éƒ¨åˆ†æˆåŠŸ**

å·²ç¼–è¯‘ $compiled_files ä¸ªæ¨¡å—ï¼ˆå…± $total_files ä¸ªï¼‰ï¼Œ$((total_files - compiled_files)) ä¸ªæ¨¡å—ç¼–è¯‘å¤±è´¥ã€‚

**å»ºè®®**ï¼š
1. æ£€æŸ¥ç¼–è¯‘é”™è¯¯æ—¥å¿—
2. éªŒè¯ä¾èµ–å…³ç³»
3. è°ƒæ•´å¤§æ–‡ä»¶ç¼–è¯‘å‚æ•°
EOF
        fi
        
        cat >> verification-reports/FRF_FULL_COMPILATION_REPORT.md << EOF

---
*æŠ¥å‘Šç”Ÿæˆæ—¶é—´: $(date)*
*GitHub Actions Run ID: ${GITHUB_RUN_ID}*
EOF
        
        echo "âœ… è¯¦ç»†æŠ¥å‘Šç”Ÿæˆå®Œæˆ"

    - name: ðŸ“¤ ä¸Šä¼ ç¼–è¯‘æŠ¥å‘Š
      uses: actions/upload-artifact@v4
      with:
        name: frf-2.0-full-compilation-report
        path: verification-reports/
        retention-days: 30

    - name: ðŸŽ‰ æˆåŠŸé€šçŸ¥
      if: success()
      run: |
        echo ""
        echo "ðŸŽ‰ðŸŽ‰ðŸŽ‰ FRF 2.0 å…¨é‡ç¼–è¯‘æˆåŠŸï¼"
        echo "========================================="
        echo "âœ… æ‰€æœ‰27ä¸ªæ ¸å¿ƒæ¨¡å—ç¼–è¯‘å®Œæˆ"
        echo "âœ… 6ä¸ªå¤§æ–‡ä»¶ç‰¹æ®Šå¤„ç†æˆåŠŸ"
        echo "âœ… å…­å±‚æž¶æž„å®Œæ•´æž„å»º"
        echo "ðŸ“Š è¯¦ç»†æŠ¥å‘Šå·²ç”Ÿæˆ"
        echo "ðŸ•’ å®Œæˆæ—¶é—´: $(date)"
        echo "========================================="
        
        # æ˜¾ç¤ºç¼–è¯‘æ–‡ä»¶ç»Ÿè®¡
        echo ""
        echo "ðŸ“Š ç¼–è¯‘ç»Ÿè®¡:"
        echo "æ€»æ–‡ä»¶æ•°: $(find . -name "*.vo" | wc -l)"
        echo "å¤§æ–‡ä»¶ç¼–è¯‘: 6/6"
        echo "æµ‹è¯•æ–‡ä»¶: 5/5"
        
        # åˆ—å‡ºå¤§æ–‡ä»¶ç¼–è¯‘çŠ¶æ€
        echo ""
        echo "ðŸ”´ å¤§æ–‡ä»¶ç¼–è¯‘çŠ¶æ€:"
        huge_files_success=0
        for file in Geometry FRF_MetaTheory ChurchNumerals CaseE_QuantumVacuum FRF_CS_Null_Common FRF_Comparative; do
          # æŸ¥æ‰¾æ–‡ä»¶
          found=false
          for dir in SelfContainedLib theories Quantum CS_Null; do
            if [ -f "$dir/$file.vo" ]; then
              echo "  âœ… $file.vo"
              huge_files_success=$((huge_files_success + 1))
              found=true
              break
            fi
          done
          if [ "$found" = false ]; then
            echo "  âŒ $file.vo"
          fi
        done
        
        if [ $huge_files_success -eq 6 ]; then
          echo "âœ… æ‰€æœ‰å¤§æ–‡ä»¶ç¼–è¯‘æˆåŠŸï¼"
        else
          echo "âš ï¸  æœ‰ $((6 - huge_files_success)) ä¸ªå¤§æ–‡ä»¶ç¼–è¯‘å¤±è´¥"
        fi

    - name: âš ï¸ å¤±è´¥é€šçŸ¥
      if: failure()
      run: |
        echo ""
        echo "âŒ FRF 2.0 ç¼–è¯‘å¤±è´¥"
        echo "========================================="
        echo "âš ï¸  éƒ¨åˆ†æ¨¡å—ç¼–è¯‘å¤±è´¥"
        echo ""
        echo "ðŸ” å»ºè®®æ£€æŸ¥:"
        echo "1. æŸ¥çœ‹ç¼–è¯‘æ—¥å¿—ä¸­çš„å…·ä½“é”™è¯¯"
        echo "2. æ£€æŸ¥å¤§æ–‡ä»¶ç¼–è¯‘å‚æ•°"
        echo "3. éªŒè¯CoqçŽ¯å¢ƒé…ç½®"
        echo "4. ç¡®è®¤æ‰€æœ‰ä¾èµ–æ–‡ä»¶å­˜åœ¨"
        echo "========================================="
        
        # æ˜¾ç¤ºå¤±è´¥æ–‡ä»¶
        echo ""
        echo "ðŸ“‹ å¯èƒ½å¤±è´¥çš„æ–‡ä»¶:"
        total_files=$(find . -name "*.v" | wc -l)
        compiled_files=$(find . -name "*.vo" | wc -l)
        echo "æ€»æ–‡ä»¶æ•°: $total_files"
        echo "ç¼–è¯‘æˆåŠŸæ•°: $compiled_files"
        echo "å¤±è´¥æ–‡ä»¶æ•°: $((total_files - compiled_files))"
        
        # åˆ—å‡ºæœªç¼–è¯‘çš„æ–‡ä»¶
        echo ""
        echo "ðŸ“ æœªç¼–è¯‘çš„.væ–‡ä»¶:"
        for v_file in $(find . -name "*.v"); do
          vo_file="${v_file%.v}.vo"
          if [ ! -f "$vo_file" ]; then
            echo "  âŒ $v_file"
          fi
        done