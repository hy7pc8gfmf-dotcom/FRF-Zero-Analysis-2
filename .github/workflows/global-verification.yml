# 修改容器配置，移除root用户运行
container:
  image: coqorg/coq:8.19.2
  # 移除 --user root 选项，使用容器默认用户

# 调整权限修复步骤（适配非root用户）
- name: 修复目录权限
  run: |
    # 确保工作目录权限正确
    chown -R $(id -u):$(id -g) ${{ github.workspace }}
    mkdir -p ${{ env.TEMP_DIR }}
    chmod -R 777 /__w/_temp/
    # 修复opam目录权限（非root用户需要）
    mkdir -p ~/.opam
    chown -R $(id -u):$(id -g) ~/.opam
    echo "✅ 目录权限修复完成"

# 修改opam初始化命令（添加允许root运行的参数，如必要）
- name: 安装依赖
  working-directory: ${{ github.workspace }}
  run: |
    # 添加 --allow-root 允许root用户运行（如果仍需root）
    opam init --disable-sandboxing --allow-root -y
    eval $(opam env)
    # 后续命令保持不变...