name: FRF 2.0 æ™ºèƒ½å…¨é‡å½¢å¼åŒ–éªŒè¯ï¼ˆä¿®å¤OPAMé—®é¢˜ç‰ˆï¼‰

on:
  push:
    branches: [main, master, develop]
    paths:
      - 'SelfContainedLib/**'
      - 'theories/**'
      - 'Quantum/**'
      - 'CS_Null/**'
      - 'Test/**'
      - '.github/workflows/global-verification.yml'
  pull_request:
    branches: [main, master]
    paths:
      - 'SelfContainedLib/**'
      - 'theories/**'
      - 'Quantum/**'
      - 'CS_Null/**'
      - 'Test/**'
  workflow_dispatch:
    inputs:
      verify_mode:
        description: 'éªŒè¯æ¨¡å¼'
        required: true
        default: 'full'
        type: choice
        options:
          - full
          - quick
          - test-only
          - report-only
      parallel_jobs:
        description: 'å¹¶è¡Œä»»åŠ¡æ•°'
        required: false
        default: '4'
        type: string

jobs:
  # åˆå¹¶ç¯å¢ƒé…ç½®å’Œä¾èµ–å®‰è£…ä¸ºä¸€ä¸ªä½œä¸šï¼Œé¿å…OPAMç¯å¢ƒé—®é¢˜
  setup-and-install:
    name: ğŸ”§ ç¯å¢ƒé…ç½®ä¸ä¾èµ–å®‰è£…
    runs-on: ubuntu-22.04
    timeout-minutes: 90
    outputs:
      coq_version: ${{ steps.verify-coq.outputs.version }}
      coq_ready: ${{ steps.verify-coq.outputs.ready }}
    steps:
      - name: ğŸ“¥ æ£€å‡ºä»£ç 
        uses: actions/checkout@v4
        with:
          fetch-depth: 1
          submodules: true

      - name: ğŸ–¥ï¸ ç³»ç»Ÿä¿¡æ¯æ£€æŸ¥
        run: |
          echo "=== ç³»ç»Ÿä¿¡æ¯ ==="
          echo "ç³»ç»Ÿ: $(uname -a)"
          echo "CPUæ ¸å¿ƒ: $(nproc)"
          echo "å¯ç”¨å†…å­˜: $(free -m | awk '/^Mem:/{print $7}')MB"
          echo "ç£ç›˜ç©ºé—´:"
          df -h

      - name: ğŸ“¦ å®‰è£…ç³»ç»Ÿä¾èµ–ï¼ˆåŸºäºå¯æ‰§è¡Œç‰ˆï¼‰
        run: |
          echo "å®‰è£…ç³»ç»Ÿä¾èµ–..."
          sudo apt-get update
          sudo apt-get install -y \
            opam \
            bubblewrap \
            g++ \
            pkg-config \
            m4 \
            rsync \
            git \
            wget
          echo "âœ… ç³»ç»Ÿä¾èµ–å®‰è£…å®Œæˆ"

      - name: ğŸ”„ åˆå§‹åŒ–OPAMç¯å¢ƒï¼ˆåŸºäºå¯æ‰§è¡Œç‰ˆï¼‰
        run: |
          echo "åˆå§‹åŒ–OPAMç¯å¢ƒ..."
          opam init --disable-sandboxing -y --compiler=4.14.0
          eval $(opam env)
          opam repo add coq-released https://coq.inria.fr/opam/released
          opam update
          echo "âœ… OPAMç¯å¢ƒåˆå§‹åŒ–å®Œæˆ"
          echo "OPAMç‰ˆæœ¬: $(opam --version)"

      - name: ğŸ“š å®‰è£…Coqæ ¸å¿ƒï¼ˆåŸºäºå¯æ‰§è¡Œç‰ˆï¼‰
        id: install-coq
        run: |
          eval $(opam env)
          echo "å®‰è£…Coq 8.18.0..."
          opam install -y coq.8.18.0
          
          echo "éªŒè¯Coqå®‰è£…..."
          if coqc --version | grep -q "8.18.0"; then
            echo "âœ… Coq 8.18.0 å®‰è£…æˆåŠŸ"
            echo "ready=true" >> $GITHUB_OUTPUT
          else
            echo "âŒ Coqç‰ˆæœ¬ä¸åŒ¹é…"
            echo "ready=false" >> $GITHUB_OUTPUT
            exit 1
          fi

      - name: ğŸ§® å®‰è£…mathcompï¼ˆåŸºäºå¯æ‰§è¡Œç‰ˆï¼‰
        run: |
          eval $(opam env)
          echo "å®‰è£…å…¼å®¹çš„mathcomp-ssreflect 1.17.0..."
          opam install -y coq-mathcomp-ssreflect.1.17.0
          
          echo "éªŒè¯mathcompå®‰è£…..."
          if opam list --installed | grep -q "coq-mathcomp-ssreflect.1.17.0"; then
            echo "âœ… mathcomp-ssreflect 1.17.0 å®‰è£…æˆåŠŸ"
          else
            echo "âŒ mathcompå®‰è£…å¤±è´¥"
            exit 1
          fi

      - name: ğŸ“Š å®‰è£…å¤–éƒ¨åº“
        run: |
          eval $(opam env)
          echo "å®‰è£…å¤–éƒ¨ä¾èµ–åº“..."
          
          # å®æ•°åº“
          opam install -y coq-mathcomp-analysis || echo "âš ï¸ mathcomp-analysiså®‰è£…å¤±è´¥ï¼Œä½†ç»§ç»­"
          
          # æ ‡å‡†åº“
          opam install -y coq-stdlib || echo "âš ï¸ stdlibå®‰è£…å¤±è´¥ï¼Œä½†ç»§ç»­"
          
          # å¤§æ•´æ•°åº“
          opam install -y coq-bignums || echo "âš ï¸ bignumså®‰è£…å¤±è´¥ï¼Œä½†ç»§ç»­"
          
          # æ—¶é—´é™åˆ¶
          opam install -y coq-time || echo "âš ï¸ timeå®‰è£…å¤±è´¥ï¼Œä½†ç»§ç»­"
          
          echo "âœ… ä¾èµ–å®‰è£…å®Œæˆ"

      - name: ğŸ” éªŒè¯ç¯å¢ƒ
        id: verify-coq
        run: |
          eval $(opam env)
          echo "=== ç¯å¢ƒéªŒè¯æŠ¥å‘Š ==="
          
          COQ_VERSION=$(coqc --version | head -1)
          echo "Coqç‰ˆæœ¬: $COQ_VERSION"
          echo "version=$COQ_VERSION" >> $GITHUB_OUTPUT
          
          OPAM_VERSION=$(opam --version)
          echo "OPAMç‰ˆæœ¬: $OPAM_VERSION"
          
          echo "å·²å®‰è£…çš„Coqç›¸å…³åŒ…:"
          opam list --installed | grep "coq" | head -20
          
          echo "âœ… ç¯å¢ƒéªŒè¯å®Œæˆ"
          echo "ready=true" >> $GITHUB_OUTPUT

      - name: ğŸ’¾ ç¼“å­˜OPAMç¯å¢ƒ
        uses: actions/cache@v3
        id: cache-opam
        with:
          path: |
            ~/.opam
            /usr/local/bin/opam
          key: ${{ runner.os }}-opam-coq-8.18.0-${{ hashFiles('**/*.v', '**/*.opam') }}
          restore-keys: |
            ${{ runner.os }}-opam-coq-8.18.0-
            ${{ runner.os }}-opam-

  # ç¬¬ä¸€é˜¶æ®µç¼–è¯‘ï¼šåŸºç¡€åº“
  compile-phase-1:
    name: ğŸ—ï¸ é˜¶æ®µ1:åŸºç¡€åº“ç¼–è¯‘
    needs: setup-and-install
    runs-on: ubuntu-22.04
    timeout-minutes: 45
    steps:
      - name: ğŸ“¥ æ£€å‡ºä»£ç 
        uses: actions/checkout@v4
        with:
          fetch-depth: 1

      - name: ğŸ”„ æ¢å¤å¹¶è®¾ç½®OPAMç¯å¢ƒ
        run: |
          echo "è®¾ç½®OPAMç¯å¢ƒ..."
          # å¦‚æœç¼“å­˜æ¢å¤å¤±è´¥ï¼Œé‡æ–°åˆå§‹åŒ–
          if ! command -v opam &> /dev/null; then
            echo "OPAMæœªæ‰¾åˆ°ï¼Œé‡æ–°å®‰è£…..."
            sudo apt-get update
            sudo apt-get install -y opam bubblewrap
            opam init --disable-sandboxing -y --compiler=4.14.0
          fi
          
          eval $(opam env)
          echo "âœ… OPAMç¯å¢ƒå·²è®¾ç½®"
          echo "OPAMç‰ˆæœ¬: $(opam --version)"
          echo "Coqç‰ˆæœ¬: $(coqc --version | head -1)"

      - name: ğŸ“Š ç¼–è¯‘å‰æ£€æŸ¥
        run: |
          echo "=== åŸºç¡€åº“ç¼–è¯‘å‰æ£€æŸ¥ ==="
          echo "å·¥ä½œç›®å½•: $(pwd)"
          echo "åŸºç¡€åº“æ–‡ä»¶:"
          ls -la SelfContainedLib/*.v 2>/dev/null || echo "æ— åŸºç¡€åº“æ–‡ä»¶"
          echo ""
          echo "ç¼–è¯‘ç¯å¢ƒ:"
          coqc --version

      - name: ğŸ”§ ç¼–è¯‘Algebra.v
        run: |
          eval $(opam env)
          echo "ç¼–è¯‘Algebra.v..."
          
          if [ -f "SelfContainedLib/Algebra.v" ]; then
            if coqc -Q SelfContainedLib SelfContainedLib SelfContainedLib/Algebra.v; then
              echo "âœ… Algebra.v ç¼–è¯‘æˆåŠŸ"
            else
              echo "âŒ Algebra.v ç¼–è¯‘å¤±è´¥"
              exit 1
            fi
          else
            echo "âŒ Algebra.v æ–‡ä»¶ç¼ºå¤±"
            exit 1
          fi

      - name: ğŸ”§ ç¼–è¯‘Category.v
        run: |
          eval $(opam env)
          echo "ç¼–è¯‘Category.v..."
          
          if [ -f "SelfContainedLib/Category.v" ]; then
            if coqc -Q SelfContainedLib SelfContainedLib SelfContainedLib/Category.v; then
              echo "âœ… Category.v ç¼–è¯‘æˆåŠŸ"
            else
              echo "âŒ Category.v ç¼–è¯‘å¤±è´¥"
              exit 1
            fi
          else
            echo "âŒ Category.v æ–‡ä»¶ç¼ºå¤±"
            exit 1
          fi

      - name: ğŸ”§ ç¼–è¯‘Geometry.v
        run: |
          eval $(opam env)
          echo "ç¼–è¯‘Geometry.v..."
          
          if [ -f "SelfContainedLib/Geometry.v" ]; then
            if coqc -Q SelfContainedLib SelfContainedLib SelfContainedLib/Geometry.v; then
              echo "âœ… Geometry.v ç¼–è¯‘æˆåŠŸ"
            else
              echo "âŒ Geometry.v ç¼–è¯‘å¤±è´¥"
              exit 1
            fi
          else
            echo "âŒ Geometry.v æ–‡ä»¶ç¼ºå¤±"
            exit 1
          fi

      - name: ğŸ“ˆ ç¼–è¯‘ç»“æœç»Ÿè®¡
        run: |
          echo "=== åŸºç¡€åº“ç¼–è¯‘ç»Ÿè®¡ ==="
          echo "ç¼–è¯‘æ–‡ä»¶:"
          for file in Algebra Category Geometry; do
            if [ -f "SelfContainedLib/$file.vo" ]; then
              size=$(stat -c%s "SelfContainedLib/$file.vo" 2>/dev/null || echo 0)
              echo "  âœ… $file.vo (${size} bytes)"
            else
              echo "  âŒ $file.vo (ç¼ºå¤±)"
            fi
          done

      - name: ğŸ’¾ ä¿å­˜ç¼–è¯‘ç»“æœ
        uses: actions/upload-artifact@v4
        with:
          name: phase-1-compiled
          path: |
            SelfContainedLib/*.vo
            SelfContainedLib/*.glob
          retention-days: 7

  # ç¬¬äºŒé˜¶æ®µç¼–è¯‘ï¼šå…ƒç†è®ºå±‚
  compile-phase-2:
    name: ğŸ§  é˜¶æ®µ2:å…ƒç†è®ºå±‚ç¼–è¯‘
    needs: [setup-and-install, compile-phase-1]
    runs-on: ubuntu-22.04
    timeout-minutes: 60
    steps:
      - name: ğŸ“¥ æ£€å‡ºä»£ç 
        uses: actions/checkout@v4
        with:
          fetch-depth: 1

      - name: ğŸ”„ æ¢å¤å¹¶è®¾ç½®OPAMç¯å¢ƒ
        run: |
          # ç¡®ä¿OPAMç¯å¢ƒæ­£ç¡®è®¾ç½®
          if ! command -v opam &> /dev/null; then
            echo "OPAMæœªæ‰¾åˆ°ï¼Œé‡æ–°å®‰è£…..."
            sudo apt-get update
            sudo apt-get install -y opam bubblewrap
            opam init --disable-sandboxing -y --compiler=4.14.0
          fi
          
          eval $(opam env)
          echo "âœ… OPAMç¯å¢ƒå·²è®¾ç½®"

      - name: ğŸ“¥ æ¢å¤é˜¶æ®µ1ç»“æœ
        uses: actions/download-artifact@v4
        with:
          name: phase-1-compiled
          path: .

      - name: ğŸ“Š æ£€æŸ¥å…ƒç†è®ºæ–‡ä»¶
        run: |
          echo "=== å…ƒç†è®ºå±‚æ–‡ä»¶æ£€æŸ¥ ==="
          echo "å…ƒç†è®ºæ–‡ä»¶:"
          ls -la theories/*.v 2>/dev/null || echo "æ— å…ƒç†è®ºæ–‡ä»¶"

      - name: ğŸ”§ ç¼–è¯‘FRF_MetaTheory.v
        run: |
          eval $(opam env)
          echo "ç¼–è¯‘FRF_MetaTheory.v..."
          
          if [ -f "theories/FRF_MetaTheory.v" ]; then
            if coqc -Q SelfContainedLib SelfContainedLib -Q theories FRF.Theories theories/FRF_MetaTheory.v; then
              echo "âœ… FRF_MetaTheory.v ç¼–è¯‘æˆåŠŸ"
            else
              echo "âŒ FRF_MetaTheory.v ç¼–è¯‘å¤±è´¥"
              exit 1
            fi
          else
            echo "âŒ FRF_MetaTheory.v æ–‡ä»¶ç¼ºå¤±"
            exit 1
          fi

      - name: ğŸ”§ ç¼–è¯‘ChurchNumerals.v
        run: |
          eval $(opam env)
          echo "ç¼–è¯‘ChurchNumerals.v..."
          
          if [ -f "theories/ChurchNumerals.v" ]; then
            if coqc -Q SelfContainedLib SelfContainedLib -Q theories FRF.Theories theories/ChurchNumerals.v; then
              echo "âœ… ChurchNumerals.v ç¼–è¯‘æˆåŠŸ"
            else
              echo "âŒ ChurchNumerals.v ç¼–è¯‘å¤±è´¥"
              exit 1
            fi
          else
            echo "âŒ ChurchNumerals.v æ–‡ä»¶ç¼ºå¤±"
            exit 1
          fi

      - name: ğŸ”§ ç¼–è¯‘ChurchZero.v
        run: |
          eval $(opam env)
          echo "ç¼–è¯‘ChurchZero.v..."
          
          if [ -f "theories/ChurchZero.v" ]; then
            if coqc -Q SelfContainedLib SelfContainedLib -Q theories FRF.Theories theories/ChurchZero.v; then
              echo "âœ… ChurchZero.v ç¼–è¯‘æˆåŠŸ"
            else
              echo "âŒ ChurchZero.v ç¼–è¯‘å¤±è´¥"
              exit 1
            fi
          else
            echo "âŒ ChurchZero.v æ–‡ä»¶ç¼ºå¤±"
            exit 1
          fi

      - name: ğŸ“ˆ å…ƒç†è®ºç¼–è¯‘ç»Ÿè®¡
        run: |
          echo "=== å…ƒç†è®ºå±‚ç¼–è¯‘ç»Ÿè®¡ ==="
          echo "æˆåŠŸç¼–è¯‘çš„æ–‡ä»¶:"
          vo_count=0
          for file in theories/*.vo 2>/dev/null; do
            if [ -f "$file" ]; then
              base=$(basename "$file" .vo)
              echo "  âœ… $base.vo"
              vo_count=$((vo_count + 1))
            fi
          done
          echo "æ€»è®¡: $vo_count ä¸ªæ–‡ä»¶ç¼–è¯‘æˆåŠŸ"

      - name: ğŸ’¾ ä¿å­˜ç¼–è¯‘ç»“æœ
        uses: actions/upload-artifact@v4
        with:
          name: phase-2-compiled
          path: |
            SelfContainedLib/*.vo
            SelfContainedLib/*.glob
            theories/*.vo
            theories/*.glob
          retention-days: 7

  # ç¬¬ä¸‰é˜¶æ®µç¼–è¯‘ï¼šæ‰©å±•æ¨¡å—
  compile-phase-3:
    name: ğŸ¯ é˜¶æ®µ3:æ‰©å±•æ¨¡å—ç¼–è¯‘
    needs: [setup-and-install, compile-phase-2]
    runs-on: ubuntu-22.04
    timeout-minutes: 50
    steps:
      - name: ğŸ“¥ æ£€å‡ºä»£ç 
        uses: actions/checkout@v4
        with:
          fetch-depth: 1

      - name: ğŸ”„ æ¢å¤å¹¶è®¾ç½®OPAMç¯å¢ƒ
        run: |
          # ç¡®ä¿OPAMç¯å¢ƒæ­£ç¡®è®¾ç½®
          if ! command -v opam &> /dev/null; then
            echo "OPAMæœªæ‰¾åˆ°ï¼Œé‡æ–°å®‰è£…..."
            sudo apt-get update
            sudo apt-get install -y opam bubblewrap
            opam init --disable-sandboxing -y --compiler=4.14.0
          fi
          
          eval $(opam env)
          echo "âœ… OPAMç¯å¢ƒå·²è®¾ç½®"

      - name: ğŸ“¥ æ¢å¤é˜¶æ®µ2ç»“æœ
        uses: actions/download-artifact@v4
        with:
          name: phase-2-compiled
          path: .

      - name: ğŸ“ æ£€æŸ¥æ‰©å±•æ¨¡å—
        run: |
          echo "=== æ‰©å±•æ¨¡å—ç»“æ„æ£€æŸ¥ ==="
          echo "CS_Nullç›®å½•:"
          ls -la CS_Null/*.v 2>/dev/null || echo "æ— CS_Nullæ–‡ä»¶"

      - name: ğŸ”§ ç¼–è¯‘FRF_CS_Null_Common.v
        run: |
          eval $(opam env)
          echo "ç¼–è¯‘FRF_CS_Null_Common.v..."
          
          if [ -f "CS_Null/FRF_CS_Null_Common.v" ]; then
            if coqc -Q SelfContainedLib SelfContainedLib -Q theories FRF.Theories -Q CS_Null FRF.CS_Null CS_Null/FRF_CS_Null_Common.v; then
              echo "âœ… FRF_CS_Null_Common.v ç¼–è¯‘æˆåŠŸ"
            else
              echo "âŒ FRF_CS_Null_Common.v ç¼–è¯‘å¤±è´¥"
              exit 1
            fi
          else
            echo "âŒ FRF_CS_Null_Common.v æ–‡ä»¶ç¼ºå¤±"
            exit 1
          fi

      - name: ğŸ“ˆ æ‰©å±•æ¨¡å—ç»Ÿè®¡
        run: |
          echo "=== æ‰©å±•æ¨¡å—ç¼–è¯‘ç»Ÿè®¡ ==="
          echo "CS_Nullæ¨¡å—:"
          for file in CS_Null/*.vo 2>/dev/null; do
            if [ -f "$file" ]; then
              base=$(basename "$file" .vo)
              echo "  âœ… $base"
            fi
          done

      - name: ğŸ’¾ ä¿å­˜ç¼–è¯‘ç»“æœ
        uses: actions/upload-artifact@v4
        with:
          name: phase-3-compiled
          path: |
            SelfContainedLib/*.vo
            SelfContainedLib/*.glob
            theories/*.vo
            theories/*.glob
            CS_Null/*.vo
            CS_Null/*.glob
          retention-days: 7

  # ç¬¬å››é˜¶æ®µç¼–è¯‘ï¼šæµ‹è¯•å¥—ä»¶
  compile-phase-4:
    name: ğŸ§ª é˜¶æ®µ4:æµ‹è¯•å¥—ä»¶ç¼–è¯‘
    needs: [setup-and-install, compile-phase-3]
    runs-on: ubuntu-22.04
    timeout-minutes: 40
    steps:
      - name: ğŸ“¥ æ£€å‡ºä»£ç 
        uses: actions/checkout@v4
        with:
          fetch-depth: 1

      - name: ğŸ”„ æ¢å¤å¹¶è®¾ç½®OPAMç¯å¢ƒ
        run: |
          # ç¡®ä¿OPAMç¯å¢ƒæ­£ç¡®è®¾ç½®
          if ! command -v opam &> /dev/null; then
            echo "OPAMæœªæ‰¾åˆ°ï¼Œé‡æ–°å®‰è£…..."
            sudo apt-get update
            sudo apt-get install -y opam bubblewrap
            opam init --disable-sandboxing -y --compiler=4.14.0
          fi
          
          eval $(opam env)
          echo "âœ… OPAMç¯å¢ƒå·²è®¾ç½®"

      - name: ğŸ“¥ æ¢å¤é˜¶æ®µ3ç»“æœ
        uses: actions/download-artifact@v4
        with:
          name: phase-3-compiled
          path: .

      - name: ğŸ§ª æ£€æŸ¥æµ‹è¯•å¥—ä»¶
        run: |
          echo "=== æµ‹è¯•å¥—ä»¶æ£€æŸ¥ ==="
          echo "æµ‹è¯•ç›®å½•:"
          ls -la Test/*.v 2>/dev/null || echo "æ— æµ‹è¯•æ–‡ä»¶"

      - name: ğŸ”§ ç¼–è¯‘Test_Basic.v
        run: |
          eval $(opam env)
          echo "ç¼–è¯‘Test_Basic.v..."
          
          if [ -f "Test/Test_Basic.v" ]; then
            if coqc -Q SelfContainedLib SelfContainedLib -Q theories FRF.Theories -Q CS_Null FRF.CS_Null -Q Test FRF.Test Test/Test_Basic.v; then
              echo "âœ… Test_Basic.v ç¼–è¯‘æˆåŠŸ"
            else
              echo "âŒ Test_Basic.v ç¼–è¯‘å¤±è´¥"
              exit 1
            fi
          else
            echo "âŒ Test_Basic.v æ–‡ä»¶ç¼ºå¤±"
            exit 1
          fi

      - name: ğŸ“ˆ æµ‹è¯•ç¼–è¯‘ç»Ÿè®¡
        run: |
          echo "=== æµ‹è¯•å¥—ä»¶ç¼–è¯‘ç»Ÿè®¡ ==="
          echo "æµ‹è¯•æ¨¡å—:"
          for file in Test/*.vo 2>/dev/null; do
            if [ -f "$file" ]; then
              base=$(basename "$file" .vo)
              size=$(stat -c%s "$file" 2>/dev/null || echo 0)
              echo "  âœ… $base (${size} bytes)"
            fi
          done

      - name: ğŸ“Š ç”Ÿæˆå…¨é‡éªŒè¯æŠ¥å‘Š
        run: |
          echo "ç”Ÿæˆå…¨é‡éªŒè¯æŠ¥å‘Š..."
          
          # åˆ›å»ºæŠ¥å‘Šç›®å½•
          mkdir -p verification-report
          
          # ç»Ÿè®¡ç¼–è¯‘ç»“æœ
          core_modules=("Algebra" "Category" "Geometry" "FRF_MetaTheory" "ChurchNumerals" "ChurchZero" "FRF_CS_Null_Common" "Test_Basic")
          total_core=${#core_modules[@]}
          success_core=0
          
          for module in "${core_modules[@]}"; do
            if find . -name "${module}.vo" -path "./SelfContainedLib/*" -o -path "./theories/*" -o -path "./CS_Null/*" -o -path "./Test/*" | grep -q .; then
              success_core=$((success_core + 1))
            fi
          done
          
          # ç”ŸæˆæŠ¥å‘Š
          echo "# FRF 2.0 å…¨é‡å½¢å¼åŒ–éªŒè¯æŠ¥å‘Š" > verification-report/FRF2_FULL_VERIFICATION_REPORT.md
          echo "" >> verification-report/FRF2_FULL_VERIFICATION_REPORT.md
          echo "## æ¦‚è¿°" >> verification-report/FRF2_FULL_VERIFICATION_REPORT.md
          echo "- **éªŒè¯æ—¶é—´**: $(date)" >> verification-report/FRF2_FULL_VERIFICATION_REPORT.md
          echo "- **GitHub Actionsè¿è¡ŒID**: ${{ github.run_id }}" >> verification-report/FRF2_FULL_VERIFICATION_REPORT.md
          echo "- **è§¦å‘äº‹ä»¶**: ${{ github.event_name }}" >> verification-report/FRF2_FULL_VERIFICATION_REPORT.md
          echo "- **åˆ†æ”¯**: ${{ github.ref }}" >> verification-report/FRF2_FULL_VERIFICATION_REPORT.md
          echo "" >> verification-report/FRF2_FULL_VERIFICATION_REPORT.md
          echo "## æ ¸å¿ƒæ¨¡å—éªŒè¯çŠ¶æ€" >> verification-report/FRF2_FULL_VERIFICATION_REPORT.md
          echo "| æ¨¡å— | å±‚çº§ | çŠ¶æ€ |" >> verification-report/FRF2_FULL_VERIFICATION_REPORT.md
          echo "|------|------|------|" >> verification-report/FRF2_FULL_VERIFICATION_REPORT.md
          
          for module in "${core_modules[@]}"; do
            if find . -name "${module}.vo" -path "./SelfContainedLib/*" -o -path "./theories/*" -o -path "./CS_Null/*" -o -path "./Test/*" | grep -q .; then
              case $module in
                "Algebra"|"Category"|"Geometry")
                  echo "| $module | ä¸€çº§åŸºç¡€ | âœ… æˆåŠŸ |" >> verification-report/FRF2_FULL_VERIFICATION_REPORT.md
                  ;;
                "FRF_MetaTheory"|"ChurchNumerals"|"ChurchZero")
                  echo "| $module | äºŒçº§å…ƒç†è®º | âœ… æˆåŠŸ |" >> verification-report/FRF2_FULL_VERIFICATION_REPORT.md
                  ;;
                "FRF_CS_Null_Common")
                  echo "| $module | ä¸‰çº§æ‰©å±• | âœ… æˆåŠŸ |" >> verification-report/FRF2_FULL_VERIFICATION_REPORT.md
                  ;;
                "Test_Basic")
                  echo "| $module | æµ‹è¯•å±‚ | âœ… æˆåŠŸ |" >> verification-report/FRF2_FULL_VERPORT.md
                  ;;
              esac
            else
              case $module in
                "Algebra"|"Category"|"Geometry")
                  echo "| $module | ä¸€çº§åŸºç¡€ | âŒ å¤±è´¥ |" >> verification-report/FRF2_FULL_VERIFICATION_REPORT.md
                  ;;
                "FRF_MetaTheory"|"ChurchNumerals"|"ChurchZero")
                  echo "| $module | äºŒçº§å…ƒç†è®º | âŒ å¤±è´¥ |" >> verification-report/FRF2_FULL_VERIFICATION_REPORT.md
                  ;;
                "FRF_CS_Null_Common")
                  echo "| $module | ä¸‰çº§æ‰©å±• | âŒ å¤±è´¥ |" >> verification-report/FRF2_FULL_VERIFICATION_REPORT.md
                  ;;
                "Test_Basic")
                  echo "| $module | æµ‹è¯•å±‚ | âŒ å¤±è´¥ |" >> verification-report/FRF2_FULL_VERIFICATION_REPORT.md
                  ;;
              esac
            fi
          done
          
          echo "" >> verification-report/FRF2_FULL_VERIFICATION_REPORT.md
          echo "## ç»Ÿè®¡æ‘˜è¦" >> verification-report/FRF2_FULL_VERIFICATION_REPORT.md
          echo "- **æ ¸å¿ƒæ¨¡å—æ€»æ•°**: $total_core" >> verification-report/FRF2_FULL_VERIFICATION_REPORT.md
          echo "- **æ ¸å¿ƒæ¨¡å—æˆåŠŸæ•°**: $success_core" >> verification-report/FRF2_FULL_VERIFICATION_REPORT.md
          success_rate=$((success_core * 100 / total_core))
          echo "- **æ ¸å¿ƒæ¨¡å—æˆåŠŸç‡**: $success_rate%" >> verification-report/FRF2_FULL_VERIFICATION_REPORT.md
          
          echo "" >> verification-report/FRF2_FULL_VERIFICATION_REPORT.md
          echo "## ç¯å¢ƒä¿¡æ¯" >> verification-report/FRF2_FULL_VERIFICATION_REPORT.md
          echo "\`\`\`" >> verification-report/FRF2_FULL_VERIFICATION_REPORT.md
          coqc --version >> verification-report/FRF2_FULL_VERIFICATION_REPORT.md
          echo "\`\`\`" >> verification-report/FRF2_FULL_VERIFICATION_REPORT.md
          
          echo "âœ… éªŒè¯æŠ¥å‘Šç”Ÿæˆå®Œæˆ"

      - name: ğŸ’¾ ä¿å­˜æœ€ç»ˆç¼–è¯‘ç»“æœ
        uses: actions/upload-artifact@v4
        with:
          name: phase-4-compiled
          path: |
            SelfContainedLib/*.vo
            SelfContainedLib/*.glob
            theories/*.vo
            theories/*.glob
            CS_Null/*.vo
            CS_Null/*.glob
            Test/*.vo
            Test/*.glob
          retention-days: 7

      - name: ğŸ“¤ ä¸Šä¼ éªŒè¯æŠ¥å‘Š
        uses: actions/upload-artifact@v4
        with:
          name: frf-2.0-verification-report
          path: verification-report/
          retention-days: 14

      - name: ğŸ‰ éªŒè¯é€šè¿‡é€šçŸ¥
        if: success()
        run: |
          echo "ğŸ‰ FRF 2.0 å…¨é‡å½¢å¼åŒ–éªŒè¯æˆåŠŸå®Œæˆï¼"
          echo "ğŸ“Š æ‰€æœ‰æ ¸å¿ƒæ¨¡å—ç¼–è¯‘é€šè¿‡"
          echo "âœ… éªŒè¯æŠ¥å‘Šå·²ç”Ÿæˆå¹¶ä¿å­˜"
          echo "ğŸ•’ éªŒè¯æ—¶é—´: $(date)"